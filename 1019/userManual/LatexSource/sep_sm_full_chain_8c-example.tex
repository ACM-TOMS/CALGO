\hypertarget{sep_sm_full_chain_8c-example}{}\doxysection{sep\+\_\+sm\+\_\+full\+\_\+chain.\+c}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "validate.h"}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <\mbox{\hyperlink{starneig_8h}{starneig/starneig.h}}>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// a predicate function that selects all eigenvalues that have positive a real}}
\DoxyCodeLine{\textcolor{comment}{// part}}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keywordtype}{int} predicate(\textcolor{keywordtype}{double} real, \textcolor{keywordtype}{double} imag, \textcolor{keywordtype}{void} *arg)}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (0.0 < real)}
\DoxyCodeLine{        \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{    \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} main()}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keywordtype}{int} n = 3000; \textcolor{comment}{// matrix dimension}}
\DoxyCodeLine{}
\DoxyCodeLine{    srand((\textcolor{keywordtype}{unsigned}) time(NULL));}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// generate a full random matrix A and a copy C}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} ldA = ((n/8)+1)*8, ldC = ((n/8)+1)*8;}
\DoxyCodeLine{    \textcolor{keywordtype}{double} *A = malloc(n*ldA*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{    \textcolor{keywordtype}{double} *C = malloc(n*ldC*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < n; j++)}
\DoxyCodeLine{        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++)}
\DoxyCodeLine{            A[j*ldA+i] = C[j*ldC+i] = 2.0*rand()/RAND\_MAX -\/ 1.0;}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// generate an identity matrix Q}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} ldQ = ((n/8)+1)*8;}
\DoxyCodeLine{    \textcolor{keywordtype}{double} *Q = malloc(n*ldA*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < n; j++)}
\DoxyCodeLine{        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; i++)}
\DoxyCodeLine{            Q[j*ldQ+i] = i == j ? 1.0 : 0.0;}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// allocate space for the eigenvalues and the eigenvalue selection vector}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{double} *real = malloc(n*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{    \textcolor{keywordtype}{double} *imag = malloc(n*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{double}));}
\DoxyCodeLine{    \textcolor{keywordtype}{int} *select = malloc(n*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// Initialize the StarNEig library using all available CPU cores and}}
\DoxyCodeLine{    \textcolor{comment}{// GPUs. The STARNEIG\_HINT\_SM flag indicates that the library should}}
\DoxyCodeLine{    \textcolor{comment}{// initialize itself for shared memory computations.}}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__node_ga4d6386652685ba5c5706e72ebbb7cb3a}{starneig\_node\_init}}(\mbox{\hyperlink{group__starneig__node_gab90bed6cebfd3e80b0cdd89a3d5465eb}{STARNEIG\_USE\_ALL}}, \mbox{\hyperlink{group__starneig__node_gab90bed6cebfd3e80b0cdd89a3d5465eb}{STARNEIG\_USE\_ALL}}, \mbox{\hyperlink{group__starneig__node_ga696b10750293e8b49bda0c205ed0882e}{STARNEIG\_HINT\_SM}});}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// reduce the full matrix matrix A to upper Hessenberg form}}
\DoxyCodeLine{}
\DoxyCodeLine{    printf(\textcolor{stringliteral}{"Hessenberg reduction...\(\backslash\)n"});}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__sm__sep_ga3180b21861b10ebf4016ee15e2f79d82}{starneig\_SEP\_SM\_Hessenberg}}(n, A, ldA, Q, ldQ);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// reduce the upper Hessenberg matrix A to Schur form}}
\DoxyCodeLine{}
\DoxyCodeLine{    printf(\textcolor{stringliteral}{"Schur reduction...\(\backslash\)n"});}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__sm__sep_ga357a2d35c0087d984f69987ac23aedfc}{starneig\_SEP\_SM\_Schur}}(n, A, ldA, Q, ldQ, real, imag);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// select eigenvalues that have positive a real part}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} num\_selected;}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__sm__sep_ga9d824d76e75f00a2f6a9b0bdc37e159c}{starneig\_SEP\_SM\_Select}}(n, A, ldA, \&predicate, NULL, select, \&num\_selected);}
\DoxyCodeLine{    printf(\textcolor{stringliteral}{"Selected \%d eigenvalues out of \%d.\(\backslash\)n"}, num\_selected, n);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// reorder the selected eigenvalues to the upper left corner of the matrix A}}
\DoxyCodeLine{}
\DoxyCodeLine{    printf(\textcolor{stringliteral}{"Reordering...\(\backslash\)n"});}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__sm__sep_ga03cc4e4c45d6ca0d156a3d70d4b91408}{starneig\_SEP\_SM\_ReorderSchur}}(n, select, A, ldA, Q, ldQ, real, imag);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// de-\/initialize the StarNEig library}}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{group__starneig__node_gad4c8101c0864588743c486cbd8e75dea}{starneig\_node\_finalize}}();}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// check residual || Q A Q\string^T -\/ C ||\_F / || C ||\_F}}
\DoxyCodeLine{}
\DoxyCodeLine{    check\_residual(n, ldQ, ldA, ldQ, ldC, Q, A, Q, C);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// check residual || Q Q\string^T -\/ I ||\_F / || I ||\_F}}
\DoxyCodeLine{}
\DoxyCodeLine{    check\_orthogonality(n, ldQ, Q);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// cleanup}}
\DoxyCodeLine{}
\DoxyCodeLine{    free(A);}
\DoxyCodeLine{    free(C);}
\DoxyCodeLine{    free(Q);}
\DoxyCodeLine{}
\DoxyCodeLine{    free(real);}
\DoxyCodeLine{    free(imag);}
\DoxyCodeLine{    free(select);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}
\end{DoxyCodeInclude}
 