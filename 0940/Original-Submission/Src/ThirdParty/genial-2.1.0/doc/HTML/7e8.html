<HTML>
<HEAD>
<SCRIPT SRC=scripts.js></SCRIPT>

<STYLE>
@import URL(styles.css);
</STYLE>
<LINK REL="stylesheet" href="styles.css">
<TITLE>Arrays</TITLE>
</HEAD>
<BODY onLoad="onLoad();"  CLASS="Object">

<A NAME=e87778x7d99ae4>
<SCRIPT LANGUAGE=JavaScript>
window.name = "Body";
</SCRIPT>

<!-- This is the language filter popup menu -->
<DIV ID="FILTER_POPUP" CLASS=FilterPopup>
<A HREF="javascript:setFilter('cpp');">C++</A><BR>
<A HREF="javascript:setFilter('cs');">C#</A><BR>
<A HREF="javascript:setFilter('vb');">VB</A><BR>
<A HREF="javascript:setFilter('js');">JScript</A><BR>
<A HREF="javascript:setFilter('all');">All</A>
</DIV>

<div class="contents">
<!--- This is the navigation bar -->
<TABLE CLASS="NavBar">
<TR VALIGN="BASELINE"  class=NavBar>
<TD  CLASS="NavBarLogo"><FONT FACE="Times New Roman"><FONT SIZE=2></FONT></FONT></TD>
<TD  CLASS="NavBarCenter"><TABLE CLASS="NavBarActionLine">
<TR VALIGN="BASELINE"  class=NavBarActionLine>
<TD  CLASS="NavBarActions"><A HREF="javascript:toggleFrames()" CLASS="MenuBarOff"
onMouseOver="this.className ='MenuBarOn';" onMouseOut="this.className = 'MenuBarOff';">
<SCRIPT>
if ( isFrameView() )
document.writeln("No&nbsp;Frames");
else
document.writeln("Frames");
</script></a></TD>
<TD  CLASS="NavBarActions"><a HREF="javascript:openTOC('contents.html')" CLASS=MenuBarOff onMouseOver="this.className ='MenuBarOn';" onMouseOut="this.className = 'MenuBarOff';">Contents</a></TD>
<TD  CLASS="NavBarActions"><a HREF="javascript:openTOC('index.html')" CLASS=MenuBarOff onMouseOver="this.className ='MenuBarOn';" onMouseOut="this.className = 'MenuBarOff';">Index</a></TD>
<TD  CLASS="NavBarActions"><a HREF='Hierarchy.html' CLASS=MenuBarOff onMouseOver="this.className = 'MenuBarOn';" onMouseOut="this.className = 'MenuBarOff';">Class&nbsp;Hierarchy</a></TD>

</TR>

</TABLE>
</TD>
<TD  CLASS="NavBarCompanyLogo"><A HREF="http://www.ient.rwth-aachen.de"><IMG BORDER=0 SRC="ient_logo.gif"></A></TD>

</TR>

</TABLE>

<!-- End of navigation bar -->


  <div class="main">

<!-- Beginning of the title -->
<H1 class="Title">

Arrays
</H1>
<HR class="Title">
<DIV CLASS="Terms">Copyright (C) 2005 IENT-RWTH Aachen</DIV><DIV style="clear: both"></DIV>

<!-- End of the title -->




<P CLASS="Normal"><SPAN CLASS="text">Array is a generic word that designs both vector and matrix. Vectors are one-dimensional arrays, matrices are two-dimensional arrays.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text"><U>Include</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">array/vector.h array/matrix.h</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text"><U>Generators</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">Every array has a unique template parameter, called generator. The generator describes completely every characteristic the array has. For instance, the following functions work with any constant vectors or matrices as parameter:</SPAN></P>
<PRE>
template&lt;class G&gt;           int f(const Vector&lt;G&gt; &amp;X);
template&lt;class G1,class G2&gt; int g(const Matrix&lt;G1&gt; &amp;X, const Matrix&lt;G2&gt; &amp;Y);
</PRE>
<P CLASS="Normal"><SPAN CLASS="text"><U>Interfaces</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">Some interface structures help to deal with generators. They could be considered as functions that would give a correct type back.</SPAN></P>
<PRE>
DenseVector&lt;int&gt;::self X;
TinyMatrix&lt;4,4,float&gt;::self Y;
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">Such declarations should be preferred to the following equivalent:</SPAN></P>
<PRE>
Vector&lt;dense_vector_generator&lt;int&gt; &gt; X;
Matrix&lt;tiny_matrix_generator&lt;4,4,float&gt; &gt; Y;
</PRE>
<P CLASS="Normal"><SPAN CLASS="text"><U>Left-Values</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">Many calculations on arrays can be used as left-values. This especially applies on adaptors that do not make any calculation, or any copy of the content.</SPAN></P>
<PRE>
DenseVector&lt;complex&lt;float&gt; &gt;::self X(4, 0); // X=[(0,0) (0,0) (0,0) (0,0)]
sub(X,2,2) = complex&lt;float&gt;(2,2); // X=[(0,0) (0,0) (2,2) (2,2)]
imag(sub(X,0,3)) = 5; // X=[(0,5) (0,5) (2,5) (2,2)]
</PRE>
<P CLASS="Normal"><SPAN CLASS="text"><U>Automatic promotions</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">If your arrays deal with different element types, GENIAL will automatically choose the best array type. It applies the same promotion rules than C++ does for scalars.</SPAN></P>
<PRE>
DenseVector&lt;int&gt;::self X(4,1); // X=[1 1 1 1]
DenseVector&lt;float&gt;::self Y(4,1.5); // Y=[1.5 1.5 1.5 1.5]
cout &lt;&lt; X+Y &lt;&lt; endl; // [2.5 2.5 2.5 2.5]
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">Nevertheless, you should try to use identical element types to spare conversion time. If the default conversion is not desired, the <I>value_cast</I> function can be used:</SPAN></P>
<PRE>
cout &lt;&lt; X+value_cast&lt;int&gt;(Y) &lt;&lt; endl; // [2 2 2 2]
</PRE>
<P CLASS="Normal"><SPAN CLASS="text"><U>Automatic reorganisation</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">The library automatically reorganizes the calculations.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">Suppose you need to calculate:</SPAN></P>
<PRE>
C=2*A+3*B
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">where <I>A</I>, <I>B</I> and <I>C</I> are matrices. The usual way for a library to compute would be to create a temporary matrix for the result of 2*A, another temporary matrix for 3*B, a third for the sum, and to copy the result in <I>C</I>. This needs much memory for the temporary matrices, and much time for every copy in new matrices. Whereas a source code with &#147;for&#148; loops would run much quicker:</SPAN></P>
<PRE>
for (int i=0; i&lt;M; ++i)
  for (int j=0; j&lt;N; ++j)
    C(i,j)=2*A(i,j)+3*B(i,j)
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">Neither temporary memory allocation is needed, nor copies of matrices. Besides, a similar principle becomes very difficult to use when the calculation gets complicated. It cannot evolve with the type of the operands: if <I>A</I>, <I>B</I>, and <I>C</I> would have been vectors instead of matrices, the first code would still be correct.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">GENIAL is able to automatically create new array instantiations, appropriated to every calculation. The resulting compiled code runs as quick as the most optimized C code, no matter how difficult the calculation is.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text"><U>Lazy calculation</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">The library only calculates what really is needed. It is &#147;lazy&#148;. This principle allows mixing several functions with the assurance that the execution time will not be longer than necessary.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">Suppose you are interested in the first column of the multiplication of the matrices <I>A</I> and <I>B</I> :</SPAN></P>
<PRE>
X=cols(mul(A,B))[0];
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">The <I>mul</I> function calculates the multiplication of 2 matrices. (The &#147;*&#148; operator would only calculate an element-wise multiplication of the 2 matrices) In this case the library does not lose its time for the whole calculation of the matrix multiplication.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">This technique has some limitations. But in practice, problems rarely occur, and there are easy solutions.</SPAN></P>
<UL>
<LI><P CLASS="IndentedNormal"><SPAN CLASS="text">Aliasing</SPAN></P>
<P CLASS="IndentedNormal"><SPAN CLASS="text">The calculation</SPAN></P>
<PRE>
A=mul(A,B);
</PRE>
<P CLASS="IndentedNormal"><SPAN CLASS="text">does not overwrite <I>A</I> with the result that one would actually expect. Because of the automatic reorganisation, the value A(0,0) is first overwritten at the first iteration. Then a second iteration calculates the value A(0,1), but with an already altered <I>A</I>, the result is false. There is a so-called &#147;aliasing&#148;. The solution consists in saving the result in a temporary variable. The <I>dense</I> function converts any array in a dense array.</SPAN></P>
<PRE>
A=dense(mul(A,B));

</PRE>
</LI>
<LI><P CLASS="IndentedNormal"><SPAN CLASS="text">Temporary arrays occasionally needed</SPAN></P>
<P CLASS="IndentedNormal"><SPAN CLASS="text">The library calculates just the needed positions of arrays, but on the other side it could happen that the library calculates many times the same position, resulting in wasted execution time. Avoid giving a complicated array as parameter to a function, especially if this function often needs the same position. Some functions (mostly <I>fft</I>, <I>dct</I>) will automatically do a conversion of the parameters to dense arrays if necessary. You can force the conversion if you estimate the calculation would be quicker:</SPAN></P>
<PRE>
D=mul(A,dense(mul(B,C)));

</PRE>
</LI>

</UL>
<P CLASS="Normal"><SPAN CLASS="text"><U>Assertions</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">To simplify the development of your project, GENIAL has <I>assert</I> statements in its code. This means that many validity tests are made during the execution of your project in debug mode. These tests mostly control the validity domain of accesses in arrays, so that an error message will be displayed if an index is not valid. Of course, no more tests are made in the release mode.</SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text"><U>Debug mode VS release mode</U></SPAN></P>
<P CLASS="Normal"><SPAN CLASS="text">There are many template specializations that work as switches. Many things happen differently in release mode in comparison to debug mode. The library tries to optimize the arrangement of your calculation. You should not notice any different behaviour, except a different execution time. If for any reason you want to debug your programme with release behaviour, you can declare</SPAN></P>
<PRE>
#define NDEBUG
</PRE>
<P CLASS="Normal"><SPAN CLASS="text">at the beginning of your file before any <I>include</I> statement. But keep in mind, that in this case no assertions are made.</SPAN></P>
<TABLE CLASS="GroupMemberList">
<TR VALIGN="BASELINE"  class=GroupMemberRow>
<TD  CLASS="GroupMemberName"><IMG BORDER=0 SRC="CPPClass_s.gif" ALT="Class" TITLE="Class">&nbsp;<SPAN CLASS=Summary onmouseover="return popup(this,'<P CLASS=|dPopupHeading|d><SPAN CLASS=|dtext|d><IMG BORDER=0 SRC=|dCPPClass_s.gif|d ALT=|dClass|d TITLE=|dClass|d>generator_traits</SPAN></P>|n');" onmouseout="return clearpopup();"><A HREF="javascript:openBody('361.html#5e5ea08x739d21c')">generator_traits</A></SPAN></TD>
<TD  CLASS="GroupMemberComment">&nbsp;</TD>

</TR>
<TR VALIGN="BASELINE"  class=GroupMemberRow>
<TD  CLASS="GroupMemberName">&nbsp;<SPAN CLASS=Summary onmouseover="return popup(this,'<P CLASS=|dPopupHeading|d><SPAN CLASS=|dtext|d>Vectors</SPAN></P>|n<P CLASS=|dPopupDeclaration|d><SPAN CLASS=|dtext|d></SPAN></P>|n<P CLASS=|dPopupNormal|d><SPAN CLASS=|dtext|d>Vectors represent one-dimensional arrays</SPAN></P>|n');" onmouseout="return clearpopup();"><A HREF="javascript:openBody('393.html#e87778x7f83b68')">Vectors</A></SPAN></TD>
<TD  CLASS="GroupMemberComment"><P CLASS="Summary"><SPAN CLASS="text">Vectors represent one-dimensional arrays</SPAN></P>
</TD>

</TR>
<TR VALIGN="BASELINE"  class=GroupMemberRow>
<TD  CLASS="GroupMemberName">&nbsp;<SPAN CLASS=Summary onmouseover="return popup(this,'<P CLASS=|dPopupHeading|d><SPAN CLASS=|dtext|d>Matrices</SPAN></P>|n<P CLASS=|dPopupDeclaration|d><SPAN CLASS=|dtext|d></SPAN></P>|n<P CLASS=|dPopupNormal|d><SPAN CLASS=|dtext|d>Matrices represent two-dimensional arrays</SPAN></P>|n');" onmouseout="return clearpopup();"><A HREF="javascript:openBody('ae8.html#e87778x86b0b48')">Matrices</A></SPAN></TD>
<TD  CLASS="GroupMemberComment"><P CLASS="Summary"><SPAN CLASS="text">Matrices represent two-dimensional arrays</SPAN></P>
</TD>

</TR>
<TR VALIGN="BASELINE"  class=GroupMemberRow>
<TD  CLASS="GroupMemberName">&nbsp;<SPAN CLASS=Summary onmouseover="return popup(this,'<P CLASS=|dPopupHeading|d><SPAN CLASS=|dtext|d>External functions</SPAN></P>|n<P CLASS=|dPopupDeclaration|d><SPAN CLASS=|dtext|d></SPAN></P>|n<P CLASS=|dPopupNormal|d><SPAN CLASS=|dtext|d>Basic calculation with arrays</SPAN></P>|n');" onmouseout="return clearpopup();"><A HREF="javascript:openBody('7c2.html#e87778x7d99bac')">External functions</A></SPAN></TD>
<TD  CLASS="GroupMemberComment"><P CLASS="Summary"><SPAN CLASS="text">Basic calculation with arrays</SPAN></P>
</TD>

</TR>

</TABLE>
      </A>
    </div> <!-- id=main -->

    <div class="TrailerBanner">
<P ALIGN=CENTER class="TrailerURL">
<A HREF="http://www.ient.rwth-aachen.de/team/laurent/genial/genial.html" class="TrailerURL"><IMG BORDER=0 SRC="ient_genial_banner.gif"></A>
</P>

    </div>

  </div><!-- id=contents --></A>
</BODY>
</HTML>
