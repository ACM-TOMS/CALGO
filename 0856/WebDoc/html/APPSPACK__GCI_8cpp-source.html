<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type"
content="text/html;charset=iso-8859-1">

<!-- Required Sandia Meta Tags -->
 <meta name="review" content="08_09_2000">
<meta name="filename" content="pagename.html""
<meta name="subject" content="APPSPACK">
<meta name="keywords" content="APPSPACK">
<meta name="sandia.approval_type> content="formal">
<meta name="sandia.approved" content="2000-8833">
<meta name="sandia.create_date" content="08/09/2000">
<link rev="owns" title="page owner" href="mailto:tgkolda@sandia.gov">
<link rev="made publisher" title="page creator" href="mailto:tgkolda@sandia.gov">
<meta name="MSSmartTagsPreventParsing" content="TRUE">
<meta name="Author" content="Tamara Kolda">
<!-- End Required Sandia Meta Tags -->

<title>APPSPACK 4.0.2: APPSPACK_GCI.cpp Source File</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
</head>

  <BODY BGCOLOR="#ffffff"
    TEXT="#000000" TOPMARGIN="0" LEFTMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0"
    LINK="#003399" VLINK="#990000">

    <a href="http://software.sandia.gov/appspack/"><IMG 
    SRC="../images/appspack.gif" WIDTH="107" HEIGHT="112" BORDER="0"
    ALIGN="left" VSPACE="0" HSPACE="7" ALT="Sandia Home"
    TITLE="Sandia Home"></a>
  
    <a href="http://www.sandia.gov/"><IMG 
    SRC="../images/snl_globe_right03_mod.gif" WIDTH="107" HEIGHT="112" BORDER="0"
    ALIGN="right" VSPACE="0" HSPACE="0" ALT="Sandia Home"
    TITLE="Sandia Home"></A>
  
  <DIV class="topright">

 
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>APPSPACK_GCI.cpp</h1><a href="APPSPACK__GCI_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">// $Id: APPSPACK_GCI.cpp,v 1.6.2.1 2005/06/29 17:07:42 tgkolda Exp $ </span>
00002 <span class="comment">// $Source: /space/CVS-Acro/acro/packages/appspack/appspack/src/APPSPACK_GCI.cpp,v $ </span>
00003 
00004 <span class="comment">//@HEADER</span>
00005 <span class="comment">// ************************************************************************</span>
00006 <span class="comment">// </span>
00007 <span class="comment">//          APPSPACK: Asynchronous Parallel Pattern Search</span>
00008 <span class="comment">//                 Copyright (2003) Sandia Corporation</span>
00009 <span class="comment">// </span>
00010 <span class="comment">// Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive</span>
00011 <span class="comment">// license for use of this work by or on behalf of the U.S. Government.</span>
00012 <span class="comment">// </span>
00013 <span class="comment">// This library is free software; you can redistribute it and/or modify</span>
00014 <span class="comment">// it under the terms of the GNU Lesser General Public License as</span>
00015 <span class="comment">// published by the Free Software Foundation; either version 2.1 of the</span>
00016 <span class="comment">// License, or (at your option) any later version.</span>
00017 <span class="comment">//  </span>
00018 <span class="comment">// This library is distributed in the hope that it will be useful, but</span>
00019 <span class="comment">// WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00020 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00021 <span class="comment">// Lesser General Public License for more details.</span>
00022 <span class="comment">//                                                                                 </span>
00023 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00024 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00025 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307</span>
00026 <span class="comment">// USA.                                                                           .</span>
00027 <span class="comment">// </span>
00028 <span class="comment">// Questions? Contact Tammy Kolda (tgkolda@sandia.gov) </span>
00029 <span class="comment">// </span>
00030 <span class="comment">// ************************************************************************</span>
00031 <span class="comment">//@HEADER</span>
00032 
00038 <span class="preprocessor">#include "<a class="code" href="APPSPACK__GCI_8hpp.html">APPSPACK_GCI.hpp</a>"</span>
00039 
00040 <span class="keyword">using</span> <span class="keyword">namespace </span>APPSPACK;
00041 
00042 <span class="comment">// ----------------------------------------------------------------------</span>
00043 <span class="comment">// Initialize</span>
00044 <span class="comment">// ----------------------------------------------------------------------</span>
00045 
00046 <span class="preprocessor">#ifdef HAVE_PVM</span>
00047 <span class="preprocessor"></span>
00048 <span class="keywordtype">int</span> GCI::lastBufferId = 0;
00049 <span class="keyword">struct </span>pvmhostinfo* GCI::pvmHostInfo = NULL;
00050 <span class="keywordtype">int</span> GCI::nHosts = 0;
00051 <span class="keywordtype">int</span> GCI::nArch = 0;
00052 
00053 <span class="preprocessor">#elif defined HAVE_MPI</span>
00054 <span class="preprocessor"></span>
00055 <span class="keywordtype">char</span>* GCI::sendBuffer = NULL;
00056 <span class="keywordtype">char</span>* GCI::recvBuffer = NULL;
00057 <span class="keywordtype">int</span> GCI::sendPosition = 0;
00058 <span class="keywordtype">int</span> GCI::recvPosition = 0; 
00059 <span class="keywordtype">int</span> GCI::msgSize = 0;
00060 MPI_Comm GCI::APPS_COMM = MPI_COMM_NULL;
00061 MPI_Status GCI::status;
00062 
00063 <span class="preprocessor">#endif</span>
00064 <span class="preprocessor"></span>
00065 <span class="comment">// ----------------------------------------------------------------------</span>
00066 <span class="comment">// Functions</span>
00067 <span class="comment">// ----------------------------------------------------------------------</span>
00068 
00069 <span class="comment">// ----------------------------------------------------------------------</span>
00070 <span class="comment">// Initialize &amp; Exit</span>
00071 <span class="comment">// ----------------------------------------------------------------------</span>
00072 
<a name="l00073"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_0">00073</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_0">GCI::init</a>()
00074 {
00075   <span class="keywordtype">int</span> argc = -1;
00076   <span class="keywordtype">char</span>** argv = NULL;
00077   <span class="keywordflow">return</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_0">GCI::init</a>(argc, argv);
00078 }
00079 
<a name="l00080"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_1">00080</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_0">GCI::init</a>(<span class="keywordtype">int</span>&amp; argc, <span class="keywordtype">char</span>**&amp; argv) 
00081 { 
00082 
00083 <span class="preprocessor">#ifdef HAVE_PVM</span>
00084 <span class="preprocessor"></span>
00085   <span class="comment">// PVM is initialized by calling any PVM command</span>
00086   <span class="keywordflow">return</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_0">GCI::getMyTid</a>();
00087 
00088 <span class="preprocessor">#elif defined HAVE_MPI</span>
00089 <span class="preprocessor"></span>
00090   <span class="comment">// This routine puts all processes in a communicator called</span>
00091   <span class="comment">// APPS_COMM.  Users who wish to divide the processes into more than</span>
00092   <span class="comment">// one communicator, in order to do multi-level parallelism for</span>
00093   <span class="comment">// instance, should add code to pare down worldgroup to just the set</span>
00094   <span class="comment">// of processes APPS should use. This function returns the process'</span>
00095   <span class="comment">// rank.</span>
00096 
00097   <span class="keywordflow">if</span> (argc == -1) 
00098   {
00099     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - must specify argc and argv when using MPI"</span> &lt;&lt; endl;
00100     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00101   }
00102 
00103   MPI_Group worldGroup, appsGroup;
00104   <span class="keywordtype">int</span> e;
00105   <span class="keywordtype">int</span> groupSize;
00106   <span class="keywordtype">int</span>* ranksInOldGroup;
00107 
00108   e = MPI_Init(&amp;argc, &amp;argv);
00109 
00110   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00111   {
00112     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - error initializing MPI."</span> &lt;&lt; endl;
00113     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00114   }
00115   
00116   <span class="comment">// Get the set of processes (group, in MPI lingo) associated with </span>
00117   <span class="comment">// MPI_COMM_WORLD.</span>
00118   e = MPI_Comm_group(MPI_COMM_WORLD, &amp;worldGroup);
00119   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00120   {
00121     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - error calling MPI_Comm_group"</span> &lt;&lt; endl;
00122     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00123   }
00124 
00125   <span class="comment">// Find out how many process there are in the group.</span>
00126   e = MPI_Group_size(worldGroup, &amp;groupSize);
00127   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00128   {
00129     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - error calling MPI_Group_size"</span> &lt;&lt; endl;
00130     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00131   }
00132 
00133   <span class="comment">// Build an array of ranks to include in the new communicator.  </span>
00134   <span class="comment">// The process with rank ranksInOldGroup[0] will have rank 0 in the </span>
00135   <span class="comment">// new groupd, ranksInOldGroup[1] will have rank 1, etc.</span>
00136   <span class="comment">// In this case, since we want the new group to be the same as the</span>
00137   <span class="comment">// old, we include all ranks in the original order.</span>
00138   ranksInOldGroup = <span class="keyword">new</span> <span class="keywordtype">int</span>[groupSize];
00139   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; groupSize; i++)
00140     ranksInOldGroup[i] = i;
00141 
00142   <span class="comment">// Create the new group.</span>
00143   e = MPI_Group_incl(worldGroup, groupSize, ranksInOldGroup, &amp;appsGroup);
00144   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00145   {
00146     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - error calling MPI_Group_incl"</span> &lt;&lt; endl;
00147     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00148   }
00149 
00150   <span class="comment">// Create a new communicator which has the processes in group</span>
00151   <span class="comment">// appsGroup, drawn from MPI_COMM_WORLD.</span>
00152   e = MPI_Comm_create(MPI_COMM_WORLD, appsGroup, &amp;APPS_COMM);
00153   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00154   {
00155     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - error calling MPI_Comm_create"</span> &lt;&lt; endl;
00156     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00157   }
00158 
00159   <span class="keyword">delete</span>[] ranksInOldGroup;
00160 
00161   <span class="keywordflow">return</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_0">GCI::getMyTid</a>();
00162 
00163 <span class="preprocessor">#else</span>
00164 <span class="preprocessor"></span>
00165   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::init - requires PVM or MPI"</span> &lt;&lt; endl; 
00166   <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00167 
00168 <span class="preprocessor">#endif</span>
00169 <span class="preprocessor"></span>}
00170 
<a name="l00171"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_2">00171</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_2">GCI::catchOutput</a>(<span class="keywordtype">bool</span> flag)
00172 {
00173   <span class="comment">// Set standard output to pipe through this process ONLY IF this</span>
00174   <span class="comment">// process HAS NOT been launched from the PVM console. If flag</span>
00175   <span class="comment">// (default true) is false, then disable output redirection.</span>
00176 
00177 <span class="preprocessor">#ifdef HAVE_PVM</span>
00178 <span class="preprocessor"></span>
00179   <span class="keywordflow">if</span> (flag) 
00180   {
00181     <span class="keywordflow">if</span> (pvm_parent() == PvmParentNotSet) <span class="comment">// running from PVM console</span>
00182       <span class="keywordflow">return</span>;
00183     pvm_catchout(stdout);
00184     pvm_setopt(PvmShowTids, 0);
00185   }
00186   <span class="keywordflow">else</span>
00187     pvm_catchout(0);
00188 
00189 <span class="preprocessor">#else</span>
00190 <span class="preprocessor"></span>
00191   cerr &lt;&lt; <span class="stringliteral">"Warning! APPSPACK::GCI::catchOutput requires PVM"</span> &lt;&lt; endl;
00192 
00193 <span class="preprocessor">#endif</span>
00194 <span class="preprocessor"></span>}
00195 
<a name="l00196"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_3">00196</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_3">GCI::spawn</a>(<span class="keyword">const</span> string name, <span class="keyword">const</span> string host, <span class="keywordtype">char</span>* argv[])
00197 {
00198   <span class="comment">// Spawn a SINGLE task with the given name on a specified host. If</span>
00199   <span class="comment">// the host name is unspecified (""), then the task is spawned on</span>
00200   <span class="comment">// any available machine. Default argv is NULL. Return 0 if the</span>
00201   <span class="comment">// spawn failed. Otherwise, return the taskid.</span>
00202 
00203 <span class="preprocessor">#ifdef HAVE_PVM</span>
00204 <span class="preprocessor"></span>
00205   <span class="keywordtype">int</span> taskId;
00206   <span class="keywordtype">int</span> info;
00207 
00208   <span class="keywordflow">if</span> (host == <span class="stringliteral">""</span>) 
00209     info = pvm_spawn(const_cast&lt;char*&gt;(name.c_str()), argv, PvmTaskDefault, 
00210                      NULL, 1, &amp;taskId);
00211   <span class="keywordflow">else</span> 
00212     info = pvm_spawn(const_cast&lt;char*&gt;(name.c_str()), argv, PvmTaskHost, 
00213                      const_cast&lt;char*&gt;(host.c_str()), 1, &amp;taskId);
00214 
00215   <span class="keywordflow">if</span> (info == PvmBadParam) 
00216   {
00217     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn - invalid parameter"</span> &lt;&lt; endl;
00218     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00219   }
00220 
00221   <span class="keywordflow">if</span> (info == PvmNoHost) 
00222   {
00223     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn - requested host is not in virtual machine"</span> &lt;&lt; endl;
00224     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00225   }
00226 
00227   <span class="keywordflow">if</span> (info == PvmNoFile) 
00228   {
00229     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn - executable cannot be found"</span> &lt;&lt; endl;
00230     <span class="keywordflow">return</span> 0;
00231   }
00232 
00233   <span class="keywordflow">if</span> (info == PvmNoMem) 
00234   {
00235     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn - not enough memory on host"</span> &lt;&lt; endl;
00236     <span class="keywordflow">return</span> 0;
00237   }
00238 
00239   <span class="keywordflow">if</span> (info == PvmSysErr) 
00240   {
00241     cerr &lt;&lt;  <span class="stringliteral">"APPSPACK::GCI::spawn - pvmd not responding"</span> &lt;&lt; endl;
00242     <span class="keywordflow">return</span> 0;
00243   }
00244 
00245   <span class="keywordflow">if</span> (info == PvmOutOfRes) 
00246   {
00247     cerr &lt;&lt;  <span class="stringliteral">"APPSPACK::GCI::spawn - out of resources"</span> &lt;&lt; endl;
00248     <span class="keywordflow">return</span> 0;
00249   }
00250 
00251   <span class="keywordflow">if</span> (info &lt; 0) 
00252   {
00253     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn - unrecgonized error"</span> &lt;&lt; endl;
00254     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00255   }
00256 
00257   <span class="keywordflow">if</span> (info &lt; 1)
00258     <span class="keywordflow">return</span> 0;
00259 
00260   <span class="keywordflow">return</span> taskId;
00261 
00262 <span class="preprocessor">#else</span>
00263 <span class="preprocessor"></span>
00264   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::spawn requires PVM"</span> &lt;&lt; endl;
00265   <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00266 
00267 <span class="preprocessor">#endif</span>
00268 <span class="preprocessor"></span>}
00269 
<a name="l00270"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_4">00270</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_4">GCI::kill</a>(<span class="keywordtype">int</span> taskId)
00271 {
00272   <span class="comment">// Kill the process with the given task id.</span>
00273 
00274 <span class="preprocessor">#ifdef HAVE_PVM</span>
00275 <span class="preprocessor"></span>
00276   <span class="keywordtype">int</span> info = pvm_kill(taskId);
00277 
00278   <span class="keywordflow">if</span> (info == PvmSysErr) 
00279   {
00280     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::kill -  pvmd not responding"</span> &lt;&lt; endl;
00281     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00282   }
00283   <span class="keywordflow">if</span> (info == PvmBadParam) 
00284   {
00285     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::kill - invalid taskId"</span> &lt;&lt; endl;
00286     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00287   }
00288   <span class="keywordflow">if</span> (info &lt; 0) 
00289   {
00290     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::kill - unrecognized PVM error"</span> &lt;&lt; endl;
00291     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00292   }
00293 <span class="preprocessor">#else</span>
00294 <span class="preprocessor"></span>
00295   cerr &lt;&lt; <span class="stringliteral">"Warning! APPSPACK::GCI::kill requires PVM"</span> &lt;&lt; endl;
00296 
00297 <span class="preprocessor">#endif</span>
00298 <span class="preprocessor"></span>}
00299 
<a name="l00300"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z9_5">00300</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z9_5">GCI::exit</a>()
00301 {
00302   <span class="comment">// Exit communication interface.</span>
00303 
00304 <span class="preprocessor">#ifdef HAVE_PVM</span>
00305 <span class="preprocessor"></span>
00306   <span class="comment">// In PVM it's very important to call this before exiting.</span>
00307 
00308   <span class="keywordtype">int</span> info = pvm_exit();
00309 
00310   <span class="keywordflow">if</span> (info == PvmSysErr) 
00311   {
00312     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::exit - pvmd not responding"</span> &lt;&lt; endl;
00313     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00314   }
00315   <span class="keywordflow">if</span> (info &lt; 0) 
00316   {
00317     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::exit - unrecognized PVM error"</span> &lt;&lt; endl;
00318     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00319   }
00320 
00321 <span class="preprocessor">#elif defined HAVE_MPI</span>
00322 <span class="preprocessor"></span>
00323   <span class="keyword">delete</span>[] sendBuffer;
00324   <span class="keyword">delete</span>[] recvBuffer;
00325 
00326   <span class="keywordtype">int</span> e;
00327 
00328   <span class="comment">// Wait for all processes to finish.</span>
00329   e = MPI_Barrier(APPS_COMM);
00330   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00331   {
00332     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::exit - error in MPI barrier"</span> &lt;&lt; endl;
00333     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00334   }
00335   <span class="comment">// End MPI.</span>
00336   e = MPI_Finalize();
00337   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00338   {
00339     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::exit - error in MPI finalize"</span> &lt;&lt; endl;
00340     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00341   }
00342 <span class="preprocessor">#else</span>
00343 <span class="preprocessor"></span>
00344   cerr &lt;&lt; <span class="stringliteral">"Warning! APPSPACK::GCI::exit requires PVM or MPI"</span> &lt;&lt; endl;
00345 
00346 <span class="preprocessor">#endif</span>
00347 <span class="preprocessor"></span>
00348 }
00349 
00350 <span class="comment">// ----------------------------------------------------------------------</span>
00351 <span class="comment">// Status &amp; Notify</span>
00352 <span class="comment">// ----------------------------------------------------------------------</span>
00353 
<a name="l00354"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_0">00354</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_0">GCI::getMyTid</a>() 
00355 {
00356   <span class="comment">// Return my taskId (or rank in MPI lingo).</span>
00357 
00358 <span class="preprocessor">#ifdef HAVE_PVM</span>
00359 <span class="preprocessor"></span>
00360   <span class="keywordtype">int</span> info = pvm_mytid();
00361 
00362   <span class="keywordflow">if</span> (info == PvmSysErr) 
00363   {
00364     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getMyTid - pvmd is not running"</span> &lt;&lt; endl;
00365     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00366   }
00367   <span class="keywordflow">if</span> (info &lt; 0) 
00368   {
00369     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::mytid - unrecognized PVM error"</span> &lt;&lt; endl;
00370     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00371   }
00372   <span class="keywordflow">return</span> info;
00373 
00374 <span class="preprocessor">#elif defined HAVE_MPI</span>
00375 <span class="preprocessor"></span>
00376   <span class="keywordtype">int</span> rank;
00377 
00378   <span class="keywordtype">int</span> e = MPI_Comm_rank(APPS_COMM, &amp;rank);
00379   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00380   {
00381     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::mytid - error getting MPI rank."</span> &lt;&lt; endl;
00382     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00383   }
00384 
00385   <span class="keywordflow">return</span> rank;
00386 
00387 <span class="preprocessor">#else</span>
00388 <span class="preprocessor"></span>
00389   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::mytid requires PVM"</span> &lt;&lt; endl;
00390   <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00391 
00392 <span class="preprocessor">#endif</span>
00393 <span class="preprocessor"></span>}
00394 
<a name="l00395"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_1">00395</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_1">GCI::getNumProcs</a>() 
00396 { 
00397   <span class="comment">// Returns number of processes</span>
00398 
00399 <span class="preprocessor">#ifdef HAVE_MPI</span>
00400 <span class="preprocessor"></span>
00401   <span class="keywordtype">int</span> nProcs;
00402 
00403   <span class="keywordtype">int</span> e = MPI_Comm_size(APPS_COMM, &amp;nProcs);
00404   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00405   {
00406     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getNumProcs - error getting number of processes."</span> &lt;&lt; endl;
00407     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00408   }
00409         
00410   <span class="keywordflow">return</span> nProcs;
00411 
00412 <span class="preprocessor">#else</span>
00413 <span class="preprocessor"></span>
00414    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getNumProcs() requires MPI"</span> &lt;&lt; endl;
00415    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00416 
00417 <span class="preprocessor">#endif</span>
00418 <span class="preprocessor"></span>}
00419 
<a name="l00420"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_2">00420</a> <span class="keywordtype">bool</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_2">GCI::isOrphan</a>()
00421 {
00422 <span class="preprocessor">#ifdef HAVE_PVM</span>
00423 <span class="preprocessor"></span>
00424   <span class="comment">// Check if the process is an orphan, i.e., the process was spawned</span>
00425   <span class="comment">// from the command line or the PVM console.</span>
00426 
00427   <span class="keywordtype">int</span> info = pvm_parent();
00428 
00429   <span class="keywordflow">if</span> (info == PvmSysErr) 
00430   {
00431     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::isorphan - pvmd not responding"</span> &lt;&lt; endl;
00432     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00433   }
00434   <span class="keywordflow">if</span> ((info &lt; 0) &amp;&amp; (info != PvmNoParent) &amp;&amp; (info != PvmParentNotSet)) 
00435   {
00436     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::isorphan - unrecognized PVM error"</span> &lt;&lt; endl;
00437     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00438   }
00439 
00440   <span class="keywordflow">return</span> ((info == PvmNoParent) || (info == PvmParentNotSet));
00441 
00442 <span class="preprocessor">#else</span>
00443 <span class="preprocessor"></span>
00444   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::isorphan requires PVM"</span> &lt;&lt; endl;
00445   <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00446 
00447 <span class="preprocessor">#endif</span>
00448 <span class="preprocessor"></span>}
00449 
<a name="l00450"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_3">00450</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_3">GCI::parent</a>()
00451 {
00452 <span class="preprocessor">#ifdef HAVE_PVM</span>
00453 <span class="preprocessor"></span>
00454   <span class="comment">// Return the task id for the parent task. This will throw an error</span>
00455   <span class="comment">// if there is not a parent, so call if necessary isOrphan() first</span>
00456   <span class="comment">// to check.</span>
00457 
00458   <span class="keywordtype">int</span> info = pvm_parent();
00459 
00460   <span class="keywordflow">if</span> (info == PvmNoParent) 
00461   {
00462     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::parent - no PVM parent"</span> &lt;&lt; endl;
00463     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00464   }
00465   <span class="keywordflow">if</span> (info == PvmSysErr) 
00466   {
00467     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::parent - pvmd not responding"</span> &lt;&lt; endl;
00468     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00469   }
00470   <span class="keywordflow">if</span> (info &lt; 0) 
00471   {
00472     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::parent - unrecognized PVM error"</span> &lt;&lt; endl;
00473     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00474   }
00475 
00476   <span class="keywordflow">return</span> info;
00477 
00478 <span class="preprocessor">#else</span>
00479 <span class="preprocessor"></span>
00480   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::parent requires PVM"</span> &lt;&lt; endl;
00481   <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00482 
00483 <span class="preprocessor">#endif</span>
00484 <span class="preprocessor"></span>}
00485 
<a name="l00486"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_4">00486</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_4">GCI::tidToHost</a>(<span class="keywordtype">int</span> t)
00487 {
00488   <span class="comment">// Find the host id for the given task.</span>
00489 
00490 <span class="preprocessor">#ifdef HAVE_PVM</span>
00491 <span class="preprocessor"></span>
00492   <span class="keywordtype">int</span> info = pvm_tidtohost(t);
00493 
00494   <span class="keywordflow">if</span> (info == PvmBadParam) 
00495   {
00496     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::tidtohost - invalid task id"</span> &lt;&lt; endl;
00497     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00498   }
00499   <span class="keywordflow">if</span> (info &lt; 0) 
00500   {
00501     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::tidtohost - unrecognized PVM error"</span> &lt;&lt; endl;
00502     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00503   }
00504 
00505   <span class="keywordflow">return</span> info;
00506 
00507 <span class="preprocessor">#else</span>
00508 <span class="preprocessor"></span>
00509    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::tidtohost requires PVM"</span> &lt;&lt; endl;
00510    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00511 
00512 <span class="preprocessor">#endif</span>
00513 <span class="preprocessor"></span>}
00514 
<a name="l00515"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_5">00515</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_5">GCI::notify</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> taskId)
00516 {
00517   <span class="comment">// Set notify for a SINGLE task </span>
00518 
00519 <span class="preprocessor">#ifdef HAVE_PVM</span>
00520 <span class="preprocessor"></span>
00521   <span class="keywordtype">int</span> info = pvm_notify(PvmTaskExit, msgtag, 1, &amp;taskId);
00522 
00523   <span class="keywordflow">if</span> (info == PvmSysErr) 
00524   {
00525     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - pvmd not responding"</span> &lt;&lt; endl;
00526     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00527   }
00528   <span class="keywordflow">if</span> (info == PvmBadParam) 
00529   {
00530     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - invalid argument to pvm_notify"</span> &lt;&lt; endl;
00531     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00532   }
00533   <span class="keywordflow">if</span> (info &lt; 0) 
00534   {
00535     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - unrecognized PVM error"</span> &lt;&lt; endl;
00536     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00537   }
00538 <span class="preprocessor">#else</span>
00539 <span class="preprocessor"></span>
00540    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify requires PVM"</span> &lt;&lt; endl;
00541    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00542 
00543 <span class="preprocessor">#endif</span>
00544 <span class="preprocessor"></span>}
00545 
<a name="l00546"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z11_6">00546</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z11_5">GCI::notify</a>(<span class="keywordtype">int</span> msgtag)
00547 {
00548   <span class="comment">// Set notify for ALL host additions</span>
00549 
00550 <span class="preprocessor">#ifdef HAVE_PVM</span>
00551 <span class="preprocessor"></span>
00552   <span class="keywordtype">int</span> info = pvm_notify(PvmHostAdd, msgtag, -1, NULL);
00553 
00554   <span class="keywordflow">if</span> (info == PvmSysErr) 
00555   {
00556     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - pvmd not responding"</span> &lt;&lt; endl;
00557     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00558   }
00559   <span class="keywordflow">if</span> (info == PvmBadParam) 
00560   {
00561     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - invalid argument to pvm_notify"</span> &lt;&lt; endl;
00562     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00563   }
00564   <span class="keywordflow">if</span> (info &lt; 0) 
00565   {
00566     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify - unrecognized PVM error"</span> &lt;&lt; endl;
00567     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00568   }
00569 
00570 <span class="preprocessor">#else</span>
00571 <span class="preprocessor"></span>
00572    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::notify requires PVM"</span> &lt;&lt; endl;
00573    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00574 
00575 <span class="preprocessor">#endif</span>
00576 <span class="preprocessor"></span>}
00577 
00578 <span class="comment">// ----------------------------------------------------------------------</span>
00579 <span class="comment">// Send, Recv, and Related Commands</span>
00580 <span class="comment">// ----------------------------------------------------------------------</span>
00581 
<a name="l00582"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_0">00582</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_0">GCI::initSend</a>()
00583 {
00584   <span class="comment">// Initialize send.</span>
00585 
00586 <span class="preprocessor">#ifdef HAVE_PVM</span>
00587 <span class="preprocessor"></span>
00588   <span class="keywordtype">int</span> info = pvm_initsend(PvmDataDefault); <span class="comment">// XDR encoding</span>
00589 
00590   <span class="keywordflow">if</span> (info == PvmBadParam) 
00591   {
00592     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::initsend - invalid encoding value"</span> &lt;&lt; endl;
00593     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00594   }
00595   <span class="keywordflow">if</span> (info == PvmNoMem) 
00596   {
00597     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::initsend - out of memory"</span> &lt;&lt; endl;
00598     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00599   }
00600   <span class="keywordflow">if</span> (info &lt; 0) 
00601   {
00602     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::initsend - unrecognized PVM error"</span> &lt;&lt; endl;
00603     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00604   }
00605 
00606 <span class="preprocessor">#elif defined HAVE_MPI</span>
00607 <span class="preprocessor"></span>
00608   <span class="keyword">delete</span>[] sendBuffer;
00609   sendBuffer = NULL;
00610   sendPosition = 0;
00611   sendPosition = 0;
00612 
00613 <span class="preprocessor">#else</span>
00614 <span class="preprocessor"></span>
00615    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::initsend requires PVM or MPI"</span> &lt;&lt; endl;
00616    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00617 
00618 <span class="preprocessor">#endif</span>
00619 <span class="preprocessor"></span>}
00620 
<a name="l00621"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_1">00621</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_1">GCI::send</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> taskId)
00622 {
00623   <span class="comment">// Send a message with the specified message tag to the given task</span>
00624   <span class="comment">// id.</span>
00625 
00626 <span class="preprocessor">#ifdef HAVE_PVM</span>
00627 <span class="preprocessor"></span>
00628   <span class="keywordtype">int</span> info = pvm_send(taskId, msgtag);
00629 
00630   <span class="keywordflow">if</span> (info == PvmSysErr) 
00631   {
00632     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send - pvmd not responding"</span> &lt;&lt; endl;
00633     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00634   }
00635   <span class="keywordflow">if</span> (info == PvmBadParam) 
00636   {
00637     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send - invalid argument"</span> &lt;&lt; endl;
00638     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00639   }
00640   <span class="keywordflow">if</span> (info == PvmNoBuf) 
00641   {
00642     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send - no active send buffer"</span> &lt;&lt; endl;
00643     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00644   }
00645   <span class="keywordflow">if</span> (info &lt; 0) 
00646   {
00647     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send - unrecognized PVM error"</span> &lt;&lt; endl;
00648     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00649   }
00650 
00651 <span class="preprocessor">#elif defined HAVE_MPI</span>
00652 <span class="preprocessor"></span>
00653   <span class="keywordtype">int</span> e = MPI_Send(sendBuffer, sendPosition, MPI_PACKED, taskId, msgtag, APPS_COMM);
00654   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00655   {
00656     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send - error in MPI packed send"</span> &lt;&lt; endl;
00657     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00658   }
00659 
00660 <span class="preprocessor">#else</span>
00661 <span class="preprocessor"></span>
00662    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::send requires PVM or MPI"</span> &lt;&lt; endl;
00663    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00664 
00665 <span class="preprocessor">#endif</span>
00666 <span class="preprocessor"></span>}
00667 
<a name="l00668"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_2">00668</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_2">GCI::broadcast</a> (<span class="keywordtype">int</span> msgtag, <span class="keyword">const</span> vector&lt;int&gt;&amp; taskId)
00669 {
00670   <span class="comment">// Broadcast message in buffer using tag msgtag to the n tasks</span>
00671   <span class="comment">// listed in the taskId array.</span>
00672 
00673 <span class="preprocessor">#ifdef HAVE_PVM</span>
00674 <span class="preprocessor"></span>
00675   <span class="comment">// MAY WANT TO FIX THIS??</span>
00676 
00677   <span class="keywordtype">int</span> n = taskId.size();
00678   <span class="keywordtype">int</span>* taskIdcpy = <span class="keyword">new</span> <span class="keywordtype">int</span>[n];
00679   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
00680     taskIdcpy[i] = taskId[i];
00681 
00682 
00683   <span class="keywordtype">int</span> info = pvm_mcast(taskIdcpy, n, msgtag);
00684 
00685   <span class="keywordflow">if</span> (info == PvmSysErr) 
00686   {
00687     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::broadcast - pvmd not responding"</span> &lt;&lt; endl;
00688     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00689   }
00690   <span class="keywordflow">if</span> (info == PvmBadParam) 
00691   {
00692     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::broadcast -  msgtag &lt; 0"</span> &lt;&lt; endl;
00693     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00694   }
00695   <span class="keywordflow">if</span> (info == PvmNoBuf) 
00696   {
00697     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::broadcast - no active send buffer"</span> &lt;&lt; endl;
00698     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00699   }
00700   <span class="keywordflow">if</span> (info &lt; 0) 
00701   {
00702     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::broadcast - unrecognized PVM error"</span> &lt;&lt; endl;
00703     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00704   }
00705 
00706   <span class="keyword">delete</span> taskIdcpy;
00707 
00708 <span class="preprocessor">#else</span>
00709 <span class="preprocessor"></span>
00710    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::broadcast requires PVM"</span> &lt;&lt; endl;
00711    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00712 
00713 <span class="preprocessor">#endif</span>
00714 <span class="preprocessor"></span>}
00715 
<a name="l00716"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_3">00716</a> <span class="keywordtype">bool</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_3">GCI::recv</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> msgtid)
00717 {
00718   <span class="comment">// Blocking receive for a message with the given tag and task id.</span>
00719   <span class="comment">// The inputs msgtag and msgtid default to -1 (wildcard).  Returns</span>
00720   <span class="comment">// the buffer id of the message (PVM) or 1 (MPI), if any, and 0</span>
00721   <span class="comment">// otherwise.</span>
00722 
00723 <span class="preprocessor">#ifdef HAVE_PVM</span>
00724 <span class="preprocessor"></span>
00725   <span class="keywordtype">int</span> bufid = pvm_recv(msgtid, msgtag); 
00726 
00727   <span class="keywordflow">if</span> (bufid == PvmBadParam) 
00728   {
00729     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::recv - invalid tid value or msgtag &lt; -1"</span> &lt;&lt; endl;
00730     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00731   }
00732   <span class="keywordflow">if</span> (bufid == PvmSysErr) 
00733   {
00734     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::recv - pvmd not responding"</span> &lt;&lt; endl;
00735     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00736   }
00737   <span class="keywordflow">if</span> (bufid &lt; 0) 
00738   {
00739     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::recv - unrecognized PVM error"</span> &lt;&lt; endl;
00740     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00741   }
00742 
00743   lastBufferId = bufid;
00744   <span class="keywordflow">return</span> (bufid != 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00745 
00746 <span class="preprocessor">#elif defined HAVE_MPI</span>
00747 <span class="preprocessor"></span>
00748   <span class="keywordflow">if</span> (msgtid == -1) 
00749     msgtid = MPI_ANY_SOURCE;
00750   <span class="keywordflow">if</span> (msgtag == -1) 
00751     msgtag = MPI_ANY_TAG;
00752 
00753   <span class="comment">// First, do a probe to find out how big to make the receive buffer</span>
00754   <span class="keywordtype">int</span> e = MPI_Probe(msgtid, msgtag, APPS_COMM, &amp;status);
00755   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00756   {
00757     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::recv - error calling probe"</span> &lt;&lt; endl;
00758     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00759   }
00760   msgSize = mpiGetMsgSize(status, MPI_PACKED);
00761 
00762   <span class="comment">// Create the buffer.</span>
00763   <span class="keyword">delete</span>[] recvBuffer;
00764   recvBuffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[msgSize];
00765 
00766   <span class="comment">// Receive the message</span>
00767   MPI_Recv(recvBuffer, msgSize, MPI_PACKED, msgtid, msgtag, APPS_COMM, &amp;status);
00768 
00769   <span class="comment">// QUESTION: Should the value of status or some error code be</span>
00770   <span class="comment">// checked here?</span>
00771 
00772   <span class="comment">// The value recvPosition is incremented as the message is read via</span>
00773   <span class="comment">// calls to unpack. Set it to 0 so we can start reading at the</span>
00774   <span class="comment">// beginning of the message.</span>
00775   recvPosition = 0;
00776 
00777   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00778 
00779 <span class="preprocessor">#else</span>
00780 <span class="preprocessor"></span>
00781    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::recv requires PVM or MPI"</span> &lt;&lt; endl;
00782    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00783 
00784 <span class="preprocessor">#endif</span>
00785 <span class="preprocessor"></span>}
00786 
<a name="l00787"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_4">00787</a> <span class="keywordtype">bool</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_4">GCI::nrecv</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> msgtid)
00788 {
00789   <span class="comment">// Non-blocking receive for a message with the given tag and task</span>
00790   <span class="comment">// id.  The inputs msgtag and msgtid default to -1 (wildcard).</span>
00791   <span class="comment">// Returns the buffer id of the message, if any, and 0 otherwise.</span>
00792 
00793 <span class="preprocessor">#ifdef HAVE_PVM</span>
00794 <span class="preprocessor"></span>
00795   <span class="keywordtype">int</span> bufid = pvm_nrecv(msgtid, msgtag);
00796 
00797   <span class="keywordflow">if</span> (bufid == PvmBadParam) 
00798   {
00799     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::nrecv - invalid parameter"</span> &lt;&lt; endl;
00800     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00801   }
00802   <span class="keywordflow">if</span> (bufid == PvmSysErr) 
00803   {
00804     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::nrecv - pvmd not responding"</span> &lt;&lt; endl;
00805     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00806   }
00807   <span class="keywordflow">if</span> (bufid &lt; 0) 
00808   {
00809     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::nrecv - unrecognized PVM error"</span> &lt;&lt; endl;
00810     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00811   }
00812  
00813   lastBufferId = bufid;
00814   <span class="keywordflow">return</span> (bufid != 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00815 
00816 <span class="preprocessor">#else</span>
00817 <span class="preprocessor"></span>
00818    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::nrecv requires PVM"</span> &lt;&lt; endl;
00819    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00820 
00821 <span class="preprocessor">#endif</span>
00822 <span class="preprocessor"></span>}
00823 
<a name="l00824"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_5">00824</a> <span class="keywordtype">bool</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_5">GCI::probe</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> msgtid)
00825 {
00826   <span class="comment">// Non-blocking probe for a message with the specified message tag</span>
00827   <span class="comment">// and task id. Returns the buffer id of the message for PVM or 1</span>
00828   <span class="comment">// for MPI, if any, and 0 otherwise. The inputs msgtag and msgtid</span>
00829   <span class="comment">// default to -1 (wildcard).</span>
00830 
00831 <span class="preprocessor">#ifdef HAVE_PVM</span>
00832 <span class="preprocessor"></span>
00833   <span class="keywordtype">int</span> bufid = pvm_probe(msgtid, msgtag);
00834 
00835   <span class="keywordflow">if</span> (bufid == PvmBadParam) 
00836   {
00837     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::probe - invalid msgtid or msgtag"</span> &lt;&lt; endl;
00838     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00839   }
00840   <span class="keywordflow">if</span> (bufid == PvmSysErr) 
00841   {
00842     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::probe - pvmd not responding"</span> &lt;&lt; endl;
00843     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00844   }
00845   <span class="keywordflow">if</span> (bufid &lt; 0) 
00846   {
00847     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::probe - unrecognized PVM error"</span> &lt;&lt; endl;
00848     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00849   }
00850   
00851   lastBufferId = bufid;
00852   <span class="keywordflow">return</span> (bufid != 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00853 
00854 <span class="preprocessor">#elif defined HAVE_MPI</span>
00855 <span class="preprocessor"></span>
00856   <span class="keywordtype">int</span> iflag;
00857 
00858   <span class="keywordflow">if</span> (msgtid == -1) 
00859     msgtid = MPI_ANY_SOURCE;
00860   <span class="keywordflow">if</span> (msgtag == -1)
00861     msgtag = MPI_ANY_TAG;
00862 
00863   <span class="comment">// MPI sets iflag = 1 if there is a matching message, 0 if not.</span>
00864   <span class="keywordtype">int</span> e = MPI_Iprobe(msgtid, msgtag, APPS_COMM, &amp;iflag, &amp;status);
00865 
00866   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00867   {
00868     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::probe - error in MPI iprobe"</span> &lt;&lt; endl;
00869     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00870   }
00871 
00872   <span class="keywordflow">return</span> (iflag == 1) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00873 
00874 <span class="preprocessor">#else</span>
00875 <span class="preprocessor"></span>
00876    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::probe requires PVM or MPI"</span> &lt;&lt; endl;
00877    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00878 
00879 <span class="preprocessor">#endif</span>
00880 <span class="preprocessor"></span>}
00881 
<a name="l00882"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_6">00882</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_6">GCI::bprobe</a>(<span class="keywordtype">int</span> msgtag, <span class="keywordtype">int</span> msgtid) 
00883 { 
00884   <span class="comment">// Do a blocking probe for a message with tag msgtag and from</span>
00885   <span class="comment">// process msgtid. The default values of msgtag and msgtid are both</span>
00886   <span class="comment">// -1.</span>
00887 
00888 <span class="preprocessor">#ifdef HAVE_MPI</span>
00889 <span class="preprocessor"></span>
00890   <span class="keywordflow">if</span> (msgtid == -1) 
00891     msgtid = MPI_ANY_SOURCE;
00892   <span class="keywordflow">if</span> (msgtag == -1) 
00893     msgtag = MPI_ANY_TAG;
00894 
00895   <span class="keywordtype">int</span> e = MPI_Probe(msgtid, msgtag, APPS_COMM, &amp;status);
00896   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00897   {
00898     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bprobe - error in MPI probe"</span> &lt;&lt; endl;
00899     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00900   }
00901 
00902 <span class="preprocessor">#else</span>
00903 <span class="preprocessor"></span>
00904    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bprobe requires MPI"</span> &lt;&lt; endl;
00905    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00906 
00907 <span class="preprocessor">#endif</span>
00908 <span class="preprocessor"></span>}
00909 
<a name="l00910"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z13_7">00910</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z13_7">GCI::bufinfo</a>(<span class="keywordtype">int</span>&amp; msgtag, <span class="keywordtype">int</span>&amp; msgtid)
00911 {
00912   <span class="comment">// Determine the msgtag and msgtid for the most recently probed or</span>
00913   <span class="comment">// received message.</span>
00914   
00915 <span class="preprocessor">#ifdef HAVE_PVM</span>
00916 <span class="preprocessor"></span>
00917   <span class="keywordflow">if</span> (lastBufferId == 0) 
00918   {
00919     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bufinfo called without first doing recv or probe"</span> &lt;&lt; endl;
00920     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00921   }
00922 
00923   <span class="keywordtype">int</span> bytes;
00924   <span class="keywordtype">int</span> info = pvm_bufinfo(lastBufferId, &amp;bytes, &amp;msgtag, &amp;msgtid);
00925   
00926   <span class="keywordflow">if</span> (info == PvmNoSuchBuf) 
00927   {
00928     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bufinfo - specified PVM buffer does not exist"</span> &lt;&lt; endl;
00929     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00930   }
00931   <span class="keywordflow">if</span> (info == PvmBadParam) 
00932   {
00933     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bufinfo - invalid argument to pvm_bufinfo"</span> &lt;&lt; endl;
00934     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00935   }
00936   <span class="keywordflow">if</span> (info &lt; 0) 
00937   {
00938     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bufinfo - unrecognized PVM error"</span> &lt;&lt; endl;
00939     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00940   }
00941 
00942 <span class="preprocessor">#elif defined HAVE_MPI</span>
00943 <span class="preprocessor"></span>
00944   msgtag = status.MPI_TAG;
00945   msgtid = status.MPI_SOURCE;
00946 
00947 <span class="preprocessor">#else</span>
00948 <span class="preprocessor"></span>
00949    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::bufinfo requires PVM or MPI"</span> &lt;&lt; endl;
00950    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00951 
00952 <span class="preprocessor">#endif</span>
00953 <span class="preprocessor"></span>}
00954 
00955 <span class="comment">// ----------------------------------------------------------------------</span>
00956 <span class="comment">// Pack &amp; Unpack</span>
00957 <span class="comment">// ----------------------------------------------------------------------</span>
00958 
<a name="l00959"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">00959</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">int</span> i)
00960 {
00961  <span class="comment">// Pack a single integer.</span>
00962 
00963 <span class="preprocessor">#ifdef HAVE_PVM</span>
00964 <span class="preprocessor"></span>
00965   pvmPackCheck(pvm_pkint(&amp;i, 1, 1));
00966 
00967 <span class="preprocessor">#elif defined HAVE_MPI</span>
00968 <span class="preprocessor"></span>
00969   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>);
00970   mpiStretchSendBuffer(bufsize);
00971   <span class="keywordtype">int</span> e = MPI_Pack(&amp;i, 1, MPI_INT, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
00972   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
00973   {
00974     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
00975     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00976   }
00977 
00978 <span class="preprocessor">#else</span>
00979 <span class="preprocessor"></span>
00980    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
00981    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
00982 
00983 <span class="preprocessor">#endif</span>
00984 <span class="preprocessor"></span>}
00985 
<a name="l00986"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_1">00986</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">char</span> i)
00987 {
00988  <span class="comment">// Pack a single chareger.</span>
00989 
00990 <span class="preprocessor">#ifdef HAVE_PVM</span>
00991 <span class="preprocessor"></span>
00992   pvmPackCheck(pvm_pkbyte(&amp;i, 1, 1));
00993 
00994 <span class="preprocessor">#elif defined HAVE_MPI</span>
00995 <span class="preprocessor"></span>
00996   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);
00997   mpiStretchSendBuffer(bufsize);
00998   <span class="keywordtype">int</span> e = MPI_Pack(&amp;i, 1, MPI_CHAR, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
00999   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01000   {
01001     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01002     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01003   }
01004 
01005 <span class="preprocessor">#else</span>
01006 <span class="preprocessor"></span>
01007    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01008    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01009 
01010 <span class="preprocessor">#endif</span>
01011 <span class="preprocessor"></span>}
01012 
<a name="l01013"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_2">01013</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">double</span> d)
01014 {
01015   <span class="comment">// Pack a single double.</span>
01016 
01017 <span class="preprocessor">#ifdef HAVE_PVM</span>
01018 <span class="preprocessor"></span>
01019   pvmPackCheck(pvm_pkdouble(&amp;d, 1, 1));
01020 
01021 <span class="preprocessor">#elif defined HAVE_MPI</span>
01022 <span class="preprocessor"></span>
01023   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>);
01024   mpiStretchSendBuffer(bufsize);
01025 
01026   <span class="keywordtype">int</span> e = MPI_Pack(&amp;d, 1, MPI_DOUBLE, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01027   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01028   {
01029     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01030     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01031   }
01032 
01033 <span class="preprocessor">#else</span>
01034 <span class="preprocessor"></span>   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01035    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01036 
01037 <span class="preprocessor">#endif</span>
01038 <span class="preprocessor"></span>}
01039 
<a name="l01040"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_3">01040</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">float</span> d)
01041 {
01042   <span class="comment">// Pack a single float.</span>
01043 
01044 <span class="preprocessor">#ifdef HAVE_PVM</span>
01045 <span class="preprocessor"></span>
01046   pvmPackCheck(pvm_pkfloat(&amp;d, 1, 1));
01047 
01048 <span class="preprocessor">#elif defined HAVE_MPI</span>
01049 <span class="preprocessor"></span>
01050   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>);
01051   mpiStretchSendBuffer(bufsize);
01052 
01053   <span class="keywordtype">int</span> e = MPI_Pack(&amp;d, 1, MPI_FLOAT, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01054   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01055   {
01056     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01057     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01058   }
01059 
01060 <span class="preprocessor">#else</span>
01061 <span class="preprocessor"></span>   cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01062    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01063 
01064 <span class="preprocessor">#endif</span>
01065 <span class="preprocessor"></span>}
01066 
01067 <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* s)
01068 {
01069   <span class="comment">// Pack character array WITH its length first</span>
01070 
01071 <span class="preprocessor">#ifdef HAVE_PVM</span>
01072 <span class="preprocessor"></span>
01073   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>((<span class="keywordtype">int</span>)strlen(s));
01074   pvmPackCheck(pvm_pkstr(const_cast&lt;char*&gt;(s)));
01075 
01076 <span class="preprocessor">#elif defined HAVE_MPI</span>
01077 <span class="preprocessor"></span>
01078   <span class="comment">// Calculate length of string including terminator '\O'</span>
01079   <span class="keywordtype">int</span> n = strlen(s) + 1;
01080 
01081   <span class="comment">// Pack string length</span>
01082   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01083 
01084   <span class="comment">// Pack the string itself</span>
01085   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * n; 
01086   mpiStretchSendBuffer(bufsize);
01087 
01088   <span class="keywordtype">int</span> e = MPI_Pack(const_cast&lt;char*&gt;(s), n, MPI_CHAR, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01089   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01090   {
01091     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01092     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01093   }
01094 
01095 <span class="preprocessor">#else</span>
01096 <span class="preprocessor"></span>
01097    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01098    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01099 
01100 <span class="preprocessor">#endif</span>
01101 <span class="preprocessor"></span>}
01102 
<a name="l01103"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_4">01103</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">bool</span> b)
01104 {
01105   <span class="comment">// Pack a single bool. Bools are packed as ints because neither PVM</span>
01106   <span class="comment">// nor MPI can handle the bool datatype.</span>
01107 
01108   <span class="keywordtype">int</span> fakebool = (<span class="keywordtype">int</span>) b;
01109 
01110 <span class="preprocessor">#ifdef HAVE_PVM</span>
01111 <span class="preprocessor"></span>
01112   pvmPackCheck(pvm_pkint(&amp;fakebool, 1, 1));
01113 
01114 <span class="preprocessor">#elif defined HAVE_MPI</span>
01115 <span class="preprocessor"></span>
01116   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(fakebool);
01117 
01118 <span class="preprocessor">#else</span>
01119 <span class="preprocessor"></span>
01120    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01121    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01122 
01123 <span class="preprocessor">#endif</span>
01124 <span class="preprocessor"></span>}
01125 
<a name="l01126"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_5">01126</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> string s)
01127 {
01128 
01129   <span class="comment">// Pack a string.</span>
01130 
01131 <span class="preprocessor">#if defined HAVE_PVM || defined HAVE_MPI</span>
01132 <span class="preprocessor"></span>
01133   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(s.c_str());
01134 
01135 <span class="preprocessor">#else</span>
01136 <span class="preprocessor"></span>
01137    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM or MPI"</span> &lt;&lt; endl;
01138    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01139 
01140 <span class="preprocessor">#endif</span>
01141 <span class="preprocessor"></span>}
01142 
<a name="l01143"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_6">01143</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> vector&lt;int&gt;&amp; v)
01144 {
01145   <span class="keywordtype">int</span> n = v.size();
01146   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01147   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01148     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(v[i]);
01149 }
01150 
<a name="l01151"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_7">01151</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; v)
01152 {
01153   <span class="keywordtype">int</span> n = v.size();
01154   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01155   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01156     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(v[i]);
01157 }
01158 
<a name="l01159"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_9">01159</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> vector&lt; vector&lt;double&gt; &gt;&amp; v)
01160 {
01161   <span class="keywordtype">int</span> n = v.size();
01162   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01163   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01164     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(v[i]);
01165 }
01166 
<a name="l01167"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_10">01167</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> vector&lt;string&gt;&amp; v)
01168 {
01169   <span class="keywordtype">int</span> n = v.size();
01170   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01171   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01172     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(v[i]);
01173 }
01174 
<a name="l01175"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_11">01175</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keyword">const</span> vector&lt;bool&gt;&amp; v)
01176 {
01177   <span class="comment">// Bool vectors must be handled specially because they are stored is</span>
01178   <span class="comment">// a compacted format.</span>
01179   <span class="keywordtype">int</span> n = v.size();
01180   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(n);
01181   <span class="keywordtype">int</span> tmp;
01182   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++) 
01183   {
01184     tmp = (<span class="keywordtype">int</span>) v[i];
01185     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(tmp);
01186   }
01187 }    
01188 
<a name="l01189"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_12">01189</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">int</span> length, <span class="keyword">const</span> <span class="keywordtype">char</span>* array)
01190 {
01191   <span class="comment">// Pack array WITH its length first</span>
01192 
01193 <span class="preprocessor">#ifdef HAVE_PVM</span>
01194 <span class="preprocessor"></span>
01195   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01196   pvmPackCheck(pvm_pkbyte(const_cast&lt;char*&gt;(array), length, 1));
01197 
01198 <span class="preprocessor">#elif defined HAVE_MPI</span>
01199 <span class="preprocessor"></span>
01200   <span class="comment">// Pack array length</span>
01201   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01202 
01203   <span class="comment">// Pack the array itself</span>
01204   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * length; 
01205   mpiStretchSendBuffer(bufsize);
01206 
01207   <span class="keywordtype">int</span> e = MPI_Pack(const_cast&lt;char*&gt;(array), length, MPI_CHAR, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01208   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01209   {
01210     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01211     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01212   }
01213 
01214 <span class="preprocessor">#else</span>
01215 <span class="preprocessor"></span>
01216    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01217    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01218 
01219 <span class="preprocessor">#endif</span>
01220 <span class="preprocessor"></span>}
01221 
<a name="l01222"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_13">01222</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">int</span> length, <span class="keyword">const</span> <span class="keywordtype">int</span>* array)
01223 {
01224   <span class="comment">// Pack array WITH its length first</span>
01225 
01226 <span class="preprocessor">#ifdef HAVE_PVM</span>
01227 <span class="preprocessor"></span>
01228   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01229   pvmPackCheck(pvm_pkint(const_cast&lt;int*&gt;(array), length, 1));
01230 
01231 <span class="preprocessor">#elif defined HAVE_MPI</span>
01232 <span class="preprocessor"></span>
01233   <span class="comment">// Pack array length</span>
01234   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01235 
01236   <span class="comment">// Pack the array itself</span>
01237   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * length; 
01238   mpiStretchSendBuffer(bufsize);
01239 
01240   <span class="keywordtype">int</span> e = MPI_Pack((<span class="keywordtype">int</span>*)array, length, MPI_INT, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01241   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01242   {
01243     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01244     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01245   }
01246 
01247 <span class="preprocessor">#else</span>
01248 <span class="preprocessor"></span>
01249    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01250    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01251 
01252 <span class="preprocessor">#endif</span>
01253 <span class="preprocessor"></span>}
01254 
<a name="l01255"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_14">01255</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">int</span> length, <span class="keyword">const</span> <span class="keywordtype">double</span>* array)
01256 {
01257   <span class="comment">// Pack array WITH its length first</span>
01258 
01259 <span class="preprocessor">#ifdef HAVE_PVM</span>
01260 <span class="preprocessor"></span>
01261   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01262   pvmPackCheck(pvm_pkdouble((<span class="keywordtype">double</span>*) array, length, 1));
01263 
01264 <span class="preprocessor">#elif defined HAVE_MPI</span>
01265 <span class="preprocessor"></span>
01266   <span class="comment">// Pack array length</span>
01267   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01268 
01269   <span class="comment">// Pack the array itself</span>
01270   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * length; 
01271   mpiStretchSendBuffer(bufsize);
01272 
01273   <span class="keywordtype">int</span> e = MPI_Pack((<span class="keywordtype">double</span>*)array, length, MPI_DOUBLE, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01274   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01275   {
01276     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01277     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01278   }
01279 
01280 <span class="preprocessor">#else</span>
01281 <span class="preprocessor"></span>
01282    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01283    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01284 
01285 <span class="preprocessor">#endif</span>
01286 <span class="preprocessor"></span>}
01287 
01288 
<a name="l01289"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_15">01289</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">GCI::pack</a>(<span class="keywordtype">int</span> length, <span class="keyword">const</span> <span class="keywordtype">float</span>* array)
01290 {
01291   <span class="comment">// Pack array WITH its length first</span>
01292 
01293 <span class="preprocessor">#ifdef HAVE_PVM</span>
01294 <span class="preprocessor"></span>
01295   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01296   pvmPackCheck(pvm_pkfloat((<span class="keywordtype">float</span>*) array, length, 1));
01297 
01298 <span class="preprocessor">#elif defined HAVE_MPI</span>
01299 <span class="preprocessor"></span>
01300   <span class="comment">// Pack array length</span>
01301   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_0">pack</a>(length);
01302 
01303   <span class="comment">// Pack the array itself</span>
01304   <span class="keywordtype">int</span> bufsize = sendPosition + <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * length; 
01305   mpiStretchSendBuffer(bufsize);
01306 
01307   <span class="keywordtype">int</span> e = MPI_Pack((<span class="keywordtype">float</span>*)array, length, MPI_FLOAT, sendBuffer, bufsize, &amp;sendPosition, APPS_COMM);
01308   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01309   {
01310     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - error in MPI pack"</span> &lt;&lt; endl;
01311     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01312   }
01313 
01314 <span class="preprocessor">#else</span>
01315 <span class="preprocessor"></span>
01316    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack requires PVM of MPI"</span> &lt;&lt; endl;
01317    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01318 
01319 <span class="preprocessor">#endif</span>
01320 <span class="preprocessor"></span>}
01321 
<a name="l01322"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">01322</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">int</span>&amp; i)
01323 {
01324   <span class="comment">// Unpack a single integer</span>
01325 
01326 <span class="preprocessor">#ifdef HAVE_PVM</span>
01327 <span class="preprocessor"></span>
01328   pvmUnpackCheck(pvm_upkint(&amp;i, 1, 1));
01329 
01330 <span class="preprocessor">#elif defined HAVE_MPI</span>
01331 <span class="preprocessor"></span>
01332   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, &amp;i, 1, MPI_INT, APPS_COMM);
01333   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01334   {
01335     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01336     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01337   }
01338 
01339 <span class="preprocessor">#else</span>
01340 <span class="preprocessor"></span>
01341    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01342    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01343 
01344 <span class="preprocessor">#endif</span>
01345 <span class="preprocessor"></span>}
01346 
<a name="l01347"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_17">01347</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">char</span>&amp; i)
01348 {
01349   <span class="comment">// Unpack a single integer</span>
01350 
01351 <span class="preprocessor">#ifdef HAVE_PVM</span>
01352 <span class="preprocessor"></span>
01353   pvmUnpackCheck(pvm_upkbyte(&amp;i, 1, 1));
01354 
01355 <span class="preprocessor">#elif defined HAVE_MPI</span>
01356 <span class="preprocessor"></span>
01357   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, &amp;i, 1, MPI_CHAR, APPS_COMM);
01358   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01359   {
01360     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01361     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01362   }
01363 
01364 <span class="preprocessor">#else</span>
01365 <span class="preprocessor"></span>
01366    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01367    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01368 
01369 <span class="preprocessor">#endif</span>
01370 <span class="preprocessor"></span>}
01371 
<a name="l01372"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_18">01372</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">double</span>&amp; d)
01373 {
01374   <span class="comment">// Unpack a single double</span>
01375 
01376 <span class="preprocessor">#ifdef HAVE_PVM</span>
01377 <span class="preprocessor"></span>
01378   pvmUnpackCheck(pvm_upkdouble(&amp;d, 1, 1));
01379 
01380 <span class="preprocessor">#elif defined HAVE_MPI</span>
01381 <span class="preprocessor"></span>
01382   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, &amp;d, 1, MPI_DOUBLE, APPS_COMM);
01383   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01384   {
01385     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01386     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01387   }
01388 
01389 <span class="preprocessor">#else</span>
01390 <span class="preprocessor"></span>
01391    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01392    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01393 
01394 <span class="preprocessor">#endif</span>
01395 <span class="preprocessor"></span>}
01396 
<a name="l01397"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_19">01397</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">float</span>&amp; d)
01398 {
01399   <span class="comment">// Unpack a single float</span>
01400 
01401 <span class="preprocessor">#ifdef HAVE_PVM</span>
01402 <span class="preprocessor"></span>
01403   pvmUnpackCheck(pvm_upkfloat(&amp;d, 1, 1));
01404 
01405 <span class="preprocessor">#elif defined HAVE_MPI</span>
01406 <span class="preprocessor"></span>
01407   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, &amp;d, 1, MPI_FLOAT, APPS_COMM);
01408   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01409   {
01410     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01411     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01412   }
01413 
01414 <span class="preprocessor">#else</span>
01415 <span class="preprocessor"></span>
01416    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01417    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01418 
01419 <span class="preprocessor">#endif</span>
01420 <span class="preprocessor"></span>}
01421 
01422 <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">char</span>*&amp; s)
01423 {
01424   <span class="comment">// Unpack char array s. If s is NULL, memory is allocated for it. If</span>
01425   <span class="comment">// not, the length of s is checked to be sure it's large enough.</span>
01426 
01427   <span class="keywordtype">int</span> len;
01428   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(len);
01429 
01430   <span class="keywordflow">if</span> (!s) 
01431     s = <span class="keyword">new</span> <span class="keywordtype">char</span>[len];
01432   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)strlen(s)) &lt; len) 
01433   {
01434     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - string is too small for unpack"</span> &lt;&lt; endl;
01435     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01436   }
01437 
01438 <span class="preprocessor">#ifdef HAVE_PVM</span>
01439 <span class="preprocessor"></span>
01440   pvmUnpackCheck(pvm_upkstr(s));
01441 
01442 <span class="preprocessor">#elif defined HAVE_MPI</span>
01443 <span class="preprocessor"></span>
01444   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, s, len, MPI_CHAR, APPS_COMM);
01445   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01446   {
01447     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01448     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01449   }
01450 
01451 <span class="preprocessor">#else</span>
01452 <span class="preprocessor"></span>
01453    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01454    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01455 
01456 <span class="preprocessor">#endif</span>
01457 <span class="preprocessor"></span>}
01458 
<a name="l01459"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_20">01459</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">bool</span>&amp; b)
01460 {
01461   <span class="comment">// Unpack a single boolean.</span>
01462 
01463 <span class="preprocessor">#ifdef HAVE_PVM</span>
01464 <span class="preprocessor"></span>
01465   <span class="keywordtype">int</span> bfake;
01466   pvmUnpackCheck(pvm_upkint(&amp;bfake, 1, 1));
01467   b = (<span class="keywordtype">bool</span>) bfake;
01468 
01469 <span class="preprocessor">#elif defined HAVE_MPI</span>
01470 <span class="preprocessor"></span>
01471   <span class="keywordtype">int</span> bfake;
01472   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, &amp;bfake, 1, MPI_INT, APPS_COMM);
01473   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01474   {
01475     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01476     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01477   }
01478 
01479   b = (<span class="keywordtype">bool</span>) bfake;
01480 
01481 <span class="preprocessor">#else</span>
01482 <span class="preprocessor"></span>
01483    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01484    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01485 
01486 <span class="preprocessor">#endif</span>
01487 <span class="preprocessor"></span>}
01488 
<a name="l01489"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_21">01489</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(string&amp; s)
01490 {
01491 
01492 <span class="preprocessor">#if defined HAVE_PVM || defined HAVE_MPI</span>
01493 <span class="preprocessor"></span>
01494 <span class="preprocessor">#ifdef DEBUG</span>
01495 <span class="preprocessor"></span>  cout &lt;&lt; <span class="stringliteral">"Unpacking a string"</span> &lt;&lt; endl;
01496 <span class="preprocessor">#endif</span>
01497 <span class="preprocessor"></span>
01498   <span class="keywordtype">char</span>* tmp = NULL;
01499   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(tmp);
01500 
01501 <span class="preprocessor">#ifdef DEBUG</span>
01502 <span class="preprocessor"></span>  cout &lt;&lt; <span class="stringliteral">"Unpacking a string="</span> &lt;&lt; tmp &lt;&lt; endl;
01503 <span class="preprocessor">#endif</span>
01504 <span class="preprocessor"></span>
01505   s = tmp;
01506 
01507 <span class="preprocessor">#ifdef DEBUG</span>
01508 <span class="preprocessor"></span>  cout &lt;&lt; <span class="stringliteral">"Unpacking a string="</span> &lt;&lt; s &lt;&lt; endl;
01509 <span class="preprocessor">#endif</span>
01510 <span class="preprocessor"></span>
01511 
01512   <span class="keywordflow">try</span>
01513   {
01514     <span class="keyword">delete</span> [] tmp;
01515   }
01516   <span class="keywordflow">catch</span>(...)
01517   {
01518   }
01519   
01520 <span class="preprocessor">#ifdef DEBUG</span>
01521 <span class="preprocessor"></span>  cout &lt;&lt; <span class="stringliteral">"Unpacking a string="</span> &lt;&lt; s &lt;&lt; endl;
01522 <span class="preprocessor">#endif</span>
01523 <span class="preprocessor"></span>
01524 <span class="preprocessor">#else</span>
01525 <span class="preprocessor"></span>
01526    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01527    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01528 
01529 <span class="preprocessor">#endif</span>
01530 <span class="preprocessor"></span>}
01531 
<a name="l01532"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_22">01532</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(vector&lt;int&gt;&amp; v)
01533 {
01534   <span class="keywordtype">int</span> n;
01535   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(n);
01536   v.resize(n);
01537   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01538     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(v[i]);
01539 }
01540 
<a name="l01541"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_23">01541</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(vector&lt;double&gt;&amp; v)
01542 {
01543   <span class="keywordtype">int</span> n;
01544   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(n);
01545   v.resize(n);
01546   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01547     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(v[i]);
01548 }
01549 
<a name="l01550"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_24">01550</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(vector&lt; vector&lt;double&gt; &gt;&amp; v)
01551 {
01552   <span class="keywordtype">int</span> n;
01553   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(n);
01554   v.resize(n);
01555   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01556     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(v[i]);
01557 }
01558 
<a name="l01559"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_25">01559</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(vector&lt;string&gt;&amp; v)
01560 {
01561   <span class="keywordtype">int</span> n;
01562   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(n);
01563   v.resize(n);
01564   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++)
01565     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(v[i]);
01566 }
01567 
01568 
<a name="l01569"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_26">01569</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(vector&lt;bool&gt;&amp; v)
01570 {
01571   <span class="comment">// Bool vectors must be handled specially because they are stored is</span>
01572   <span class="comment">// a compacted format.</span>
01573   <span class="keywordtype">int</span> n;
01574   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(n);
01575   v.resize(n);
01576   <span class="keywordtype">int</span> tmp;
01577   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i ++) 
01578   {
01579     <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(tmp);
01580     v[i] = (<span class="keywordtype">bool</span>) tmp;
01581   }
01582 }    
01583 
<a name="l01584"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_27">01584</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">int</span>&amp; length, <span class="keywordtype">char</span>*&amp; array)
01585 {
01586   <span class="comment">// Unpack array s. If s is NULL, memory is allocated for it. If</span>
01587   <span class="comment">// not, the length of s is checked to be sure it's large enough.</span>
01588 
01589   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(length);
01590   array = <span class="keyword">new</span> <span class="keywordtype">char</span>[length];
01591 
01592 <span class="preprocessor">#ifdef HAVE_PVM</span>
01593 <span class="preprocessor"></span>
01594   pvmUnpackCheck(pvm_upkbyte(array, length, 1));
01595 
01596 <span class="preprocessor">#elif defined HAVE_MPI</span>
01597 <span class="preprocessor"></span>
01598   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, array, length, MPI_CHAR, APPS_COMM);
01599   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01600   {
01601     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01602     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01603   }
01604 
01605 <span class="preprocessor">#else</span>
01606 <span class="preprocessor"></span>
01607    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01608    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01609 
01610 <span class="preprocessor">#endif</span>
01611 <span class="preprocessor"></span>}
01612 
<a name="l01613"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_28">01613</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">int</span>&amp; length, <span class="keywordtype">int</span>*&amp; array)
01614 {
01615   <span class="comment">// Unpack array s. If s is NULL, memory is allocated for it. If</span>
01616   <span class="comment">// not, the length of s is checked to be sure it's large enough.</span>
01617 
01618   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(length);
01619   array = <span class="keyword">new</span> <span class="keywordtype">int</span>[length];
01620 
01621 <span class="preprocessor">#ifdef HAVE_PVM</span>
01622 <span class="preprocessor"></span>
01623   pvmUnpackCheck(pvm_upkint(array, length, 1));
01624 
01625 <span class="preprocessor">#elif defined HAVE_MPI</span>
01626 <span class="preprocessor"></span>
01627   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, array, length, MPI_INT, APPS_COMM);
01628   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01629   {
01630     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01631     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01632   }
01633 
01634 <span class="preprocessor">#else</span>
01635 <span class="preprocessor"></span>
01636    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01637    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01638 
01639 <span class="preprocessor">#endif</span>
01640 <span class="preprocessor"></span>}
01641 
<a name="l01642"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_29">01642</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">int</span>&amp; length, <span class="keywordtype">double</span>*&amp; array)
01643 {
01644   <span class="comment">// Unpack array s. If s is NULL, memory is allocated for it. If</span>
01645   <span class="comment">// not, the length of s is checked to be sure it's large enough.</span>
01646 
01647   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(length);
01648   array = <span class="keyword">new</span> <span class="keywordtype">double</span>[length];
01649 
01650 <span class="preprocessor">#ifdef HAVE_PVM</span>
01651 <span class="preprocessor"></span>
01652   pvmUnpackCheck(pvm_upkdouble(array, length, 1));
01653 
01654 <span class="preprocessor">#elif defined HAVE_MPI</span>
01655 <span class="preprocessor"></span>
01656   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, array, length, MPI_DOUBLE, APPS_COMM);
01657   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01658   {
01659     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01660     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01661   }
01662 
01663 <span class="preprocessor">#else</span>
01664 <span class="preprocessor"></span>
01665    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01666    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01667 
01668 <span class="preprocessor">#endif</span>
01669 <span class="preprocessor"></span>}
01670 
<a name="l01671"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z15_30">01671</a> <span class="keywordtype">void</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">GCI::unpack</a>(<span class="keywordtype">int</span>&amp; length, <span class="keywordtype">float</span>*&amp; array)
01672 {
01673   <span class="comment">// Unpack array s. If s is NULL, memory is allocated for it. If</span>
01674   <span class="comment">// not, the length of s is checked to be sure it's large enough.</span>
01675 
01676   <a class="code" href="classAPPSPACK_1_1GCI.html#z15_16">unpack</a>(length);
01677   array = <span class="keyword">new</span> <span class="keywordtype">float</span>[length];
01678 
01679 <span class="preprocessor">#ifdef HAVE_PVM</span>
01680 <span class="preprocessor"></span>
01681   pvmUnpackCheck(pvm_upkfloat(array, length, 1));
01682 
01683 <span class="preprocessor">#elif defined HAVE_MPI</span>
01684 <span class="preprocessor"></span>
01685   <span class="keywordtype">int</span> e = MPI_Unpack(recvBuffer, msgSize, &amp;recvPosition, array, length, MPI_FLOAT, APPS_COMM);
01686   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01687   {
01688     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - error in MPI unpack"</span> &lt;&lt; endl;
01689     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01690   }
01691 
01692 <span class="preprocessor">#else</span>
01693 <span class="preprocessor"></span>
01694    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack requires PVM of MPI"</span> &lt;&lt; endl;
01695    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01696 
01697 <span class="preprocessor">#endif</span>
01698 <span class="preprocessor"></span>}
01699 
01700 <span class="comment">// ----------------------------------------------------------------------</span>
01701 <span class="comment">// Host Info</span>
01702 <span class="comment">// ----------------------------------------------------------------------</span>
01703 
<a name="l01704"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z17_0">01704</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z17_0">GCI::resetHostInfo</a>() 
01705 {
01706   <span class="comment">// Reset host information by asking PVM to update pvmHostInfo - the data</span>
01707   <span class="comment">// structure that contains the host information. Return the number</span>
01708   <span class="comment">// of hosts.</span>
01709 
01710 <span class="preprocessor">#ifdef HAVE_PVM</span>
01711 <span class="preprocessor"></span>
01712   pvmHostInfo = NULL;
01713 
01714   <span class="keywordflow">if</span> ((pvm_config(&amp;nHosts, &amp;nArch, &amp;pvmHostInfo)) &lt; 0) 
01715   {
01716     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::resetHostInfo - error from pvm_config"</span> &lt;&lt; endl;
01717     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01718   }
01719 
01720   <span class="keywordflow">return</span> nHosts;
01721 
01722 <span class="preprocessor">#else</span>
01723 <span class="preprocessor"></span>
01724    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::resetHostInfo requires PVM"</span> &lt;&lt; endl;
01725    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01726 
01727 <span class="preprocessor">#endif</span>
01728 <span class="preprocessor"></span>}
01729 
<a name="l01730"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z17_1">01730</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z17_1">GCI::getHostTid</a>(<span class="keywordtype">int</span> i) 
01731 {
01732   <span class="comment">// Get the host id of the ith host.</span>
01733 
01734 <span class="preprocessor">#ifdef HAVE_PVM</span>
01735 <span class="preprocessor"></span>
01736   <span class="keywordflow">return</span> pvmHostInfo[i].hi_tid;
01737 
01738 <span class="preprocessor">#else</span>
01739 <span class="preprocessor"></span>
01740    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getHostTid requires PVM"</span> &lt;&lt; endl;
01741    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01742 
01743 <span class="preprocessor">#endif</span>
01744 <span class="preprocessor"></span>}
01745 
<a name="l01746"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z17_2">01746</a> <span class="keywordtype">int</span> <a class="code" href="classAPPSPACK_1_1GCI.html#z17_2">GCI::getHostSpeed</a>(<span class="keywordtype">int</span> i) 
01747 {
01748   <span class="comment">// Get the speed of the ith host.</span>
01749 
01750 <span class="preprocessor">#ifdef HAVE_PVM</span>
01751 <span class="preprocessor"></span>
01752   <span class="keywordflow">return</span> pvmHostInfo[i].hi_speed;
01753 
01754 <span class="preprocessor">#else</span>
01755 <span class="preprocessor"></span>
01756    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getHostSpeed requires PVM"</span> &lt;&lt; endl;
01757    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01758 
01759 <span class="preprocessor">#endif</span>
01760 <span class="preprocessor"></span>}
01761 
<a name="l01762"></a><a class="code" href="classAPPSPACK_1_1GCI.html#z17_3">01762</a> <span class="keywordtype">char</span>* <a class="code" href="classAPPSPACK_1_1GCI.html#z17_3">GCI::getHostName</a>(<span class="keywordtype">int</span> i) 
01763 {
01764   <span class="comment">// Get the name of the ith host.</span>
01765 
01766 <span class="preprocessor">#ifdef HAVE_PVM</span>
01767 <span class="preprocessor"></span>
01768   <span class="keywordflow">return</span> pvmHostInfo[i].hi_name;
01769 
01770 <span class="preprocessor">#else</span>
01771 <span class="preprocessor"></span>
01772    cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::getHostName requires PVM"</span> &lt;&lt; endl;
01773    <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01774 
01775 <span class="preprocessor">#endif</span>
01776 <span class="preprocessor"></span>}
01777 
01778 <span class="comment">// ----------------------------------------------------------------------</span>
01779 <span class="comment">// Helper functions for PVM</span>
01780 <span class="comment">// ----------------------------------------------------------------------</span>
01781 
01782 <span class="preprocessor">#ifdef HAVE_PVM</span>
01783 <span class="preprocessor"></span>
01784 <span class="keywordtype">void</span> GCI::pvmPackCheck(<span class="keywordtype">int</span> info)        <span class="comment">// PRIVATE</span>
01785 {
01786   <span class="comment">// Check return code from pvm_pack</span>
01787 
01788   <span class="keywordflow">if</span> (info == PvmNoMem) 
01789   {
01790     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - out of memory"</span> &lt;&lt; endl;
01791     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01792   }
01793   <span class="keywordflow">if</span> (info == PvmNoBuf) 
01794   {
01795     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - no active send buffer"</span> &lt;&lt; endl;
01796     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01797   }
01798   <span class="keywordflow">if</span> (info &lt; 0) 
01799   {
01800     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::pack - unrecognized PVM error"</span> &lt;&lt; endl;
01801     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01802   }
01803 }
01804 
01805 <span class="keywordtype">void</span> GCI::pvmUnpackCheck(<span class="keywordtype">int</span> info) <span class="comment">// PRIVATE</span>
01806 {
01807   <span class="comment">// Check return code form pvm_unpack</span>
01808 
01809   <span class="keywordflow">if</span> (info == PvmNoData) 
01810   {
01811     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - reading past end of buffer"</span> &lt;&lt; endl;
01812     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01813   }
01814   <span class="keywordflow">if</span> (info == PvmBadMsg) 
01815   {
01816     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - incompatiable encoding"</span> &lt;&lt; endl;
01817     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01818   }
01819   <span class="keywordflow">if</span> (info == PvmNoBuf) 
01820   {
01821     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - no active receive buffer"</span> &lt;&lt; endl;
01822     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01823   }
01824   <span class="keywordflow">if</span> (info &lt; 0) 
01825   {
01826     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::unpack - unrecognized PVM error"</span> &lt;&lt; endl;
01827     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01828   }
01829 }
01830 
01831 <span class="preprocessor">#endif</span>
01832 <span class="preprocessor"></span>
01833 
01834 <span class="comment">// ----------------------------------------------------------------------</span>
01835 <span class="comment">// Helper functions for MPI</span>
01836 <span class="comment">// ----------------------------------------------------------------------</span>
01837 
01838 <span class="preprocessor">#ifdef HAVE_MPI</span>
01839 <span class="preprocessor"></span>
01840 <span class="keywordtype">int</span> GCI::mpiGetMsgSize(MPI_Status localstatus, MPI_Datatype datatype)
01841 {
01842   <span class="comment">// Returns the size of the message localstatus is associated with.</span>
01843   <span class="comment">// "localstatus" is so named to separate it from the global variable</span>
01844   <span class="comment">// "status."</span>
01845 
01846   <span class="keywordtype">int</span> count;
01847 
01848   <span class="comment">// This MPI call sets count = the number of items of type datatype</span>
01849   <span class="comment">// in the message. </span>
01850   <span class="keywordtype">int</span> e = MPI_Get_count(&amp;localstatus, datatype, &amp;count);
01851   <span class="keywordflow">if</span> (e != MPI_SUCCESS) 
01852   {
01853     cerr &lt;&lt; <span class="stringliteral">"APPSPACK::GCI::mpiGetMsgSize - error"</span> &lt;&lt; endl;
01854     <span class="keywordflow">throw</span> <span class="stringliteral">"APPSPACK error"</span>;
01855   }
01856 
01857   <span class="keywordflow">return</span>(count);
01858 }
01859 
01860 <span class="keywordtype">void</span> GCI::mpiStretchSendBuffer(<span class="keywordtype">int</span> bufsize)
01861 {
01862   <span class="comment">// This is a helper function for the pack methods.  It makes the</span>
01863   <span class="comment">// size of the send buffer bufsize.</span>
01864 
01865   <span class="comment">// Create new buffer</span>
01866   <span class="keywordtype">char</span>* newbuffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[bufsize];
01867   
01868   <span class="comment">// Copy old buffer into new</span>
01869   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; sendPosition; i++)
01870     newbuffer[i] = sendBuffer[i];
01871 
01872   <span class="comment">// Delete old buffer and replace with new</span>
01873   <span class="keyword">delete</span>[] sendBuffer;
01874   sendBuffer = newbuffer;
01875 }
01876 
01877 <span class="preprocessor">#endif</span>
01878 <span class="preprocessor"></span>
</div></pre><p>&nbsp;</p>

<P ALIGN="CENTER"><IMG ALIGN="CENTER"
SRC="../images/gold-rule-500x11.gif" WIDTH="557" HEIGHT="11"
BORDER="0"></P>

<P ALIGN="CENTER"><A HREF="http://www.sandia.gov/">&copy; Sandia
Corporation</A> | <A
HREF="mailto:tgkolda@sandia.gov?Subject=appspack">Site
Contact</A> | <A
HREF="http://www.sandia.gov/general/privacy-security/index.html">Privacy
and Security</A></P>

<P ALIGN="CENTER"><IMG ALIGN="CENTER"
SRC="../images/gold-rule-500x11.gif" WIDTH="557" HEIGHT="11"
BORDER="0"></P> 

<p align="center"><small>
Generated on Wed Dec 14 18:41:04 2005 for APPSPACK 4.0.2 by <a href="http://www.doxygen.org/index.html">
<img src="../images/doxygen.gif" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.8 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></p>

<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
<P>&nbsp;</p>
</DIV>
  </BODY>
</HTML>


