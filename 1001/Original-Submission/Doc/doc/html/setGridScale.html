
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>setGridScale</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-04-30"><meta name="DC.source" content="setGridScale.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>setGridScale</h1><!--introduction--><p>Sets functions seti.GD to downscale grid of ROI and seti.GU to upscale grid again.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Input Arguments</a></li><li><a href="#4">Output Arguments</a></li><li><a href="#5">More About</a></li><li><a href="#6">See Also</a></li><li><a href="#7">Code</a></li></ul></div><h2 id="1">Syntax</h2><pre class="language-matlab">seti = setGridScale(seti)
seti = setGridScale(seti,dispDepth)
</pre><h2 id="2">Description</h2><p><tt>seti = setGridScale(seti)</tt> Sets functions seti.GD to downscale grid of ROI and seti.GU to upscale grid again. The size of the down scaled ROI depends on the relation of the number of discretization points of the down scaled CD to the upscaled (full) CD.</p><p><tt>seti = setGridScale(seti,dispDepth)</tt> does the same but allows to control the depth of displayed messages by dispDepth.</p><div><ul><li>If seti.gscale = 1 grid scaling is considered.</li></ul></div><h2 id="3">Input Arguments</h2><p>If the fields was not defined, default values are set.</p><div><ul><li>seti.gscale     :   1: use a down scaled grid for reconstruction;                       0: do not use grid scaling (default)</li><li>seti.nCDinv     :   number of discretization points                       <i>of the downscaled grid</i>                       for each dimension of CD.                       (for nCD see <a href="setGrid.html">setGrid.html</a>).                       (default: <tt>floor(seti.nCD/2)</tt>).</li></ul></div><p><b>Optional Input Argument</b></p><div><ul><li>dispDepth   : Depth of displayed messages (0: no, 1 or greater: yes).</li></ul></div><h2 id="4">Output Arguments</h2><div><ul><li>seti.nInv   :   The analogue to seti.nROI, see <a href="setGrid.html">setGrid.html</a>, for the downscaled grid.</li><li>seti.hInv   :   The analogue to seti.h, see <a href="setGrid.html">setGrid.html</a>, for the downscaled grid.</li><li>seti.dVinv  :   The analogoue to seti.dV, see <a href="setGrid.html">setGrid.html</a>, for the downscaled grid.</li><li>seti.GInv   :   The analogue to seti.G, see <a href="setReshapeVecMat.html">setReshapeVecMat.html</a>, for the downscaled grid.</li></ul></div><div><ul><li>seti.GU     :   function to scale up the grid                   (input: down scaled contrast as a vector of size seti.nInv^seti.dim;                   output: up scaled contrast as a vector of size seti.nROI^seti.dim)</li><li>seti.GD     :   function to scale down the grid                   (input: up scaled contrast as a vector of size seti.nROI^seti.dim;                   output: down scaled contrast as a vector of size seti.nInv^seti.dim)</li></ul></div><h2 id="5">More About</h2><p><b>Process in the program</b></p><div><ol><li>seti.GInv or seti.G writes vector as matrix.</li><li>Scaling by gridUp or gridDown, see <a href="gridUp.html">gridUp.html</a>, <a href="gridDown.html">gridDown.html</a>.</li><li>seti.iG writes matrix as vector again.</li></ol></div><p>Grid scaling is used in <a href="pda.html">pda.html</a>.</p><p><b>The size of the down scaled grid...</b></p><div><ul><li>Note that ROI is down scaled and not the grid of CD.</li><li>Therefore the size of the down scaled grid is smaller than seti.nCDinv^seti.dim.</li><li>So, <tt>seti.nInv = round(seti.nROI/seti.nCD*seti.nCDinv)</tt>.</li></ul></div><h2 id="6">See Also</h2><div><ul><li><a href="setGrid.html">setGrid.html</a></li><li><a href="setGeomSim.html">setGeomSim.html</a></li><li><a href="pda.html">pda.html</a></li></ul></div><div><ul><li><a href="gridUp.html">gridUp.html</a></li><li><a href="gridDown.html">gridDown.html</a></li></ul></div><h2 id="7">Code</h2><pre class="codeinput"><span class="keyword">function</span> seti = setGridScale(seti,varargin)
</pre><pre class="codeinput"><span class="keyword">if</span> nargin == 2
    dispDepth = varargin{1};
<span class="keyword">else</span>
    dispDepth = 0;
<span class="keyword">end</span>
</pre><p><b>Check consistency</b></p><pre class="codeinput">seti = checkfield(seti,<span class="string">'gscale'</span>,0,dispDepth);

<span class="keyword">if</span> (seti.gscale == 1) &amp;&amp; ~isfield(seti,<span class="string">'nCDinv'</span>)
    seti.nCDinv = floor(seti.nCD/2);
    setmessage(seti,<span class="string">'nCDinv'</span>,dispDepth);
<span class="keyword">end</span>
</pre><p><b>Set hInv, dVinv, and nCDinv</b></p><pre class="codeinput"><span class="keyword">if</span> seti.gscale == 1
    <span class="comment">% volume of infinitestimal element of CD when nCDinv is used</span>
    seti.hInv = 2*seti.rCD/seti.nCDinv;
    seti.dVinv = seti.hInv^seti.dim;

    seti.nInv = round(seti.nROI/seti.nCD*seti.nCDinv);
<span class="keyword">else</span>
    seti.nCDinv = seti.nCD;
    seti.nInv = seti.nROI;
    seti.hInv = seti.h;
    seti.dVinv = seti.dV;
<span class="keyword">end</span>
</pre><p><b>Define seti.GU (scale grid up) and seti.GD (scale grid down)</b></p><pre class="codeinput"><span class="keyword">if</span> seti.gscale == 1
    reshapeVecInv = seti.nInv*ones(1,seti.dim);
    seti.GInv  = @(x) reshape(x,reshapeVecInv); <span class="comment">%  G: nInv x 1  -&gt; matrix</span>

    seti.GU = @(qROIdown) seti.iG(gridUp(seti.GInv(qROIdown),seti.nROI,seti.nInv)); <span class="comment">% scale grid up</span>
    seti.GD = @(qROI) seti.iG(gridDown(seti.G(qROI),seti.nROI,seti.nInv)); <span class="comment">% scale grid down</span>
<span class="keyword">else</span> <span class="comment">% id</span>
    seti.GInv = seti.GROI;

    seti.GU = @(qROI) qROI;
    seti.GD = @(qROI) qROI;
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% setGridScale
% Sets functions seti.GD to downscale grid of ROI 
% and seti.GU to upscale grid again.
%
%% Syntax
%
%   seti = setGridScale(seti)
%   seti = setGridScale(seti,dispDepth)
%
%% Description
% |seti = setGridScale(seti)| 
% Sets functions seti.GD to downscale grid of ROI 
% and seti.GU to upscale grid again. The size of the down scaled ROI
% depends on the relation of the number of discretization points of the
% down scaled CD to the upscaled (full) CD.
%
% |seti = setGridScale(seti,dispDepth)| does the same but allows to control
% the depth of displayed messages by dispDepth.
% 
% * If seti.gscale = 1 grid scaling is considered.
%
%% Input Arguments
%
% If the fields was not defined, default values are set.
%
% * seti.gscale     :   1: use a down scaled grid for reconstruction;
%                       0: do not use grid scaling (default)
% * seti.nCDinv     :   number of discretization points
%                       _of the downscaled grid_
%                       for each dimension of CD.
%                       (for nCD see <setGrid.html>).
%                       (default: |floor(seti.nCD/2)|).
%
% *Optional Input Argument*
%
% * dispDepth   : Depth of displayed messages (0: no, 1 or greater: yes).
%
%% Output Arguments
%
% * seti.nInv   :   The analogue to seti.nROI, see <setGrid.html>, for the downscaled grid.
% * seti.hInv   :   The analogue to seti.h, see <setGrid.html>, for the downscaled grid.
% * seti.dVinv  :   The analogoue to seti.dV, see <setGrid.html>, for the downscaled grid.
% * seti.GInv   :   The analogue to seti.G, see <setReshapeVecMat.html>, for the downscaled grid.
%
% * seti.GU     :   function to scale up the grid
%                   (input: down scaled contrast as a vector of size seti.nInv^seti.dim;
%                   output: up scaled contrast as a vector of size seti.nROI^seti.dim)
% * seti.GD     :   function to scale down the grid
%                   (input: up scaled contrast as a vector of size seti.nROI^seti.dim;
%                   output: down scaled contrast as a vector of size seti.nInv^seti.dim)
%
%% More About
%
% *Process in the program*
%
% # seti.GInv or seti.G writes vector as matrix.
% # Scaling by gridUp or gridDown, see <gridUp.html>, <gridDown.html>.
% # seti.iG writes matrix as vector again.
%
% Grid scaling is used in <pda.html>.
%
% *The size of the down scaled grid...*
%
% * Note that ROI is down scaled and not the grid of CD.
% * Therefore the size of the down scaled grid is smaller than 
% seti.nCDinv^seti.dim.
% * So, |seti.nInv = round(seti.nROI/seti.nCD*seti.nCDinv)|.
%
%
%% See Also
%
% * <setGrid.html>
% * <setGeomSim.html>
% * <pda.html>
%
% * <gridUp.html>
% * <gridDown.html>
%
%% Code
function seti = setGridScale(seti,varargin)

if nargin == 2
    dispDepth = varargin{1};
else
    dispDepth = 0;
end

%%
% *Check consistency*

seti = checkfield(seti,'gscale',0,dispDepth);

if (seti.gscale == 1) && ~isfield(seti,'nCDinv')
    seti.nCDinv = floor(seti.nCD/2);
    setmessage(seti,'nCDinv',dispDepth);
end

%%
% *Set hInv, dVinv, and nCDinv*
%
if seti.gscale == 1
    % volume of infinitestimal element of CD when nCDinv is used
    seti.hInv = 2*seti.rCD/seti.nCDinv;
    seti.dVinv = seti.hInv^seti.dim;

    seti.nInv = round(seti.nROI/seti.nCD*seti.nCDinv);
else
    seti.nCDinv = seti.nCD;
    seti.nInv = seti.nROI;
    seti.hInv = seti.h;
    seti.dVinv = seti.dV;
end

%%
% *Define seti.GU (scale grid up) and seti.GD (scale grid down)*
%
if seti.gscale == 1
    reshapeVecInv = seti.nInv*ones(1,seti.dim);
    seti.GInv  = @(x) reshape(x,reshapeVecInv); %  G: nInv x 1  -> matrix

    seti.GU = @(qROIdown) seti.iG(gridUp(seti.GInv(qROIdown),seti.nROI,seti.nInv)); % scale grid up
    seti.GD = @(qROI) seti.iG(gridDown(seti.G(qROI),seti.nROI,seti.nInv)); % scale grid down
else % id
    seti.GInv = seti.GROI;

    seti.GU = @(qROI) qROI;
    seti.GD = @(qROI) qROI;
end

end

##### SOURCE END #####
--></body></html>