
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>testMimoNearAndFar2D</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-04-30"><meta name="DC.source" content="testMimoNearAndFar2D.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>testMimoNearAndFar2D</h1><!--introduction--><p>Test near field data against far field data.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Input Arguments</a></li><li><a href="#4">Output Arguments</a></li><li><a href="#5">More About</a></li><li><a href="#6">References</a></li><li><a href="#7">See Also</a></li><li><a href="#8">Code</a></li></ul></div><h2 id="1">Syntax</h2><pre class="language-matlab">testMimoNearAndFar2D
</pre><h2 id="2">Description</h2><p><tt>testMimoNearAndFar</tt> compares by <a href="mimo.html">mimo.html</a> computed scattered fields for near field and far field (at receivers positions (RX) and on region of interest (ROI)) in 2D case.</p><div><ul><li>testset 1: compares <a href="mimo.html">mimo.html</a> against reference solution              (as in <a href="testMimo.html">testMimo.html</a>) and further compares              near field (with huge radius radSrc) against far field results.              For comparison the relative error is computed.</li><li>testset 2: compares by <a href="mimo.html">mimo.html</a> computed near with far field solution              in case of Fresnel op. 1 setting (only the setting, not the              data is required).              (More about Fresnel settings, see <a href="readRAWData.html">readRAWData.html</a> and              <a href="loadData.html">loadData.html</a>).              (There is no comparison with reference solution).              For comparison the relative error is computed.</li></ul></div><p>This test should run in environment runtests, see <a href="runtests.html">runtests.html</a> via</p><pre class="language-matlab">runtests(<span class="string">'mnf'</span>);
</pre><h2 id="3">Input Arguments</h2><p>See <a href="testMimo.html">testMimo.html</a></p><h2 id="4">Output Arguments</h2><p>Terminal output.</p><h2 id="5">More About</h2><p>To compare the far field data with near field, we compute the field <img src="testMimoNearAndFar2D_eq00682449263635204914.png" alt="$u(x)$"> from far field <img src="testMimoNearAndFar2D_eq04458362726330575162.png" alt="$u_\infty(x)$">.</p><p>The relation is, see [1, Th. 2.6]:</p><p><img src="testMimoNearAndFar2D_eq00138811946007967972.png" alt="$u(x) = \exp(\mathrm{i} k |x|)/(|x|^{(d-1)/2})  (u_\infty(\hat{x} + \mathcal{O}(|x|^{-1})  \quad \mathrm{if} \quad |x| \rightarrow \infty$">.</p><h2 id="6">References</h2><div><ul><li>[1] David Colton and Rainer Kress. <i>Inverse Acoustic and Electromagnetic Scattering Theory</i>. Springer, New York, 2013.</li></ul></div><h2 id="7">See Also</h2><div><ul><li><a href="runtests.html">runtests.html</a></li><li><a href="testMimo.html">testMimo.html</a></li><li><a href="referenceData2D.html">referenceData2D.html</a></li><li><a href="referenceData3D.html">referenceData3D.html</a></li><li><a href="readRAWData.html">readRAWData.html</a></li><li><a href="loadData.html">loadData.html</a></li></ul></div><h2 id="8">Code</h2><p><b>Only in case of standalone (not recommended)</b></p><pre class="codeinput"><span class="comment">% init;</span>
</pre><p><b>testsets</b></p><pre class="codeinput"><span class="keyword">for</span> testset = 1:2

    disp(<span class="string">' '</span>);
    fprintf(<span class="string">'-- testset %d --\n'</span>,testset);
    disp(<span class="string">' '</span>);

    seti.dim = 2;
    seti.model = <span class="string">'helmholtz2D'</span>;

    <span class="keyword">if</span> testset == 1 <span class="comment">% planeWave and incNb = 1 to compare with reference solution</span>
        seti.nCD = 2^9;
        seti.contrast = <span class="string">'referenceBall2D'</span>; <span class="comment">% contrast function (shape)</span>
        seti.incType = <span class="string">'planeWave'</span>; <span class="comment">%use planeWave(!) (referenceData2D.m has only planeWave as reference data)</span>
        seti.incNb = 1; <span class="comment">%1! otherwise test will not run of course (referenceData is plane wave incidence with direction (1,0))</span>
        seti.k = 3; <span class="comment">% wave number</span>
        seti.rCD = 2.5;
        seti.qBall = 0.5; <span class="comment">% contrast of ball</span>
        seti.rBall = 0.5; <span class="comment">% radius of ball</span>
        seti.measNb = 2;
        seti.radMeas = 200;
        <span class="comment">% radMeas must be high (otherwise you see the difference between</span>
        <span class="comment">% usFarNear bzw. usFarRefNear againt usNearRef)</span>
        seti.radSrc = 4;
    <span class="keyword">elseif</span> testset == 2 <span class="comment">% Fresnel</span>
        seti.nCD = 2^8;
        seti.contrast = <span class="string">'fresnel_op1_twodielTM'</span>;
        seti.incType = <span class="string">'pointSource'</span>; <span class="comment">% can not be compared with reference solution, because there ist not reference solution for point sources.</span>
        seti.incNb = 36;
        f = 4E9; <span class="comment">% frecuency 4 GHz</span>
        <span class="comment">% if f is smaller, the difference between near and far field on RX</span>
        <span class="comment">% descreases...</span>
        <span class="comment">% e.g. 4 GHz:</span>
        <span class="comment">%usNearROI against usFarROI   :   0.000000</span>
        <span class="comment">%usNearRX  against usFarRXNear:   0.040871</span>
        <span class="comment">% e.g. 1 GHz:</span>
        <span class="comment">%usNearROI against usFarROI   :   0.000000</span>
        <span class="comment">%usNearRX  against usFarRXNear:   0.014894</span>
        <span class="comment">% Result:</span>
        <span class="comment">% to divide Fresnel data with factor (see below) and use them as</span>
        <span class="comment">% far field data does not seem to be a good approximation</span>
        seti.k = 2*pi/(3E8/f);
        seti.rCD = 0.2;
        seti.measNb = 72;
        seti.radSrc = 0.72;
        seti.radMeas = 0.76;
        <span class="comment">%seti.radMeas = 200; % to test... and yes, does fit better to farField...</span>
    <span class="keyword">end</span>

    <span class="keyword">for</span> i = 1:2

        <span class="keyword">if</span> i == 1
            seti.measType = <span class="string">'nearField'</span>;
        <span class="keyword">elseif</span> i == 2
            seti.measType = <span class="string">'farField'</span>;
        <span class="keyword">end</span>

        seti = setGeomSim(seti);

        N = seti.nROI;

        <span class="keyword">if</span> strcmp(seti.model, <span class="string">'helmholtz2D'</span>) &amp;&amp; testset == 1
            <span class="comment">% &amp;&amp; strcmp(seti.incType,'planeWave')</span>
            <span class="comment">% &amp;&amp; strcmp(seti.incNb,1) (to be exactly; it is testset = 1)</span>
            <span class="comment">% but planeWave indicates that we want to compare with reference</span>
            <span class="comment">% solution</span>
            disp(<span class="string">'Compute reference solution'</span>)
            tic
            [uScattRXRef, uScattROIRef] = referenceData2D(seti);
            toc
        <span class="keyword">elseif</span> strcmp(seti.model, <span class="string">'helmholtz2D'</span>) &amp;&amp; testset == 2
            disp(<span class="string">'No reference solution available (so no comparison with ref. sol.).'</span>)
        <span class="keyword">else</span>
            disp(<span class="string">'testMimo: Unknown Model!'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        disp(<span class="string">'Compute solution'</span>)
        tic
        [uScattRX,~,uScattROI] = mimo(seti, seti.qROIexact, <span class="string">'simo'</span>);
        toc

        <span class="keyword">if</span> i == 1
            usNearROI = uScattROI;
            usNearRX = uScattRX;
            <span class="keyword">if</span> testset == 1
                usNearROIRef = uScattROIRef;
                usNearRXRef = uScattRXRef;
            <span class="keyword">end</span>
            measPntsNear = seti.measPnts;
        <span class="keyword">elseif</span> i == 2
            usFarROI = uScattROI;
            usFarRX = uScattRX;
            <span class="keyword">if</span> testset == 1
                usFarROIRef = uScattROIRef;
                usFarRXRef = uScattRXRef;
            <span class="keyword">end</span>

            <span class="comment">% usFarRXNear: Compute field u(x) from farField u_\infty(x)</span>
            <span class="comment">% to compare the far field data with near field</span>
            <span class="comment">% u(x) = exp(i k |x|)/(|x|^{(d-1)/2}) (u_\infty(\hat{x} + \mathcal{O}(|x|^{-1})</span>
            <span class="comment">% if |x| \rightarrow \infty</span>
            usFarRXNear = zeros(size(usFarRX));
            usFarRXRefNear = zeros(size(usFarRX));
            RX = measPntsNear; <span class="comment">% use measPnts from nearField, because farField is on circle with radius 1...</span>
            k = seti.k;
            <span class="keyword">for</span> j = 1:seti.measNb
                absx = sqrt(RX(1,j)^2+RX(2,j)^2);
                factor = exp(1i*k*absx)/(absx)^((seti.dim-1)/2);
                usFarRXNear(j,:) = factor*usFarRX(j,:);
                <span class="keyword">if</span> testset == 1
                    usFarRXRefNear(j,:) = factor*usFarRXRef(j,:);
                <span class="keyword">elseif</span> testset == 2
                    usFarRXNear(j,:) = factor*usFarRX(j,:);
                <span class="keyword">end</span>
            <span class="keyword">end</span>

        <span class="keyword">end</span>

    <span class="comment">%    errorROI = norm( seti.ballMask(seti.ROImask).*(uScattROI-uScattROIRef) )...</span>
    <span class="comment">%        /norm( seti.ballMask(seti.ROImask).*uScattROIRef );</span>
    <span class="comment">%    errorCD = norm( uScattRX-uScattRXRef )/norm( uScattRXRef );</span>
    <span class="comment">%    fprintf('%4d^%i  |  %10f |  %10f |  %10f | %f\n',NMat, seti.dim, errorROI,errorCD,tgrid,t);</span>

    <span class="keyword">end</span>

    <span class="keyword">if</span> testset == 1
        disp(<span class="string">'testset = 1: planeWave, incNb = 1'</span>)
        disp(<span class="string">'compare scatterd near field with reference solution'</span>)
        disp(<span class="string">'compare scatterd far field with reference solution'</span>)
        disp(<span class="string">'compare scatterd near and far field (near field with huge radius)'</span>)

        errorROI = @(uScattROI,uScattROIRef)<span class="keyword">...</span>
                   norm( seti.ballMask(seti.ROImask).*(uScattROI-uScattROIRef) )<span class="keyword">...</span>
                   /norm( seti.ballMask(seti.ROImask).*uScattROIRef );
        errorCD = @(uScattRX,uScattRXRef) norm( uScattRX-uScattRXRef )/norm( uScattRXRef );

        fprintf(<span class="string">'ROI: usNear       against usNearRef: %10f\n'</span>,errorROI(usNearROI,usNearROIRef)')
        fprintf(<span class="string">'RX : usNear       against usNearRef: %10f\n'</span>,errorCD(usNearRX,usNearRXRef))

        fprintf(<span class="string">'ROI: usFar        against usFarRef : %10f\n'</span>,errorROI(usFarROI,usFarROIRef))
        fprintf(<span class="string">'RX : usFar        against usFarRef : %10f\n'</span>,errorCD(usFarRX,usFarRXRef))

        fprintf(<span class="string">'ROI: usFar        against usNearRef: %10f\n'</span>,errorROI(usFarROI,usNearROIRef))
        fprintf(<span class="string">'RX : usFarNear    against usNearRef: %10f\n'</span>,errorCD(usFarRXNear,usNearRXRef))

        fprintf(<span class="string">'ROI: usFarRef     against usNearRef: %10f\n'</span>,errorROI(usFarROIRef,usNearROIRef))
        fprintf(<span class="string">'RX : usFarRefNear against usNearRef: %10f\n'</span>,errorCD(usFarRXRefNear,usNearRXRef))

        <span class="comment">%figure(101);plot(real(uScattRXRef))</span>
        <span class="comment">%figure(102);plot(real(uScattRX))</span>
        <span class="comment">% test factor error: uScattRX./uScattRef</span>
    <span class="keyword">elseif</span> testset == 2
        disp(<span class="string">'testset = 2: pointSource; Fresnel, op. 1'</span>)
        disp(<span class="string">'compare scatterd near and far field'</span>)
        errorROI = @(uScattNearROI,uScattFarROI)<span class="keyword">...</span>
                   norm( seti.ballMask(seti.ROImask).*(uScattNearROI-uScattFarROI) )<span class="keyword">...</span>
                   /norm( seti.ballMask(seti.ROImask).*uScattFarROI );
        errorCD = @(uScattNearRX,uScattFarRX) norm( uScattNearRX-uScattFarRX )/norm( uScattFarRX );

        fprintf(<span class="string">'usNearROI against usFarROI   : %10f\n'</span>,errorROI(usNearROI,usFarROI)')
        fprintf(<span class="string">'usNearRX  against usFarRXNear: %10f\n'</span>,errorCD(usNearRX,usFarRXNear))

    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% testMimoNearAndFar2D
% Test near field data against far field data.
%
%% Syntax
%
%   testMimoNearAndFar2D
%
%% Description
%
% |testMimoNearAndFar| compares by <mimo.html> computed scattered fields
% for near field and far field (at receivers positions (RX) and on region of
% interest (ROI)) in 2D case.
%
% * testset 1: compares <mimo.html> against reference solution 
%              (as in <testMimo.html>) and further compares 
%              near field (with huge radius radSrc) against far field results.
%              For comparison the relative error is computed.
% * testset 2: compares by <mimo.html> computed near with far field solution 
%              in case of Fresnel op. 1 setting (only the setting, not the
%              data is required).
%              (More about Fresnel settings, see <readRAWData.html> and
%              <loadData.html>).
%              (There is no comparison with reference solution).
%              For comparison the relative error is computed.
%
% This test should run in environment runtests, see <runtests.html> via
%
%   runtests('mnf');
%
%% Input Arguments
%
% See <testMimo.html>
%
%% Output Arguments
%
% Terminal output.
%
%% More About
%
% To compare the far field data with near field, we 
% compute the field $u(x)$ from far field $u_\infty(x)$.
%
% The relation is, see [1, Th. 2.6]: 
%
% $u(x) = \exp(\mathrm{i} k |x|)/(|x|^{(d-1)/2}) 
%  (u_\infty(\hat{x} + \mathcal{O}(|x|^{-1})
%  \quad \mathrm{if} \quad |x| \rightarrow \infty$.
%
%% References
%
% * [1] David Colton and Rainer Kress. _Inverse Acoustic and Electromagnetic Scattering Theory_. Springer, New York, 2013.
%
%% See Also
%
% * <runtests.html>
% * <testMimo.html>
% * <referenceData2D.html>
% * <referenceData3D.html>
% * <readRAWData.html>
% * <loadData.html>
%
%% Code
%
% *Only in case of standalone (not recommended)*

% init;

%%
% *testsets*

for testset = 1:2
    
    disp(' ');
    fprintf('REPLACE_WITH_DASH_DASH testset %d REPLACE_WITH_DASH_DASH\n',testset);
    disp(' ');

    seti.dim = 2;
    seti.model = 'helmholtz2D';

    if testset == 1 % planeWave and incNb = 1 to compare with reference solution
        seti.nCD = 2^9;
        seti.contrast = 'referenceBall2D'; % contrast function (shape)
        seti.incType = 'planeWave'; %use planeWave(!) (referenceData2D.m has only planeWave as reference data)
        seti.incNb = 1; %1! otherwise test will not run of course (referenceData is plane wave incidence with direction (1,0))
        seti.k = 3; % wave number
        seti.rCD = 2.5;
        seti.qBall = 0.5; % contrast of ball
        seti.rBall = 0.5; % radius of ball
        seti.measNb = 2;
        seti.radMeas = 200;
        % radMeas must be high (otherwise you see the difference between
        % usFarNear bzw. usFarRefNear againt usNearRef)
        seti.radSrc = 4;
    elseif testset == 2 % Fresnel
        seti.nCD = 2^8;
        seti.contrast = 'fresnel_op1_twodielTM';
        seti.incType = 'pointSource'; % can not be compared with reference solution, because there ist not reference solution for point sources.
        seti.incNb = 36;
        f = 4E9; % frecuency 4 GHz
        % if f is smaller, the difference between near and far field on RX
        % descreases...
        % e.g. 4 GHz:
        %usNearROI against usFarROI   :   0.000000
        %usNearRX  against usFarRXNear:   0.040871
        % e.g. 1 GHz:
        %usNearROI against usFarROI   :   0.000000
        %usNearRX  against usFarRXNear:   0.014894
        % Result:
        % to divide Fresnel data with factor (see below) and use them as
        % far field data does not seem to be a good approximation
        seti.k = 2*pi/(3E8/f);
        seti.rCD = 0.2;
        seti.measNb = 72;
        seti.radSrc = 0.72;
        seti.radMeas = 0.76;
        %seti.radMeas = 200; % to test... and yes, does fit better to farField...
    end

    for i = 1:2

        if i == 1
            seti.measType = 'nearField';
        elseif i == 2
            seti.measType = 'farField';
        end

        seti = setGeomSim(seti);

        N = seti.nROI;

        if strcmp(seti.model, 'helmholtz2D') && testset == 1
            % && strcmp(seti.incType,'planeWave')
            % && strcmp(seti.incNb,1) (to be exactly; it is testset = 1)
            % but planeWave indicates that we want to compare with reference
            % solution
            disp('Compute reference solution')
            tic
            [uScattRXRef, uScattROIRef] = referenceData2D(seti);
            toc
        elseif strcmp(seti.model, 'helmholtz2D') && testset == 2
            disp('No reference solution available (so no comparison with ref. sol.).')
        else
            disp('testMimo: Unknown Model!');
            return;
        end

        disp('Compute solution')
        tic
        [uScattRX,~,uScattROI] = mimo(seti, seti.qROIexact, 'simo');
        toc

        if i == 1
            usNearROI = uScattROI;
            usNearRX = uScattRX;
            if testset == 1
                usNearROIRef = uScattROIRef;
                usNearRXRef = uScattRXRef;
            end
            measPntsNear = seti.measPnts;
        elseif i == 2
            usFarROI = uScattROI;
            usFarRX = uScattRX;
            if testset == 1
                usFarROIRef = uScattROIRef;
                usFarRXRef = uScattRXRef;
            end

            % usFarRXNear: Compute field u(x) from farField u_\infty(x)
            % to compare the far field data with near field
            % u(x) = exp(i k |x|)/(|x|^{(d-1)/2}) (u_\infty(\hat{x} + \mathcal{O}(|x|^{-1})
            % if |x| \rightarrow \infty
            usFarRXNear = zeros(size(usFarRX));
            usFarRXRefNear = zeros(size(usFarRX));
            RX = measPntsNear; % use measPnts from nearField, because farField is on circle with radius 1...
            k = seti.k;
            for j = 1:seti.measNb
                absx = sqrt(RX(1,j)^2+RX(2,j)^2);
                factor = exp(1i*k*absx)/(absx)^((seti.dim-1)/2);
                usFarRXNear(j,:) = factor*usFarRX(j,:);
                if testset == 1
                    usFarRXRefNear(j,:) = factor*usFarRXRef(j,:);
                elseif testset == 2
                    usFarRXNear(j,:) = factor*usFarRX(j,:);
                end
            end

        end

    %    errorROI = norm( seti.ballMask(seti.ROImask).*(uScattROI-uScattROIRef) )...
    %        /norm( seti.ballMask(seti.ROImask).*uScattROIRef );
    %    errorCD = norm( uScattRX-uScattRXRef )/norm( uScattRXRef );
    %    fprintf('%4d^%i  |  %10f |  %10f |  %10f | %f\n',NMat, seti.dim, errorROI,errorCD,tgrid,t);

    end

    if testset == 1
        disp('testset = 1: planeWave, incNb = 1')
        disp('compare scatterd near field with reference solution')
        disp('compare scatterd far field with reference solution')
        disp('compare scatterd near and far field (near field with huge radius)')

        errorROI = @(uScattROI,uScattROIRef)...
                   norm( seti.ballMask(seti.ROImask).*(uScattROI-uScattROIRef) )...
                   /norm( seti.ballMask(seti.ROImask).*uScattROIRef );
        errorCD = @(uScattRX,uScattRXRef) norm( uScattRX-uScattRXRef )/norm( uScattRXRef );

        fprintf('ROI: usNear       against usNearRef: %10f\n',errorROI(usNearROI,usNearROIRef)')
        fprintf('RX : usNear       against usNearRef: %10f\n',errorCD(usNearRX,usNearRXRef))

        fprintf('ROI: usFar        against usFarRef : %10f\n',errorROI(usFarROI,usFarROIRef))
        fprintf('RX : usFar        against usFarRef : %10f\n',errorCD(usFarRX,usFarRXRef))

        fprintf('ROI: usFar        against usNearRef: %10f\n',errorROI(usFarROI,usNearROIRef))
        fprintf('RX : usFarNear    against usNearRef: %10f\n',errorCD(usFarRXNear,usNearRXRef))

        fprintf('ROI: usFarRef     against usNearRef: %10f\n',errorROI(usFarROIRef,usNearROIRef))
        fprintf('RX : usFarRefNear against usNearRef: %10f\n',errorCD(usFarRXRefNear,usNearRXRef))

        %figure(101);plot(real(uScattRXRef))
        %figure(102);plot(real(uScattRX))
        % test factor error: uScattRX./uScattRef
    elseif testset == 2
        disp('testset = 2: pointSource; Fresnel, op. 1')
        disp('compare scatterd near and far field')
        errorROI = @(uScattNearROI,uScattFarROI)...
                   norm( seti.ballMask(seti.ROImask).*(uScattNearROI-uScattFarROI) )...
                   /norm( seti.ballMask(seti.ROImask).*uScattFarROI );
        errorCD = @(uScattNearRX,uScattFarRX) norm( uScattNearRX-uScattFarRX )/norm( uScattFarRX );

        fprintf('usNearROI against usFarROI   : %10f\n',errorROI(usNearROI,usFarROI)')
        fprintf('usNearRX  against usFarRXNear: %10f\n',errorCD(usNearRX,usFarRXNear))

    end
    
end

##### SOURCE END #####
--></body></html>