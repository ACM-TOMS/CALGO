
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Create Source Code Documentation</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-04-30"><meta name="DC.source" content="docCreate.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Create Source Code Documentation</h1><!--introduction--><p>Process to create HTML files for source code documentation in the directory <tt>doc/html</tt> out of in-place documentation in MATLAB files of the toolbox <tt>IPscatt</tt> by the function <tt>publish</tt> of MATLAB. This routine can be used for other toolboxes too.</p><p>Warning: This function creates a directory and files.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Example</a></li><li><a href="#4">More About</a></li><li><a href="#5">Code: docCreate</a></li><li><a href="#9">Look for folders</a></li><li><a href="#10">Look for m-files</a></li><li><a href="#14">Code: Subfunction: publishMfiles</a></li><li><a href="#15">Code: Subfunction: makeIndexHTML</a></li><li><a href="#16">Copy CSS from MATLAB Standard Docu into index.html</a></li><li><a href="#17">Code: Subfunction: createMfileList</a></li><li><a href="#20">Code: Subfunction: createFolderList</a></li><li><a href="#24">Code: Subfunction: skipItemsInFolderList</a></li><li><a href="#25">Code: Subfunction: pubOptions</a></li><li><a href="#26">Remember the function exist</a></li></ul></div><h2 id="1">Syntax</h2><pre class="language-matlab">docCreate;
</pre><h2 id="2">Description</h2><p>The routine <tt>docCreate</tt> uses the function <tt>publish</tt> of MATLAB to publish the source code documentation written as in-place documentation of the toolbox <tt>IPscatt</tt>.</p><p>In detail:</p><div><ul><li>Takes into account all m-files in the folder <tt>code</tt> and its subfolders.</li><li>Uses the function <tt>publish</tt> of MATLAB to create HTML-files in the folder <tt>doc/html</tt>.</li><li>Creates an index of all routines, <tt>index.html</tt>, in the folder <tt>doc</tt>.</li><li>Takes into account additional pictures stored in <tt>doc/extGraph</tt> when referred in the documentation. Actually, these is an overview of the program's structure and a reference of all files (created manually copying all input and output arguments of the MATLAB files of <tt>IPscatt</tt>.)</li><li>Includes additional MATLAB-files in <tt>code/docCreate/addMfiles</tt>. (The files <tt>programStructure</tt> and <tt>setiRef</tt> have to be updated manually, if the structure in form of file dependencies is changed or references of input and output arguments are changed.)</li></ul></div><p>To save time in case of updates of the source code documentation the files in the folder <tt>html</tt> and the file <tt>index.html</tt> are not deleted, such that it may contain documentation of deleted files. They can be deleted without data loss.</p><h2 id="3">Example</h2><p><b>Example 1: Generate or update the documentation of all files and create the index file</b></p><pre class="language-matlab">docCreate;
</pre><p><b>Example 2: Generate or update the documentation of specific file</b></p><p>This example updates the source code documentation of the file <tt>start.m</tt>.</p><pre class="language-matlab">options.outputDir = <span class="string">'../doc/html'</span>;
options.format    = <span class="string">'html'</span>; <span class="comment">% default</span>
options.evalCode  = false;  <span class="comment">% Do not evaluate the code.</span>
publish(<span class="string">'start.m'</span>,options);
</pre><h2 id="4">More About</h2><p><b>Structure</b>: In general we follow the structure of the MATLAB documentation. i.e.</p><div><ol><li>Name of the function and a short description.</li><li>Syntax</li><li>Description</li><li>Examples</li><li>Input Arguments</li><li>Output Arguments</li><li>More About</li><li>References</li><li>See Also</li></ol></div><p>Additionaly we have the section Code.</p><p><b>URLs</b>: Some interesting URLs how to write an in-place documentation in MATLAB:</p><div><ul><li><a href="http://de.mathworks.com/help/matlab/matlab_prog/publishing-matlab-code.html">http://de.mathworks.com/help/matlab/matlab_prog/publishing-matlab-code.html</a></li><li><a href="http://de.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html">http://de.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html</a></li><li><a href="http://de.mathworks.com/help/matlab/matlab_prog/add-help-for-your-program.html">http://de.mathworks.com/help/matlab/matlab_prog/add-help-for-your-program.html</a></li><li><a href="https://wiki.hpcc.msu.edu/pages/viewpage.action?pageId=17599292">https://wiki.hpcc.msu.edu/pages/viewpage.action?pageId=17599292</a> (auto-documentation in MATLAB)</li></ul></div><p><b>Others</b>:</p><div><ul><li>Currently, all folders with the string <tt>closed</tt> are ignored for the publication of the source code documentation. A distinction between <tt>doc</tt> and <tt>docClosed</tt> in dependence of <tt>closed = 0</tt> or <tt>closed = 1</tt> would be useful, but is not implemented yet. This should take into account the added paths in paths in <tt>init.m</tt>.</li></ul></div><p><b>Look for errors</b></p><p>LaTeX may fail, e.g.</p><pre class="language-matlab">$$\alpha = \alpa$$
</pre><p>Instead of checking each file, look for "Error updating Text." in HTML files, e.g. with "Find Files" from MATLAB.</p><h2 id="5">Code: docCreate</h2><pre class="codeinput"><span class="keyword">function</span> docCreate()
</pre><pre class="codeinput">init;

<span class="keyword">if</span> exist(<span class="string">'closed'</span>,<span class="string">'var'</span>) &amp;&amp; closed == 1
    disp(<span class="string">'Parameter closed is 1 in init.m.'</span>)
    disp(<span class="string">'The source code documentation was only written for the public version.'</span>)
    error(<span class="string">'Do not set the variable closed in init or set them to 0 and run docCreate again.'</span>)
<span class="keyword">end</span>

pubMfiles = 1; <span class="comment">% start publishMfiles (takes some time...)</span>
</pre><p><b>What happens?</b></p><div><ul><li>Make make a link for each file by</li></ul></div><pre class="language-matlab">&lt;a href=<span class="string">'...'</span>&gt;<span class="keyword">...</span><span class="comment">&lt;/a&gt;</span>
</pre><div><ul><li>Structure them (folder-wise).</li></ul></div><p><b>Create a list of all folders</b></p><pre class="codeinput">disp(<span class="string">' '</span>)
disp(<span class="string">'## List of all m-files --------------------------------------------'</span>)
disp(<span class="string">' '</span>)
</pre><h2 id="9">Look for folders</h2><pre class="codeinput">disp(<span class="string">' '</span>)
disp(<span class="string">'-- List of folders --'</span>)
disp(<span class="string">' '</span>)
[folderlist,~] = createFolderList();
<span class="comment">% transpose(folderlist)</span>

disp(<span class="string">' '</span>)
disp(<span class="string">'-- Skip some items in list of folders --'</span>)
disp(<span class="string">' '</span>)
folderlist = skipItemsInFolderList(folderlist);
<span class="comment">% transpose(folderlist)</span>
</pre><h2 id="10">Look for m-files</h2><pre class="codeinput">disp(<span class="string">' '</span>)
disp(<span class="string">'-- List of m-files --'</span>)
disp(<span class="string">' '</span>)

[mfileDirname,mfileName,mfilePath] = createMfileList(folderlist);
</pre><p><b>Make index</b></p><pre class="codeinput">disp(<span class="string">' '</span>)
disp(<span class="string">'## Make index HTML file -------------------------------------------'</span>)
disp(<span class="string">' '</span>)
makeIndexHTML(mfileDirname,mfileName);
</pre><p><b>Publish it</b></p><pre class="codeinput">disp(<span class="string">' '</span>)
disp(<span class="string">'## Publish it -----------------------------------------------------'</span>)
disp(<span class="string">' '</span>)
<span class="keyword">if</span> pubMfiles
    options = pubOptions();
    publishMfiles(mfilePath,options);
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="14">Code: Subfunction: publishMfiles</h2><pre class="codeinput"><span class="keyword">function</span> publishMfiles(mfilePath,options)
<span class="keyword">for</span> i = 1:length(mfilePath)
    fprintf(<span class="string">'   Publish %s'</span>,mfilePath{i})
    publish(mfilePath{i},options);
    fprintf(<span class="string">' -- [OK]\n'</span>)
<span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2 id="15">Code: Subfunction: makeIndexHTML</h2><pre class="codeinput"><span class="keyword">function</span> makeIndexHTML(mfileDirname,mfileName)

fid = fopen(<span class="string">'../doc/index.html'</span>, <span class="string">'wt'</span>);
<span class="comment">%  fprintf( fid, '%f,%f,%f,%f\n', a1, a2, a3, a4);</span>
fprintf(fid,<span class="string">'&lt;html&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;head&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;title&gt;Documentation: IPscatt&lt;/title&gt;\n'</span>);
</pre><h2 id="16">Copy CSS from MATLAB Standard Docu into index.html</h2><pre class="codeinput">fprintf(fid,<span class="string">'&lt;!-- css formats are copied from MATLAB published documentation --&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;style type="text/css"&gt;\n'</span>);
fidcss = fopen(<span class="string">'docCreate/docCreateCSS.css'</span>,<span class="string">'r'</span>);
tline = fgetl(fidcss);
<span class="keyword">while</span> ischar(tline)
    <span class="comment">%disp(tline)</span>
    tline = fgetl(fidcss);
    fprintf(fid,<span class="string">'%s\n'</span>,tline);
<span class="keyword">end</span>
fclose(fidcss);
fprintf(fid,<span class="string">'&lt;/style&gt;\n'</span>);
<span class="comment">%fprintf(fid,css);</span>
<span class="comment">%clear css;</span>

fprintf(fid,<span class="string">'&lt;/head&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;body&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;div class="content"&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;h1&gt;Source Code Documentation of IPscatt&amp;mdash;a MATLAB Toolbox for the Inverse Medium Problem in Scattering&lt;/h1&gt;\n'</span>);
<span class="comment">% fprintf(fid,'&lt;br&gt;\n');</span>

fprintf(fid,<span class="string">'&lt;p&gt;This is the source code documentation of the toolbox IPscatt.&lt;/p&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;p&gt;It is structured as follows:&lt;/p&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;ul&gt;'</span>);

fprintf(fid,<span class="string">'&lt;li&gt;Read '</span>);
htmlfile = <span class="string">'start.html'</span>;
fprintf(fid,<span class="string">'&lt;a href="html/%s"&gt;%s&lt;/a&gt;'</span>,htmlfile,htmlfile);
fprintf(fid,<span class="string">' for a brief introduction in the usage of IPscatt and the underlying theory of direct and inverse scattering from inhomogeneous media.&lt;/li&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;li&gt;See '</span>);
htmlfile = <span class="string">'programStructure.html'</span>;
fprintf(fid,<span class="string">'&lt;a href="html/%s"&gt;%s&lt;/a&gt;'</span>,htmlfile,htmlfile);
fprintf(fid,<span class="string">' for dependencies of functions.&lt;/li&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;li&gt;Below is the structure of files in folders. \n'</span>);
fprintf(fid,<span class="string">'We provide a source code documentation for each function.&lt;/li&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;li&gt;Furthermore, in '</span>);
htmlfile = <span class="string">'setiRef.html'</span>;
fprintf(fid,<span class="string">'&lt;a href="html/%s"&gt;%s&lt;/a&gt;'</span>,htmlfile,htmlfile);
fprintf(fid,<span class="string">' are fields of the main structure array seti summarized in one file. '</span>);
fprintf(fid,<span class="string">'(The fields are used as input and output and described in the source code documentation of each corresponding file too.)'</span>);
fprintf(fid,<span class="string">'&lt;/li&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;/ul&gt;\n'</span>);

fprintf(fid,<span class="string">'&lt;h2&gt;Structure of Files in Folders of IPscatt&lt;/h2&gt;'</span>);

dirnamePrev = 0;
<span class="keyword">for</span> i = 1:length(mfileName)

    <span class="comment">% Display foldername if new folder</span>
    dirname = mfileDirname{i};
    <span class="keyword">if</span> ~strcmp(dirnamePrev,dirname)
        fprintf(fid,<span class="string">'&lt;br&gt;&lt;h5&gt;%s&lt;/h5&gt;'</span>,dirname);
    <span class="keyword">end</span>
    dirnamePrev = dirname;

    <span class="comment">% Link to documentation file</span>
    htmlFilename = strrep(mfileName{i},<span class="string">'.m'</span>,<span class="string">'.html'</span>); <span class="comment">% Replace .m by .html for the path.</span>
    fprintf(fid,<span class="string">'&lt;a href="html/%s"&gt;%s&lt;/a&gt;&lt;br&gt;'</span>,htmlFilename,mfileName{i});
<span class="keyword">end</span>

fprintf(fid,<span class="string">'&lt;/div&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;/body&gt;\n'</span>);
fprintf(fid,<span class="string">'&lt;/html&gt;\n'</span>);
fclose(fid);

<span class="keyword">end</span>
</pre><h2 id="17">Code: Subfunction: createMfileList</h2><pre class="codeinput"><span class="keyword">function</span> [listDirname,listName,listPath] = createMfileList(folderlist)
</pre><p>Output:</p><div><ul><li><tt>listName</tt>: name of m-file</li><li><tt>listPath</tt>: path of m-file</li></ul></div><pre class="codeinput">display = 0; <span class="comment">% 1: display results, otherwise 0</span>
k = 0;

<span class="keyword">for</span> i = 1:length(folderlist)+1
    <span class="keyword">if</span> display == 1
        disp(<span class="string">' '</span>)
    <span class="keyword">end</span>
    <span class="keyword">if</span> i == 1
        <span class="comment">% files in current folder</span>
        dirname = <span class="string">''</span>;
        dirstring = <span class="string">'*.m'</span>; <span class="comment">% current folder</span>
        mfile = dir(dirstring);
        <span class="keyword">if</span> display == 1
            disp(<span class="string">'*.m'</span>);
        <span class="keyword">end</span>
        lookInFolder = 1;
    <span class="keyword">elseif</span> ~isempty(folderlist{i-1}) <span class="comment">% not used folders are marked by emty cell arrays</span>
        <span class="comment">% folderlist is from 1:length(folderlist)</span>
        <span class="comment">% using i-1 because i = 1 is reserved for first level</span>
        dirname = folderlist{i-1};
        dirstring = sprintf(<span class="string">'%s*.m'</span>,folderlist{i-1});
        mfile = dir(dirstring);
        <span class="keyword">if</span> display == 1
            disp(dirstring);
        <span class="keyword">end</span>
        lookInFolder = 1;
    <span class="keyword">else</span>
        lookInFolder = 0;
    <span class="keyword">end</span>

    <span class="keyword">if</span> lookInFolder == 1
        <span class="keyword">for</span> j = 1:length(mfile)
            mfileentry = sprintf(<span class="string">'%s'</span>,mfile(j).name);
            <span class="comment">%if exist(mfileentry,'file') == 2</span>
            <span class="comment">% Do not use the line above because</span>
            <span class="comment">% * procpost/planeplot.m and</span>
            <span class="comment">% * procpost/plot3Drewrite.m</span>
            <span class="comment">% are excluded (do not know why...)</span>
                k = k + 1;
                <span class="keyword">if</span> display == 1
                    fprintf(<span class="string">'%03d | %02d | %s\n'</span>,k,j,mfileentry);
                <span class="keyword">end</span>
                listDirname{k} = dirname; <span class="comment">% store dirname</span>
                listName{k} = mfileentry;
                listPath{k} = sprintf(<span class="string">'%s%s'</span>,dirname,mfileentry);
            <span class="comment">%end</span>
            clear <span class="string">mfileentry</span>;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="20">Code: Subfunction: createFolderList</h2><pre class="codeinput"><span class="keyword">function</span> [list,j] = createFolderList(varargin)
</pre><p><b>Create a folder list</b></p><p>Store the relative path of (approximately) all folders and subfolders</p><pre class="language-matlab">[folderlist,j] = createFolderList();
or
[folderlist,j] = createFolderList(list,j,path);
[folderlist,j] = createFolderList(<span class="string">''</span>,0,<span class="string">'proc/'</span>);
</pre><p>But this does not contain all folders..., e.g. not</p><div><ul><li>inexpdata/fresnel_opus_1,</li><li>inexpdata/fresnel_opus_2.</li></ul></div><p>It is not clear why, but these folders are uninteresting for the documentation.</p><pre class="codeinput">display = 0; <span class="comment">% 1: display results, 0: not...</span>

<span class="keyword">switch</span> nargin
    <span class="keyword">case</span> 0
        list = <span class="string">''</span>;
        j = 0;
        folder = dir;
        path = <span class="string">''</span>;
    <span class="keyword">case</span> 1 || 2
        error(<span class="string">'folderlist needs 0 or 3 arguments.'</span>)
    <span class="keyword">case</span> 3
        list = varargin{1};
        j    = varargin{2};
        path = varargin{3};
        folder = dir(path); <span class="comment">%e.g. folder = dir('proc')</span>
<span class="keyword">end</span>

<span class="keyword">for</span> i = 1:length(folder)
    folderentry = sprintf(<span class="string">'%s'</span>,folder(i).name);

    <span class="comment">% Do not use</span>
    <span class="comment">% exist(folderentry,'file') == 7</span>
    <span class="comment">% instead of</span>
    <span class="comment">% exist(folderentry,'dir') == 7</span>
    <span class="comment">% Why?</span>
    <span class="comment">% 'file' does not work correctly...</span>
    <span class="comment">% Some dirs are not recognized, if you put the name as string.</span>
    <span class="comment">% (e.g. proc/setData).</span>
    <span class="comment">% (It is no problem in case of exist('proc/setData','file') == 7.)</span>

    <span class="keyword">if</span> exist(folderentry,<span class="string">'dir'</span>) == 7 &amp;&amp; ~strcmp(folderentry,<span class="string">'.'</span>) &amp;&amp; ~strcmp(folderentry,<span class="string">'..'</span>)
        j = j + 1;
        <span class="comment">%list{j} = folderentry;</span>
        <span class="keyword">if</span> display == 1
            fprintf(<span class="string">'%02d | %s%s\n'</span>,j,path,folderentry)
        <span class="keyword">end</span>
        list{j} = sprintf(<span class="string">'%s%s/'</span>,path,folderentry);
        [list,j] = createFolderList(list,j,list{j});
<span class="comment">%     else</span>
<span class="comment">%         fprintf('NO FOLDER: %s%s\n',path,folderentry)</span>
    <span class="keyword">end</span>

    clear <span class="string">folderentry</span>;
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="24">Code: Subfunction: skipItemsInFolderList</h2><pre class="codeinput"><span class="keyword">function</span> folderlist = skipItemsInFolderList(folderlist)
<span class="keyword">for</span> i = 1:length(folderlist)
    <span class="comment">% Ignore folders with string "closed" by setting the item to [].</span>
    str = folderlist{i};
    expression = <span class="string">'closed'</span>; <span class="comment">% \w = [a-zA-Z_0-9]</span>
    matchStr = regexp(str,expression,<span class="string">'match'</span>,<span class="string">'ignorecase'</span>);
    <span class="keyword">if</span> ~isempty(matchStr)
        folderlist{i} = []; <span class="comment">% delete cell array entry</span>
    <span class="keyword">end</span>
    clear <span class="string">str</span> <span class="string">expression</span> <span class="string">matchStr</span>;
    <span class="comment">% ignore folder nogit</span>
    <span class="keyword">if</span> strcmp(folderlist{i},<span class="string">'nogit/'</span>)
        folderlist{i} = [];
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2 id="25">Code: Subfunction: pubOptions</h2><pre class="codeinput"><span class="keyword">function</span> options = pubOptions()
p = mfilename(<span class="string">'fullpath'</span>); <span class="comment">% full path of this file</span>
f = fileparts(p); <span class="comment">% folder path (without file)</span>
pubDir = sprintf(<span class="string">'%s/../doc/html'</span>,f); <span class="comment">% full path</span>
clear <span class="string">p</span> <span class="string">f</span>;

<span class="keyword">if</span> exist(pubDir,<span class="string">'dir'</span>) ~= 7
    mkdir(pubDir);
<span class="keyword">end</span>

<span class="comment">%options.outputDir = '/home/fbuergel/Documents/rebis/doc/html'; % full path</span>
options.outputDir = pubDir; clear <span class="string">pubDir</span>;
options.format    = <span class="string">'html'</span>; <span class="comment">% default</span>
options.evalCode  = false; <span class="comment">% do not evaluate the code</span>

<span class="comment">%options.showCode = true; % show code (default)</span>
<span class="comment">%options.showCode = false; % do not show code</span>

<span class="comment">%publish('start.m',options)</span>
<span class="comment">%clear options</span>
<span class="keyword">end</span>
</pre><h2 id="26">Remember the function exist</h2><p>Remember the MATLAB function exist, see <a href="https://de.mathworks.com/help/matlab/ref/exist.html">https://de.mathworks.com/help/matlab/ref/exist.html</a>.</p><p><b>2, i.e. one of the following is true</b></p><div><ul><li>name exists on your MATLAB search path as a file with extension .m or .mlx.</li><li>name is the name of an ordinary file on your MATLAB search path.</li><li>name is the full pathname to any file.</li></ul></div><p><b>7, i.e. the name is a folder</b></p><pre class="language-matlab">A = exist(<span class="string">'name'</span>,<span class="string">'kind'</span>)
</pre><div><ul><li>dir : Checks only for folders.</li><li>file: Checks only for files or folders.</li></ul></div><pre class="codeinput"><span class="comment">% if exist('...','file')</span>
<span class="comment">%     if exist('...','dir') % must be a folder</span>
<span class="comment">%        ...</span>
<span class="comment">%</span>
<span class="comment">%     else % must be a file</span>
<span class="comment">%         dir *my*.m</span>
<span class="comment">%</span>
<span class="comment">%     end</span>
<span class="comment">% end</span>
<span class="comment">%</span>
<span class="comment">%</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Create Source Code Documentation
% Process to create HTML files for source code documentation in the 
% directory |doc/html| out of in-place documentation in MATLAB files of the 
% toolbox |IPscatt| by the function |publish| of MATLAB. This routine can
% be used for other toolboxes too.
%
% Warning: This function creates a directory and files.
%
%% Syntax
%
%   docCreate;
%
%% Description
%
% The routine |docCreate| uses the function |publish| of MATLAB to publish
% the source code documentation written as in-place documentation of the
% toolbox |IPscatt|.
% 
% In detail:
%
% * Takes into account all m-files in the folder |code| and its subfolders.
% * Uses the function |publish| of MATLAB to create HTML-files in the
% folder |doc/html|.
% * Creates an index of all routines, |index.html|, in the folder |doc|.
% * Takes into account additional pictures stored in |doc/extGraph| when referred in the documentation.
% Actually, these is an overview of the program's structure and a 
% reference of all files (created manually copying all input and output
% arguments of the MATLAB files of |IPscatt|.)
% * Includes additional MATLAB-files in |code/docCreate/addMfiles|.
% (The files |programStructure| and |setiRef| have to be updated manually,
% if the structure in form of file dependencies is changed or references
% of input and output arguments are changed.)
%
% To save time in case of updates of the source code documentation the
% files in the folder |html| and the file |index.html| are not deleted,
% such that it may contain documentation of deleted files. 
% They can be deleted without data loss.
%
%% Example
%
% *Example 1: Generate or update the documentation of all files and create the index file*
%
%   docCreate;
%
% *Example 2: Generate or update the documentation of specific file*
%
% This example updates the source code documentation of the file |start.m|.
%
%   options.outputDir = '../doc/html';
%   options.format    = 'html'; % default
%   options.evalCode  = false;  % Do not evaluate the code.
%   publish('start.m',options);
%
%% More About
%
% *Structure*: In general we follow the structure of the MATLAB documentation. i.e.
%
% # Name of the function and a short description.
% # Syntax
% # Description
% # Examples
% # Input Arguments
% # Output Arguments
% # More About
% # References
% # See Also
%
% Additionaly we have the section Code.
%
% *URLs*: Some interesting URLs how to write an in-place documentation in MATLAB:
%
% * <http://de.mathworks.com/help/matlab/matlab_prog/publishing-matlab-code.html>
% * <http://de.mathworks.com/help/matlab/matlab_prog/marking-up-matlab-comments-for-publishing.html>
% * <http://de.mathworks.com/help/matlab/matlab_prog/add-help-for-your-program.html>
% * <https://wiki.hpcc.msu.edu/pages/viewpage.action?pageId=17599292>
% (auto-documentation in MATLAB)
%
% *Others*:
%
% * Currently, all folders with the string |closed| are ignored for the 
% publication of the source code documentation. A distinction between |doc| 
% and |docClosed| in dependence of |closed = 0| or |closed = 1| would be
% useful, but is not implemented yet. This should take into account the
% added paths in paths in |init.m|.
%
% *Look for errors*
%
% LaTeX may fail, e.g.
%
%   $$\alpha = \alpa$$
%
% Instead of checking each file, look for "Error updating Text." in HTML
% files, e.g. with "Find Files" from MATLAB.
%
%% Code: docCreate

function docCreate()

init;

if exist('closed','var') && closed == 1
    disp('Parameter closed is 1 in init.m.')
    disp('The source code documentation was only written for the public version.')
    error('Do not set the variable closed in init or set them to 0 and run docCreate again.')
end

pubMfiles = 1; % start publishMfiles (takes some time...)

%% 
% *What happens?*
%
% * Make make a link for each file by
%
%   <a href='...'>...</a>
%
% * Structure them (folder-wise).
%

%%
% *Create a list of all folders*

disp(' ')
disp('## List of all m-files REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH')
disp(' ')

%%% Look for folders
disp(' ')
disp('REPLACE_WITH_DASH_DASH List of folders REPLACE_WITH_DASH_DASH')
disp(' ')
[folderlist,~] = createFolderList();
% transpose(folderlist)

disp(' ')
disp('REPLACE_WITH_DASH_DASH Skip some items in list of folders REPLACE_WITH_DASH_DASH')
disp(' ')
folderlist = skipItemsInFolderList(folderlist);
% transpose(folderlist)

%%% Look for m-files
disp(' ')
disp('REPLACE_WITH_DASH_DASH List of m-files REPLACE_WITH_DASH_DASH')
disp(' ')

[mfileDirname,mfileName,mfilePath] = createMfileList(folderlist);

%%
% *Make index*

disp(' ')
disp('## Make index HTML file REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-')
disp(' ')
makeIndexHTML(mfileDirname,mfileName);

%%
% *Publish it*

disp(' ')
disp('## Publish it REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-')
disp(' ')
if pubMfiles
    options = pubOptions();
    publishMfiles(mfilePath,options);
end

end

%% Code: Subfunction: publishMfiles

function publishMfiles(mfilePath,options)
for i = 1:length(mfilePath)
    fprintf('   Publish %s',mfilePath{i})
    publish(mfilePath{i},options);
    fprintf(' REPLACE_WITH_DASH_DASH [OK]\n')
end
end

%% Code: Subfunction: makeIndexHTML

function makeIndexHTML(mfileDirname,mfileName)

fid = fopen('../doc/index.html', 'wt');
%  fprintf( fid, '%f,%f,%f,%f\n', a1, a2, a3, a4);
fprintf(fid,'<html>\n');
fprintf(fid,'<head>\n');
fprintf(fid,'<title>Documentation: IPscatt</title>\n');

%%% Copy CSS from MATLAB Standard Docu into index.html
fprintf(fid,'<!REPLACE_WITH_DASH_DASH css formats are copied from MATLAB published documentation REPLACE_WITH_DASH_DASH>\n');
fprintf(fid,'<style type="text/css">\n');
fidcss = fopen('docCreate/docCreateCSS.css','r');
tline = fgetl(fidcss);
while ischar(tline)
    %disp(tline)
    tline = fgetl(fidcss);
    fprintf(fid,'%s\n',tline);
end
fclose(fidcss);
fprintf(fid,'</style>\n');
%fprintf(fid,css);
%clear css;

fprintf(fid,'</head>\n');
fprintf(fid,'<body>\n');
fprintf(fid,'<div class="content">\n');
fprintf(fid,'<h1>Source Code Documentation of IPscatt&mdash;a MATLAB Toolbox for the Inverse Medium Problem in Scattering</h1>\n');
% fprintf(fid,'<br>\n');

fprintf(fid,'<p>This is the source code documentation of the toolbox IPscatt.</p>\n');

fprintf(fid,'<p>It is structured as follows:</p>\n');

fprintf(fid,'<ul>');

fprintf(fid,'<li>Read ');
htmlfile = 'start.html';
fprintf(fid,'<a href="html/%s">%s</a>',htmlfile,htmlfile);
fprintf(fid,' for a brief introduction in the usage of IPscatt and the underlying theory of direct and inverse scattering from inhomogeneous media.</li>\n');

fprintf(fid,'<li>See ');
htmlfile = 'programStructure.html';
fprintf(fid,'<a href="html/%s">%s</a>',htmlfile,htmlfile);
fprintf(fid,' for dependencies of functions.</li>\n');

fprintf(fid,'<li>Below is the structure of files in folders. \n');
fprintf(fid,'We provide a source code documentation for each function.</li>\n');

fprintf(fid,'<li>Furthermore, in ');
htmlfile = 'setiRef.html';
fprintf(fid,'<a href="html/%s">%s</a>',htmlfile,htmlfile);
fprintf(fid,' are fields of the main structure array seti summarized in one file. ');
fprintf(fid,'(The fields are used as input and output and described in the source code documentation of each corresponding file too.)');
fprintf(fid,'</li>\n');
fprintf(fid,'</ul>\n');

fprintf(fid,'<h2>Structure of Files in Folders of IPscatt</h2>');

dirnamePrev = 0;
for i = 1:length(mfileName)

    % Display foldername if new folder
    dirname = mfileDirname{i};
    if ~strcmp(dirnamePrev,dirname)
        fprintf(fid,'<br><h5>%s</h5>',dirname);
    end
    dirnamePrev = dirname;
    
    % Link to documentation file
    htmlFilename = strrep(mfileName{i},'.m','.html'); % Replace .m by .html for the path.
    fprintf(fid,'<a href="html/%s">%s</a><br>',htmlFilename,mfileName{i});
end

fprintf(fid,'</div>\n');
fprintf(fid,'</body>\n');
fprintf(fid,'</html>\n');
fclose(fid);

end

%% Code: Subfunction: createMfileList

function [listDirname,listName,listPath] = createMfileList(folderlist)
%%
% Output:
%
% * |listName|: name of m-file
% * |listPath|: path of m-file

display = 0; % 1: display results, otherwise 0
k = 0;

for i = 1:length(folderlist)+1
    if display == 1
        disp(' ')
    end
    if i == 1
        % files in current folder
        dirname = '';
        dirstring = '*.m'; % current folder
        mfile = dir(dirstring);
        if display == 1
            disp('*.m');
        end
        lookInFolder = 1;
    elseif ~isempty(folderlist{i-1}) % not used folders are marked by emty cell arrays
        % folderlist is from 1:length(folderlist)
        % using i-1 because i = 1 is reserved for first level
        dirname = folderlist{i-1};
        dirstring = sprintf('%s*.m',folderlist{i-1});
        mfile = dir(dirstring);
        if display == 1
            disp(dirstring);
        end
        lookInFolder = 1;
    else
        lookInFolder = 0;
    end
    
    if lookInFolder == 1
        for j = 1:length(mfile)
            mfileentry = sprintf('%s',mfile(j).name);
            %if exist(mfileentry,'file') == 2
            % Do not use the line above because
            % * procpost/planeplot.m and
            % * procpost/plot3Drewrite.m
            % are excluded (do not know why...)
                k = k + 1;
                if display == 1
                    fprintf('%03d | %02d | %s\n',k,j,mfileentry);
                end
                listDirname{k} = dirname; % store dirname
                listName{k} = mfileentry;
                listPath{k} = sprintf('%s%s',dirname,mfileentry);
            %end
            clear mfileentry;
        end
    end
end

end

%% Code: Subfunction: createFolderList

function [list,j] = createFolderList(varargin)
%%
% *Create a folder list*
%
% Store the relative path of (approximately) all folders and subfolders
%
%   [folderlist,j] = createFolderList();
% or
%   [folderlist,j] = createFolderList(list,j,path);
%   [folderlist,j] = createFolderList('',0,'proc/');

%%
% But this does not contain all folders..., e.g. not
%
% * inexpdata/fresnel_opus_1,
% * inexpdata/fresnel_opus_2.
%
% It is not clear why, but these folders are uninteresting for the
% documentation.

display = 0; % 1: display results, 0: not...

switch nargin
    case 0
        list = '';
        j = 0;
        folder = dir;
        path = '';
    case 1 || 2
        error('folderlist needs 0 or 3 arguments.')
    case 3
        list = varargin{1};
        j    = varargin{2};
        path = varargin{3};
        folder = dir(path); %e.g. folder = dir('proc')
end

for i = 1:length(folder)
    folderentry = sprintf('%s',folder(i).name);
    
    % Do not use
    % exist(folderentry,'file') == 7
    % instead of
    % exist(folderentry,'dir') == 7
    % Why?
    % 'file' does not work correctly...
    % Some dirs are not recognized, if you put the name as string.
    % (e.g. proc/setData).
    % (It is no problem in case of exist('proc/setData','file') == 7.)
    
    if exist(folderentry,'dir') == 7 && ~strcmp(folderentry,'.') && ~strcmp(folderentry,'..')
        j = j + 1;
        %list{j} = folderentry;
        if display == 1
            fprintf('%02d | %s%s\n',j,path,folderentry)
        end
        list{j} = sprintf('%s%s/',path,folderentry);
        [list,j] = createFolderList(list,j,list{j});
%     else
%         fprintf('NO FOLDER: %s%s\n',path,folderentry)
    end
    
    clear folderentry;
end
end

%% Code: Subfunction: skipItemsInFolderList

function folderlist = skipItemsInFolderList(folderlist)
for i = 1:length(folderlist)
    % Ignore folders with string "closed" by setting the item to [].
    str = folderlist{i};
    expression = 'closed'; % \w = [a-zA-Z_0-9]
    matchStr = regexp(str,expression,'match','ignorecase');
    if ~isempty(matchStr)
        folderlist{i} = []; % delete cell array entry
    end
    clear str expression matchStr;
    % ignore folder nogit
    if strcmp(folderlist{i},'nogit/')
        folderlist{i} = [];
    end
end
end

%% Code: Subfunction: pubOptions

function options = pubOptions()
p = mfilename('fullpath'); % full path of this file
f = fileparts(p); % folder path (without file)
pubDir = sprintf('%s/../doc/html',f); % full path
clear p f;

if exist(pubDir,'dir') ~= 7
    mkdir(pubDir);
end

%options.outputDir = '/home/fbuergel/Documents/rebis/doc/html'; % full path
options.outputDir = pubDir; clear pubDir;
options.format    = 'html'; % default
options.evalCode  = false; % do not evaluate the code

%options.showCode = true; % show code (default)
%options.showCode = false; % do not show code

%publish('start.m',options)
%clear options
end

%% Remember the function exist
% Remember the MATLAB function exist, see
% <https://de.mathworks.com/help/matlab/ref/exist.html>.
% 
% *2, i.e. one of the following is true*
%
% * name exists on your MATLAB search path as a file with extension .m or .mlx.
% * name is the name of an ordinary file on your MATLAB search path.
% * name is the full pathname to any file.
%
% *7, i.e. the name is a folder*
%
%   A = exist('name','kind')
%
% * dir : Checks only for folders.
% * file: Checks only for files or folders.

% if exist('...','file')
%     if exist('...','dir') % must be a folder
%        ...
%            
%     else % must be a file
%         dir *my*.m
%         
%     end
% end
% 
% 

##### SOURCE END #####
--></body></html>