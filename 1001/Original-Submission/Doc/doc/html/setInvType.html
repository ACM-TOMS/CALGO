
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>setInvType</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-04-30"><meta name="DC.source" content="setInvType.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>setInvType</h1><!--introduction--><p>Set reconstruction parameters in dependence of seti.invNo (inversion method number).</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Input Arguments</a></li><li><a href="#4">Output Arguments</a></li><li><a href="#5">More About</a></li><li><a href="#6">See Also</a></li><li><a href="#7">Code</a></li></ul></div><h2 id="1">Syntax</h2><pre class="language-matlab">seti = setInvType(seti)
seti = setInvType(seti,dispDepth)
</pre><h2 id="2">Description</h2><p><tt>seti = setInvType(seti)</tt> sets the reconstruction parameters in the structure array seti in dependence of the inversion method number seti.invNo.</p><p><tt>seti = setInvType(seti,dispDepth)</tt> does the same but allows to control the displayed messages by <tt>dispDepth</tt>.</p><div><ul><li>If no <b>seti.invNo</b> was set, set <b>default 6</b>.</li><li>In public version only invNo 6 is available.</li></ul></div><h2 id="3">Input Arguments</h2><div><ul><li><tt>seti</tt>        :   struct seti</li></ul></div><p><b>Optional Input Argument</b></p><div><ul><li><tt>dispDepth</tt>   : Depth of displayed messages (0: no, 1 or greater: yes).</li></ul></div><p><b>Optional Input Arguments of structure <tt>seti</tt></b></p><p>If the fields does not exist, default values are set in this function.</p><div><ul><li><tt>seti.invNo</tt>  : Number of reconstruction setting (default: 6)                   (invNo = 6 is the only one supported in public version)</li><li><tt>seti.alpha</tt>  : Regularization parameter for sparsity penalty                   (default: 500).</li><li><tt>seti.beta</tt>   : Regularization parameter for total variation penalty                   (default: 1E-5).</li><li><tt>seti.tau</tt>    : Discrepancy principle stops at parameter tau * delta                   (default: 2.5). (Note that delta is the relative noise                   level <tt>seti.delta</tt>.)</li></ul></div><h2 id="4">Output Arguments</h2><div><ul><li><tt>seti.inv</tt>        : Type of reconstruction method: 'pda' or 'shrinkage'</li><li><tt>seti.useWavelet</tt> : Using wavelets (1) or not (0)                       (Wavelets are not available in public version)</li><li><tt>seti.tF</tt>     : Terms belonging to functional F                   (e.g. <tt>seti.tF = {'fd','fg'}</tt>; See table below.)</li><li><tt>seti.tG</tt>     : Terms belonging to functional G                   (e.g. <tt>seti.tG = {'fs','fp'}</tt>; See table below.)</li><li><tt>seti.pNorm</tt>  : Index p for p-Schatten-Norm of measurements to define                   discrepancy.</li><li><i>More about pNorm:</i>   default: pNorm = 2, i.e. essentially Frobenius-Norm</li><li><i>More about pNorm:</i>   in case of inv = 'pda' with invNo 3 to 6                         set pNorm = 2 (automatically) because it is required</li><li><tt>seti.qNorm</tt>      : Index q for q-Norm of contrasts to define sparsity penalty</li><li><i>More about qNorm</i>: Standard: qNorm = 1 -&gt; l^1 minimization.</li><li><i>More about qNorm</i>: in case of inv = 'pda' set qNorm = 1 (automatically)                       because it is required.</li><li><tt>seti.p</tt>      : Exponent in discrepancy-term <img src="setInvType_eq12114434532218645993.png" alt="$1/p ||...||^p_2$"> with <img src="setInvType_eq03135539543662799617.png" alt="$p = 1$"> or <img src="setInvType_eq17262503285923366262.png" alt="$2$">                   (used e.g. in <a href="setFuncsPda.html">setFuncsPda.html</a>)                   (default: <tt>seti.p = 2</tt>).</li></ul></div><p>Note: <b>p ~= pNorm</b> in general!                   (but: in case of inv = 'shrinkage':                   pNorm and qNorm are used as exponents too.)</p><h2 id="5">More About</h2><p><b>Shrinkage</b></p><div><ul><li>You can influence method changing seti.pNorm (default 2), seti.qNorm (default 1).</li><li>Parameter seti.p has no influence in shrinkage.   (In case of shrinkage(!) exponents are always seti.pNorm and seti.qNorm.)</li></ul></div><p><b>pda (primal-dual algorithm)</b></p><div><ul><li>In pda must be seti.pNorm = 2, seti.qNorm = 1 (except for invNo = 7).   (In cases of invNo = 3:1:6 this is checked below.)</li><li>In case of invNo = 7 seti.pNorm must be the same as seti.p. (This case   is not restricted to seti.qNorm = 1).</li><li>Parameter seti.p can be changed only in pda with wavelets.   So, you have invNo 4 and 5 (without wavelets it's fixed p = 2).</li><li>Details of used terms (fd, fs, ...) and their belonging to term F or G   are inside <a href="pda.html">pda.html</a>.</li></ul></div><p><b>invNo: inversion number: 1--8</b></p><div><ul><li>d: discrepancy</li><li>s: sparsity</li><li>g: total variation (g for gradient...)</li><li>p: physical bounds</li></ul></div><pre>No. d    s    g   p  (explanation)
1) fd   fs   --- fp  (shrinkage without wavelets)
2) |fd  fsw  --- |fp (shrinkage with wavelets)
3) fd   fs   --- fp  (pda without wavelets)
4) fdw1 fsw  --- |fp (pda with wavelets, exponent p = 1)
5) fdw2 |fsw --- |fp (pda with wavelets, exponent p = 2)
6) fd   fs   fg  fp  (pda without wavelets)
7) fdw3 fsw  --- |fp (pda with wavelets, exponent p = p)
8) fd   fs   fg  fp2 (pda without wavelets; like 6 but with individual
                      physical bounds for background)</pre><p><b>Minimization functional in case of invNo = 6 (default case)</b></p><p><img src="setInvType_eq12799784419893847904.png" alt="$$ \min_{h \in X}&#xA;     \underbrace{&#xA;         \frac{1}{2}\|\mathcal{F}'(q)[h]+\mathcal{F}(q) - F_\mathrm{meas}^\delta\|_\mathrm{F}^2&#xA;         }_{=: f_\mathrm{dis}(h),\ \mathrm{discrepancy\ (linearized\ problem)}}&#xA;   + \underbrace{\alpha \|q+h\|_\mathrm{1}}_{=: f_\mathrm{spa}(h),\ \mathrm{sparsity\ penalty}}&#xA;   + \underbrace{\beta \| \nabla (q+h) \|_\mathrm{1}}_{=: f_\mathrm{tv}(h),\ \mathrm{total\ variation\ penalty}}&#xA;   + \underbrace{&#xA;         \delta_{[a,b]}( \mathrm{Re}(q+h) ) +&#xA;         \delta_{[c,d]}(\mathrm{Im}(q+h) )}_{=: f_\mathrm{phy}(h),\ \mathrm{penalty\ for\ physical\ bounds}&#xA;         }.&#xA;   $$"></p><p><b>Minimization functional in a more general case</b></p><p>Notation:</p><div><ul><li><img src="setInvType_eq13711720740942510956.png" alt="$p = \texttt{seti.p}$"></li><li><img src="setInvType_eq02656395963417867870.png" alt="$P = \texttt{seti.pNorm}$"></li><li><img src="setInvType_eq04651634320164000028.png" alt="$Q = \texttt{seti.qNorm}$"></li></ul></div><p><img src="setInvType_eq14930915426491133225.png" alt="$$ \min_{h \in X}&#xA;     \underbrace{&#xA;         \frac{1}{p}\|\mathcal{F}'(q)[h]+\mathcal{F}(q) -&#xA;         F_\mathrm{meas}^\delta\|_\mathrm{Schatten\ P-Norm}^p&#xA;         }_{\mathrm{discrepancy\ (linearized\ problem)}}&#xA;   + \underbrace{\alpha \|q+h\|_Q}_{\mathrm{sparsity\ penalty}}&#xA;   + \underbrace{\beta \| \nabla (q+h) \|_\mathrm{1}}_{\mathrm{total\ variation\ penalty}}&#xA;   + \underbrace{&#xA;         \delta_{[a,b]}( \mathrm{Re}(q+h) ) +&#xA;         \delta_{[c,d]}(\mathrm{Im}(q+h) )}_{\mathrm{penalty\ for\ physical\ bounds}&#xA;         }.&#xA;   $$"></p><h2 id="6">See Also</h2><div><ul><li><a href="setRecon.html">setRecon.html</a></li><li><a href="pda.html">pda.html</a></li></ul></div><h2 id="7">Code</h2><pre class="codeinput"><span class="keyword">function</span> seti = setInvType(seti,varargin)
</pre><pre class="codeinput"><span class="keyword">if</span> nargin == 2
    dispDepth = varargin{1};
<span class="keyword">else</span>
    dispDepth = 0;
<span class="keyword">end</span>

seti = checkfield(seti,<span class="string">'invNo'</span>,6,dispDepth);

<span class="comment">% idea for other name "invset" (inv setting...) (or name in suffix of dir...)</span>

<span class="comment">% "working parameters", i.e. some working parameters in case of contrast twoCornersOneBall2D</span>

<span class="keyword">switch</span> seti.invNo
    <span class="keyword">case</span> 1 <span class="comment">% shrinkage, no wavelets</span>
        <span class="comment">%shrinkWavNo</span>
        seti.inv = <span class="string">'shrinkage'</span>;
        seti.useWavelet = 0;

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,0.005,dispDepth); <span class="comment">% was 0.002 until 201704</span>

    <span class="keyword">case</span> 2 <span class="comment">% shrinkage, with wavelets</span>
        <span class="comment">%shrinkWavYes</span>
        seti.inv = <span class="string">'shrinkage'</span>;
        seti.useWavelet = 1;

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,0.02,dispDepth);

    <span class="keyword">case</span> 3 <span class="comment">% pda, without wavelets, without fg</span>
        <span class="comment">%pdaWavNoGradNo</span>
        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 0;
        <span class="comment">% without wavelets, without fg term</span>
        <span class="comment">% (and p = 2, but p is not set, because ^2 in Code)</span>
        <span class="comment">% F(x) = fd = 1/2 || x + FF(q) - FmeasDelta||WS,2^2</span>
        <span class="comment">% K(x) = FF'(q)[x]</span>
        <span class="comment">% So: F(K(x)) = 1/2 || FF'(q)[x] + FF(q) - FmeasDelta||WS,2^2</span>
        <span class="comment">% G(x) = fs + fp = \alpha ||Re(q+x)||_1 + \alpha ||Im(q+x)|| + delta_[0,c](Im(q+x) + delta_[a,b](Re(q+x))</span>
        seti.tF = {<span class="string">'fd'</span>};
        seti.tG = {<span class="string">'fs'</span>,<span class="string">'fp'</span>}; <span class="comment">% cell array of strings</span>

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,2,dispDepth);

    <span class="keyword">case</span> 4 <span class="comment">% pda, with wavelets and p = 1</span>
        <span class="comment">%pdaWavYesp1</span>
        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 1;
        seti.p = 1; <span class="comment">% Attention: p ~= pNorm in general!</span>
        seti.tF = {<span class="string">'fdw1'</span>,<span class="string">'fsw'</span>};
        seti.tG = {<span class="string">'fp'</span>};

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,0.05,dispDepth);

    <span class="keyword">case</span> 5 <span class="comment">% pda, with wavelets and p = 2</span>
        <span class="comment">%pdaWavYesp2</span>
        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 1;
        seti.p = 2; <span class="comment">% Attention: p ~= pNorm in general!</span>
        seti.tF = {<span class="string">'fdw2'</span>,<span class="string">'fsw'</span>};
        seti.tG = {<span class="string">'fp'</span>};

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,0.3,dispDepth);

    <span class="keyword">case</span> 6 <span class="comment">% pda, without wavelets, with fg term</span>
        <span class="comment">% (and p = 2, but p is not set, because ^2 in Code)</span>
        <span class="comment">%pdaWavNoGradYes</span>
        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 0;
        seti.tF = {<span class="string">'fd'</span>,<span class="string">'fg'</span>};
        seti.tG = {<span class="string">'fs'</span>,<span class="string">'fp'</span>};

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,500,dispDepth);
        seti = checkfield(seti,<span class="string">'beta'</span>,1E-5,dispDepth);
        seti = checkfield(seti,<span class="string">'tau'</span>,2.5,dispDepth);

    <span class="keyword">case</span> 7 <span class="comment">% pda with wavelets: p-Norm in discrepancy, q-Norm in penalty</span>
        <span class="comment">% (This case requires p = P, i.e. seti.p = seti.pNorm.)</span>
        <span class="comment">%</span>
        <span class="comment">% -- Overview of the formulas:</span>
        <span class="comment">%</span>
        <span class="comment">% F(x) = fd + fs with</span>
        <span class="comment">% fd = 1/P || x + FF(qW) - FmeasDelta||WS,P^P</span>
        <span class="comment">% fs = (\alpha/Q) ||Re(q+x)||_Q^Q + (\alpha/Q) ||Im(q+x)||_Q^Q</span>
        <span class="comment">% (To keep the notation simple waveletes are omitted in the notation of fs.)</span>
        <span class="comment">% K(x) = [Kdis(x), Kspa(x)] with Kdis(x) = FF'(qW)[x]</span>
        <span class="comment">% So: F(K(x)) = 1/P || FF'(qW)[x] + FF(qW) - FmeasDelta||WS,P^P</span>
        <span class="comment">%               + sparsity term</span>
        <span class="comment">% G(x) = fp = delta_[0,c](Im(q+x) + delta_[a,b](Re(q+x))</span>

        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 1;
        seti.tF = {<span class="string">'fdw3'</span>,<span class="string">'fsw'</span>};
        seti.tG = {<span class="string">'fp'</span>};

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,0.03,dispDepth);

    <span class="keyword">case</span> 8 <span class="comment">% (pda without wavelets; like 6 but with individual physical bounds for background)</span>
        seti.inv = <span class="string">'pda'</span>;
        seti.useWavelet = 0;
        seti.tF = {<span class="string">'fd'</span>,<span class="string">'fg'</span>};
        seti.tG = {<span class="string">'fs'</span>,<span class="string">'fp2'</span>};

        <span class="comment">% working parameters</span>
        seti = checkfield(seti,<span class="string">'alpha'</span>,500,dispDepth);
        seti = checkfield(seti,<span class="string">'beta'</span>,1E-5,dispDepth);
        seti = checkfield(seti,<span class="string">'tau'</span>,2.5,dispDepth);

<span class="keyword">end</span>
</pre><p><b>Check pNorm and qNorm compatibility to cases</b></p><pre class="codeinput"><span class="keyword">if</span> ((3 &lt;= seti.invNo &amp;&amp; seti.invNo &lt;= 6) || seti.invNo == 8) &amp;&amp; (~isfield(seti,<span class="string">'pNorm'</span>) || seti.pNorm ~= 2)
    seti.pNorm = 2;
    <span class="keyword">if</span> dispDepth &gt;= 1
        disp(<span class="string">'   PDA cases with invNo 3 to 6 and 8 requires pNorm = 2. Set it.'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">if</span> strcmp(seti.inv,<span class="string">'pda'</span>) &amp;&amp; (~isfield(seti,<span class="string">'qNorm'</span>) || seti.qNorm ~= 1)
    seti.qNorm = 1;
    setmessage(seti,<span class="string">'qNorm'</span>,dispDepth);
    <span class="keyword">if</span> dispDepth &gt;= 1
        disp(<span class="string">'   (To use pda, you have to use parameter qNorm = 1.)'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% setInvType
% Set reconstruction parameters in dependence of seti.invNo 
% (inversion method number).
%
%% Syntax
%
%   seti = setInvType(seti)
%   seti = setInvType(seti,dispDepth)
%
%% Description
% |seti = setInvType(seti)| sets the reconstruction parameters in the
% structure array seti in dependence of the inversion method number
% seti.invNo.
%
% |seti = setInvType(seti,dispDepth)| does the same but allows to control
% the displayed messages by |dispDepth|.
%
% * If no *seti.invNo* was set, set *default 6*.
% * In public version only invNo 6 is available.
%
%% Input Arguments
%
% * |seti|        :   struct seti
%
% *Optional Input Argument*
%
% * |dispDepth|   : Depth of displayed messages (0: no, 1 or greater: yes).
%
% *Optional Input Arguments of structure |seti|*
%
% If the fields does not exist, default values are set in this function.
%
% * |seti.invNo|  : Number of reconstruction setting (default: 6)
%                   (invNo = 6 is the only one supported in public version)
% * |seti.alpha|  : Regularization parameter for sparsity penalty 
%                   (default: 500).
% * |seti.beta|   : Regularization parameter for total variation penalty
%                   (default: 1E-5).
% * |seti.tau|    : Discrepancy principle stops at parameter tau * delta
%                   (default: 2.5). (Note that delta is the relative noise
%                   level |seti.delta|.)
%
%% Output Arguments
%
% * |seti.inv|        : Type of reconstruction method: 'pda' or 'shrinkage'
% * |seti.useWavelet| : Using wavelets (1) or not (0)
%                       (Wavelets are not available in public version)
% * |seti.tF|     : Terms belonging to functional F
%                   (e.g. |seti.tF = {'fd','fg'}|; See table below.)
% * |seti.tG|     : Terms belonging to functional G
%                   (e.g. |seti.tG = {'fs','fp'}|; See table below.)
% * |seti.pNorm|  : Index p for p-Schatten-Norm of measurements to define
%                   discrepancy.
% * _More about pNorm:_   default: pNorm = 2, i.e. essentially Frobenius-Norm
% * _More about pNorm:_   in case of inv = 'pda' with invNo 3 to 6
%                         set pNorm = 2 (automatically) because it is required
% * |seti.qNorm|      : Index q for q-Norm of contrasts to define sparsity penalty
% * _More about qNorm_: Standard: qNorm = 1 -> l^1 minimization.
% * _More about qNorm_: in case of inv = 'pda' set qNorm = 1 (automatically)
%                       because it is required.
% * |seti.p|      : Exponent in discrepancy-term $1/p ||...||^p_2$ with $p = 1$ or $2$
%                   (used e.g. in <setFuncsPda.html>)
%                   (default: |seti.p = 2|).
%
% Note: *p ~= pNorm* in general!
%                   (but: in case of inv = 'shrinkage':
%                   pNorm and qNorm are used as exponents too.)
%
%% More About
%
% *Shrinkage*
%
% * You can influence method changing
% seti.pNorm (default 2), seti.qNorm (default 1).
% * Parameter seti.p has no influence in shrinkage.
%   (In case of shrinkage(!) exponents are always seti.pNorm and seti.qNorm.)
%
% *pda (primal-dual algorithm)*
%
% * In pda must be seti.pNorm = 2, seti.qNorm = 1 (except for invNo = 7).
%   (In cases of invNo = 3:1:6 this is checked below.)
% * In case of invNo = 7 seti.pNorm must be the same as seti.p. (This case
%   is not restricted to seti.qNorm = 1).
% * Parameter seti.p can be changed only in pda with wavelets.
%   So, you have invNo 4 and 5 (without wavelets it's fixed p = 2).
% * Details of used terms (fd, fs, ...) and their belonging to term F or G
%   are inside <pda.html>.
%
% *invNo: inversion number: 1REPLACE_WITH_DASH_DASH8*
%
% * d: discrepancy
% * s: sparsity
% * g: total variation (g for gradient...)
% * p: physical bounds
%
%
%  No. d    s    g   p  (explanation)
%  1) fd   fs   REPLACE_WITH_DASH_DASH- fp  (shrinkage without wavelets)
%  2) |fd  fsw  REPLACE_WITH_DASH_DASH- |fp (shrinkage with wavelets)
%  3) fd   fs   REPLACE_WITH_DASH_DASH- fp  (pda without wavelets)
%  4) fdw1 fsw  REPLACE_WITH_DASH_DASH- |fp (pda with wavelets, exponent p = 1)
%  5) fdw2 |fsw REPLACE_WITH_DASH_DASH- |fp (pda with wavelets, exponent p = 2)
%  6) fd   fs   fg  fp  (pda without wavelets)
%  7) fdw3 fsw  REPLACE_WITH_DASH_DASH- |fp (pda with wavelets, exponent p = p)
%  8) fd   fs   fg  fp2 (pda without wavelets; like 6 but with individual 
%                        physical bounds for background)
%
%
% *Minimization functional in case of invNo = 6 (default case)*
%
% $$ \min_{h \in X} 
%      \underbrace{
%          \frac{1}{2}\|\mathcal{F}'(q)[h]+\mathcal{F}(q) - F_\mathrm{meas}^\delta\|_\mathrm{F}^2
%          }_{=: f_\mathrm{dis}(h),\ \mathrm{discrepancy\ (linearized\ problem)}}
%    + \underbrace{\alpha \|q+h\|_\mathrm{1}}_{=: f_\mathrm{spa}(h),\ \mathrm{sparsity\ penalty}}
%    + \underbrace{\beta \| \nabla (q+h) \|_\mathrm{1}}_{=: f_\mathrm{tv}(h),\ \mathrm{total\ variation\ penalty}}
%    + \underbrace{
%          \delta_{[a,b]}( \mathrm{Re}(q+h) ) +
%          \delta_{[c,d]}(\mathrm{Im}(q+h) )}_{=: f_\mathrm{phy}(h),\ \mathrm{penalty\ for\ physical\ bounds}
%          }.
%    $$
%
% *Minimization functional in a more general case*
%
% Notation:
%
% * $p = \texttt{seti.p}$
% * $P = \texttt{seti.pNorm}$
% * $Q = \texttt{seti.qNorm}$
%
% $$ \min_{h \in X} 
%      \underbrace{
%          \frac{1}{p}\|\mathcal{F}'(q)[h]+\mathcal{F}(q) -
%          F_\mathrm{meas}^\delta\|_\mathrm{Schatten\ P-Norm}^p
%          }_{\mathrm{discrepancy\ (linearized\ problem)}}
%    + \underbrace{\alpha \|q+h\|_Q}_{\mathrm{sparsity\ penalty}}
%    + \underbrace{\beta \| \nabla (q+h) \|_\mathrm{1}}_{\mathrm{total\ variation\ penalty}}
%    + \underbrace{
%          \delta_{[a,b]}( \mathrm{Re}(q+h) ) +
%          \delta_{[c,d]}(\mathrm{Im}(q+h) )}_{\mathrm{penalty\ for\ physical\ bounds}
%          }.
%    $$
%
%% See Also
%
% * <setRecon.html>
% * <pda.html>
%
%% Code
%
function seti = setInvType(seti,varargin)

if nargin == 2
    dispDepth = varargin{1};
else
    dispDepth = 0;
end

seti = checkfield(seti,'invNo',6,dispDepth); 

% idea for other name "invset" (inv setting...) (or name in suffix of dir...)

% "working parameters", i.e. some working parameters in case of contrast twoCornersOneBall2D

switch seti.invNo
    case 1 % shrinkage, no wavelets
        %shrinkWavNo
        seti.inv = 'shrinkage';
        seti.useWavelet = 0;
        
        % working parameters
        seti = checkfield(seti,'alpha',0.005,dispDepth); % was 0.002 until 201704
        
    case 2 % shrinkage, with wavelets
        %shrinkWavYes
        seti.inv = 'shrinkage';
        seti.useWavelet = 1;
        
        % working parameters
        seti = checkfield(seti,'alpha',0.02,dispDepth);
       
    case 3 % pda, without wavelets, without fg
        %pdaWavNoGradNo
        seti.inv = 'pda';
        seti.useWavelet = 0;
        % without wavelets, without fg term
        % (and p = 2, but p is not set, because ^2 in Code)
        % F(x) = fd = 1/2 || x + FF(q) - FmeasDelta||WS,2^2
        % K(x) = FF'(q)[x]
        % So: F(K(x)) = 1/2 || FF'(q)[x] + FF(q) - FmeasDelta||WS,2^2
        % G(x) = fs + fp = \alpha ||Re(q+x)||_1 + \alpha ||Im(q+x)|| + delta_[0,c](Im(q+x) + delta_[a,b](Re(q+x))
        seti.tF = {'fd'};
        seti.tG = {'fs','fp'}; % cell array of strings

        % working parameters
        seti = checkfield(seti,'alpha',2,dispDepth);
        
    case 4 % pda, with wavelets and p = 1
        %pdaWavYesp1
        seti.inv = 'pda';
        seti.useWavelet = 1;
        seti.p = 1; % Attention: p ~= pNorm in general!
        seti.tF = {'fdw1','fsw'};
        seti.tG = {'fp'};
        
        % working parameters
        seti = checkfield(seti,'alpha',0.05,dispDepth); 

    case 5 % pda, with wavelets and p = 2
        %pdaWavYesp2
        seti.inv = 'pda';
        seti.useWavelet = 1;
        seti.p = 2; % Attention: p ~= pNorm in general!
        seti.tF = {'fdw2','fsw'};
        seti.tG = {'fp'};
        
        % working parameters
        seti = checkfield(seti,'alpha',0.3,dispDepth); 

    case 6 % pda, without wavelets, with fg term
        % (and p = 2, but p is not set, because ^2 in Code)
        %pdaWavNoGradYes
        seti.inv = 'pda';
        seti.useWavelet = 0;
        seti.tF = {'fd','fg'};
        seti.tG = {'fs','fp'};
        
        % working parameters
        seti = checkfield(seti,'alpha',500,dispDepth);
        seti = checkfield(seti,'beta',1E-5,dispDepth);
        seti = checkfield(seti,'tau',2.5,dispDepth);
        
    case 7 % pda with wavelets: p-Norm in discrepancy, q-Norm in penalty
        % (This case requires p = P, i.e. seti.p = seti.pNorm.)
        %
        % REPLACE_WITH_DASH_DASH Overview of the formulas:
        %
        % F(x) = fd + fs with
        % fd = 1/P || x + FF(qW) - FmeasDelta||WS,P^P
        % fs = (\alpha/Q) ||Re(q+x)||_Q^Q + (\alpha/Q) ||Im(q+x)||_Q^Q
        % (To keep the notation simple waveletes are omitted in the notation of fs.)
        % K(x) = [Kdis(x), Kspa(x)] with Kdis(x) = FF'(qW)[x]
        % So: F(K(x)) = 1/P || FF'(qW)[x] + FF(qW) - FmeasDelta||WS,P^P
        %               + sparsity term
        % G(x) = fp = delta_[0,c](Im(q+x) + delta_[a,b](Re(q+x))

        seti.inv = 'pda';
        seti.useWavelet = 1;
        seti.tF = {'fdw3','fsw'};
        seti.tG = {'fp'};
        
        % working parameters
        seti = checkfield(seti,'alpha',0.03,dispDepth);
        
    case 8 % (pda without wavelets; like 6 but with individual physical bounds for background)
        seti.inv = 'pda';
        seti.useWavelet = 0;
        seti.tF = {'fd','fg'};
        seti.tG = {'fs','fp2'};
        
        % working parameters
        seti = checkfield(seti,'alpha',500,dispDepth);
        seti = checkfield(seti,'beta',1E-5,dispDepth);
        seti = checkfield(seti,'tau',2.5,dispDepth);
        
end

%%
% *Check pNorm and qNorm compatibility to cases*
%
if ((3 <= seti.invNo && seti.invNo <= 6) || seti.invNo == 8) && (~isfield(seti,'pNorm') || seti.pNorm ~= 2)
    seti.pNorm = 2;
    if dispDepth >= 1
        disp('   PDA cases with invNo 3 to 6 and 8 requires pNorm = 2. Set it.');
    end
end

if strcmp(seti.inv,'pda') && (~isfield(seti,'qNorm') || seti.qNorm ~= 1)
    seti.qNorm = 1;
    setmessage(seti,'qNorm',dispDepth);
    if dispDepth >= 1
        disp('   (To use pda, you have to use parameter qNorm = 1.)');
    end
end


end

##### SOURCE END #####
--></body></html>