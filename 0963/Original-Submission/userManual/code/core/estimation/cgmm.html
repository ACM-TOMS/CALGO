<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cgmm</title>
  <meta name="keywords" content="cgmm">
  <meta name="description" content="CGMM Performs continuum of moments estimation for the model specified by cf.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">code</a> &gt; <a href="#">core</a> &gt; <a href="index.html">estimation</a> &gt; cgmm.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for code/core/estimation&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>cgmm
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>CGMM Performs continuum of moments estimation for the model specified by cf.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [theta_cgmm, theta_first] = cgmm(y, tau, cf, theta_0, grid_min, grid_max, grid_res, lb, ub, options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">CGMM Performs continuum of moments estimation for the model specified by cf.

  [theta_cgmm, theta_first] = cgmm(y, tau, cf, theta_0, grid_min, grid_max
    , grid_res, lb, ub, options) performs conditional continuum of moments
    estimation for the model specified by its characteristic function cf,
    based on the time series of log prices y and a start parameter theta_0
    for the optimization.

    INPUT       y: log prices of the assets
              tau: real valued time difference
               cf: characteristic function. cf is supposed to expect omega, 
                   theta, y_t, tau with
                   - omega a size(y,2) x grid_res matrix
                   - theta the flat parameter vector (interpretation by cf)
                   - y_t a (size(y,1)-1) x size(y,2) matrix
                   - tau a real valued time difference
                   cf is supposed to calculate to characteristic function
                   of the continuous returns conditional on the log prices.
          theta_0: initial parameter vector
         grid_min: left end of marginal evaluation grid
         grid_max: right end of marginal evaluation grid
         grid_res: resolution of marginal evaluation grid
               lb: lower bounds for the parameters
               ub: upper bounds for the parameters
          options: structure (or vector) of options for the optimization

    OUTPUT  theta_cgmm: CGMM parameter estimate
           theta_first: first step parameter estimate

 See also CF_PCSV_V_THETA, CF_WASC_THETA.

 created by Benedikt Rudolph
 DATE: 20-Aug-2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../code/util/misc/mgrid.html" class="code" title="function g = mgrid(margin, d)">mgrid</a>	MGRID Creates the d-dimensional grid with margin as 1-dimensional margin.</li><li><a href="../../../code/util/misc/prepare_nl_opt_call.html" class="code" title="function nl_opt = prepare_nl_opt_call(obj, x0, lb, ub, options)">prepare_nl_opt_call</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../code/main/pcsv_estimation.html" class="code" title="">pcsv_estimation</a>	</li><li><a href="../../../code/main/pcsv_monte_carlo.html" class="code" title="">pcsv_monte_carlo</a>	</li><li><a href="../../../code/main/pcsv_partial_estimation.html" class="code" title="">pcsv_partial_estimation</a>	</li><li><a href="../../../code/main/pcsv_partial_monte_carlo.html" class="code" title="">pcsv_partial_monte_carlo</a>	</li><li><a href="../../../code/main/wasc_estimation.html" class="code" title="">wasc_estimation</a>	</li><li><a href="../../../code/main/wasc_monte_carlo.html" class="code" title="">wasc_monte_carlo</a>	</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [theta_cgmm, theta_first] = cgmm(y, tau, cf, theta_0 </a><span class="keyword">...</span>
0002     , grid_min, grid_max, grid_res, lb, ub, options)
0003 <span class="comment">%CGMM Performs continuum of moments estimation for the model specified by cf.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%  [theta_cgmm, theta_first] = cgmm(y, tau, cf, theta_0, grid_min, grid_max</span>
0006 <span class="comment">%    , grid_res, lb, ub, options) performs conditional continuum of moments</span>
0007 <span class="comment">%    estimation for the model specified by its characteristic function cf,</span>
0008 <span class="comment">%    based on the time series of log prices y and a start parameter theta_0</span>
0009 <span class="comment">%    for the optimization.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%    INPUT       y: log prices of the assets</span>
0012 <span class="comment">%              tau: real valued time difference</span>
0013 <span class="comment">%               cf: characteristic function. cf is supposed to expect omega,</span>
0014 <span class="comment">%                   theta, y_t, tau with</span>
0015 <span class="comment">%                   - omega a size(y,2) x grid_res matrix</span>
0016 <span class="comment">%                   - theta the flat parameter vector (interpretation by cf)</span>
0017 <span class="comment">%                   - y_t a (size(y,1)-1) x size(y,2) matrix</span>
0018 <span class="comment">%                   - tau a real valued time difference</span>
0019 <span class="comment">%                   cf is supposed to calculate to characteristic function</span>
0020 <span class="comment">%                   of the continuous returns conditional on the log prices.</span>
0021 <span class="comment">%          theta_0: initial parameter vector</span>
0022 <span class="comment">%         grid_min: left end of marginal evaluation grid</span>
0023 <span class="comment">%         grid_max: right end of marginal evaluation grid</span>
0024 <span class="comment">%         grid_res: resolution of marginal evaluation grid</span>
0025 <span class="comment">%               lb: lower bounds for the parameters</span>
0026 <span class="comment">%               ub: upper bounds for the parameters</span>
0027 <span class="comment">%          options: structure (or vector) of options for the optimization</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%    OUTPUT  theta_cgmm: CGMM parameter estimate</span>
0030 <span class="comment">%           theta_first: first step parameter estimate</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% See also CF_PCSV_V_THETA, CF_WASC_THETA.</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% created by Benedikt Rudolph</span>
0035 <span class="comment">% DATE: 20-Aug-2012</span>
0036   
0037   p = size(y,2); <span class="comment">% dimension of the model</span>
0038   T = size(y,1); <span class="comment">% number of observations</span>
0039   
0040   <span class="comment">% choose a fixed grid according to the model's dimension for integration</span>
0041   grid_margin = grid_min:(grid_max-grid_min)/(grid_res-1):grid_max;
0042   omega = <a href="../../../code/util/misc/mgrid.html" class="code" title="function g = mgrid(margin, d)">mgrid</a>(grid_margin, p);
0043   
0044   <span class="comment">% prepare fixed parameters</span>
0045   r = diff(y);
0046   s = (grid_max-grid_min)/6;
0047   <span class="comment">% mv std normal</span>
0048   w_kernel = @(x) exp(-0.5*diag(x'*x)/(s^2))/((2*3.1415*s)^(p*0.5));
0049   pi = w_kernel(omega)'; <span class="comment">% weighting for L^2(pi) norm</span>
0050   pi = pi/sum(pi);
0051   sqrt_pi = sqrt(pi);
0052   
0053   <span class="comment">% precalculate empirical characteristic function (independent from theta)</span>
0054   ecf = exp(1i*r*omega);
0055   
0056   <span class="comment">% obtain the theoretical characteristic function as a function of theta</span>
0057   phi = @(theta) cf(omega, theta, y, tau);
0058   
0059   <span class="comment">% define the moment function depending on the parameters (theta)</span>
0060   H = @(theta) ecf - phi(theta);
0061   
0062   <span class="comment">% define the error function for the first step estimator</span>
0063   <span class="comment">% i.e. the I_{T-1} matrix as weighting matrix</span>
0064   first_step_error = @(theta) norm(mean(H(theta)).*sqrt_pi);
0065   
0066   <span class="comment">% perform first step optimization</span>
0067   disp(<span class="string">'Calculating first step estimator...'</span>);
0068   first_step_opt = <a href="../../../code/util/misc/prepare_nl_opt_call.html" class="code" title="function nl_opt = prepare_nl_opt_call(obj, x0, lb, ub, options)">prepare_nl_opt_call</a>(first_step_error, theta_0 <span class="keyword">...</span>
0069                                       , lb, ub, options);
0070   theta_first = first_step_opt();
0071   theta_first = reshape(theta_first, 1, length(theta_first));
0072   disp(<span class="string">'done'</span>);
0073   
0074   <span class="comment">% CGMM estimation for correlated moment functions</span>
0075   disp(<span class="string">'Calculating optimal weighting matrix...'</span>);
0076   H_first = H(theta_first);
0077   H_first_weighted = H_first.*repmat(sqrt_pi,T-1,1);
0078   S = T/6;
0079   ph_kernel = @(x) exp(-0.5*diag(x'*x))/((2*3.1415*s)^(p*0.5));
0080   ph = ph_kernel((0:T)/S);
0081   ph = ph/sum(ph);
0082   UH_first = ph(1)*conj(H_first);
0083   ph = repmat(ph, 1, size(H_first,2));
0084   <span class="keyword">for</span> t=1:(T-1)
0085     UH_first(t,:) = UH_first(t,:) <span class="keyword">...</span>
0086                     + sum(ph(2:t,:).*conj(H_first(1:(t-1),:)), 1) <span class="keyword">...</span>
0087                     + sum(ph(2:(T-t),:).*conj(H_first((t+1):(T-1),:)), 1);
0088   <span class="keyword">end</span>
0089   UH_first_weighted = UH_first.*repmat(sqrt_pi,T-1,1);
0090   C = (UH_first_weighted*H_first_weighted')/(T-length(theta_first));
0091   alpha = 0.02; <span class="comment">% regularization parameter</span>
0092   opt_weighting = inv(alpha*eye(T-1)+C^2);
0093   disp(<span class="string">'done'</span>);
0094   w = @(mean_H_theta) H_first_weighted * (mean_H_theta.*sqrt_pi)';
0095   v = @(mean_H_theta) UH_first_weighted * (mean_H_theta.*sqrt_pi).';
0096   <span class="comment">% define the second step error function for the efficient estimator</span>
0097   <span class="comment">% wrap the call to mean(H(theta)) to prevent calling it twice (expensive!)</span>
0098   wrap_second_step_error = @(mean_H_theta) real(w(mean_H_theta)' <span class="keyword">...</span>
0099                       *opt_weighting*v(mean_H_theta));
0100   second_step_error = @(theta) wrap_second_step_error(mean(H(theta)));
0101   
0102   <span class="comment">% prepare CGMM optimization</span>
0103   second_step_opt = <a href="../../../code/util/misc/prepare_nl_opt_call.html" class="code" title="function nl_opt = prepare_nl_opt_call(obj, x0, lb, ub, options)">prepare_nl_opt_call</a>(second_step_error, theta_first <span class="keyword">...</span>
0104                                       , lb, ub, options);
0105   
0106   disp(<span class="string">'Calculating second step cgmm estimator...'</span>);
0107   <span class="comment">% call to optimization function</span>
0108   theta_cgmm = second_step_opt();
0109   
0110   theta_cgmm = reshape(theta_cgmm, 1, length(theta_cgmm));
0111   disp(<span class="string">'done'</span>);
0112 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 29-Apr-2013 19:29:13 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>